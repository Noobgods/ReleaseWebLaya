!function(t,e){"use strict";var i,s,h,r,o,l,n,a,_,d,c,u,g,p,f,w,m,y,S;t.ButtonStatus=void 0,(i=t.ButtonStatus||(t.ButtonStatus={}))[i.Up=0]="Up",i[i.Down=1]="Down",i[i.Over=2]="Over",i[i.SelectedOver=3]="SelectedOver",i[i.Disabled=4]="Disabled",i[i.SelectedDisabled=5]="SelectedDisabled",t.AlignType=void 0,(s=t.AlignType||(t.AlignType={}))[s.Left=0]="Left",s[s.Center=1]="Center",s[s.Right=2]="Right",s[s.None=3]="None",t.VAlignType=void 0,(h=t.VAlignType||(t.VAlignType={}))[h.Top=0]="Top",h[h.Middle=1]="Middle",h[h.Bottom=2]="Bottom",h[h.None=3]="None",t.LayoutChangedReason=void 0,(r=t.LayoutChangedReason||(t.LayoutChangedReason={}))[r.Size=0]="Size",r[r.Pos=1]="Pos",r[r.Visible=2]="Visible",r[r.Hierarchy=3]="Hierarchy",t.ButtonMode=void 0,(o=t.ButtonMode||(t.ButtonMode={}))[o.Common=0]="Common",o[o.Check=1]="Check",o[o.Radio=2]="Radio",t.ButtonDownEffect=void 0,(l=t.ButtonDownEffect||(t.ButtonDownEffect={}))[l.None=0]="None",l[l.Dark=1]="Dark",l[l.UpScale=2]="UpScale",l[l.DownScale=3]="DownScale",t.TextFitContent=void 0,(n=t.TextFitContent||(t.TextFitContent={}))[n.None=0]="None",n[n.Both=1]="Both",n[n.Height=2]="Height",t.LayoutType=void 0,(a=t.LayoutType||(t.LayoutType={}))[a.None=0]="None",a[a.SingleColumn=1]="SingleColumn",a[a.SingleRow=2]="SingleRow",a[a.FlowX=3]="FlowX",a[a.FlowY=4]="FlowY",t.StretchMode=void 0,(_=t.StretchMode||(t.StretchMode={}))[_.None=0]="None",_[_.Stretch=1]="Stretch",_[_.ResizeToFit=2]="ResizeToFit",t.SelectionMode=void 0,(d=t.SelectionMode||(t.SelectionMode={}))[d.None=0]="None",d[d.Single=1]="Single",d[d.Multiple=2]="Multiple",d[d.MultipleBySingleClick=3]="MultipleBySingleClick",d[d.Disabled=4]="Disabled",t.LoaderFitMode=void 0,(c=t.LoaderFitMode||(t.LoaderFitMode={}))[c.None=0]="None",c[c.Fill=1]="Fill",c[c.Contain=2]="Contain",c[c.Cover=3]="Cover",c[c.CoverWidth=4]="CoverWidth",c[c.CoverHeight=5]="CoverHeight",t.ProgressTitleType=void 0,(u=t.ProgressTitleType||(t.ProgressTitleType={}))[u.Percent=0]="Percent",u[u.ValueAndMax=1]="ValueAndMax",u[u.Value=2]="Value",u[u.Max=3]="Max",t.ScrollDirection=void 0,(g=t.ScrollDirection||(t.ScrollDirection={}))[g.Vertical=0]="Vertical",g[g.Horizontal=1]="Horizontal",g[g.Both=2]="Both",t.ScrollTouchEffect=void 0,(p=t.ScrollTouchEffect||(t.ScrollTouchEffect={}))[p.Default=0]="Default",p[p.On=1]="On",p[p.Off=2]="Off",t.ScrollBounceBackEffect=void 0,(f=t.ScrollBounceBackEffect||(t.ScrollBounceBackEffect={}))[f.Default=0]="Default",f[f.On=1]="On",f[f.Off=2]="Off",t.ScrollBarDisplay=void 0,(w=t.ScrollBarDisplay||(t.ScrollBarDisplay={}))[w.Default=0]="Default",w[w.Always=1]="Always",w[w.OnOverflow=2]="OnOverflow",w[w.OnScroll=3]="OnScroll",w[w.OnOverflowAndScroll=4]="OnOverflowAndScroll",w[w.Hidden=5]="Hidden",t.PopupDirection=void 0,(m=t.PopupDirection||(t.PopupDirection={}))[m.Auto=0]="Auto",m[m.Up=1]="Up",m[m.Down=2]="Down",t.TreeClickToExpandType=void 0,(y=t.TreeClickToExpandType||(t.TreeClickToExpandType={}))[y.None=0]="None",y[y.SingleClick=1]="SingleClick",y[y.DoubleClick=2]="DoubleClick",t.RelationType=void 0,(S=t.RelationType||(t.RelationType={}))[S.Width=1]="Width",S[S.Height=2]="Height",S[S.Left_Left=3]="Left_Left",S[S.Left_Center=4]="Left_Center",S[S.Left_Right=5]="Left_Right",S[S.Center_Center=6]="Center_Center",S[S.Right_Left=7]="Right_Left",S[S.Right_Center=8]="Right_Center",S[S.Right_Right=9]="Right_Right",S[S.Top_Top=10]="Top_Top",S[S.Top_Middle=11]="Top_Middle",S[S.Top_Bottom=12]="Top_Bottom",S[S.Middle_Middle=13]="Middle_Middle",S[S.Bottom_Top=14]="Bottom_Top",S[S.Bottom_Middle=15]="Bottom_Middle",S[S.Bottom_Bottom=16]="Bottom_Bottom",S[S.LeftExt_Left=17]="LeftExt_Left",S[S.LeftExt_Right=18]="LeftExt_Right",S[S.RightExt_Left=19]="RightExt_Left",S[S.RightExt_Right=20]="RightExt_Right",S[S.TopExt_Top=21]="TopExt_Top",S[S.TopExt_Bottom=22]="TopExt_Bottom",S[S.BottomExt_Top=23]="BottomExt_Top",S[S.BottomExt_Bottom=24]="BottomExt_Bottom",S[S.Size=100]="Size",S[S.Pos=101]="Pos",S[S.CenterAndMiddle=102]="CenterAndMiddle";class x{constructor(){this.values={}}get owner(){return this._owner}set owner(t){var e,i,s;this._owner=t,t?(null===(e=this._controller)||void 0===e||e.validate(),this.onChanged(null)):(null===(i=this._controller)||void 0===i||i.release(),null===(s=this._tween)||void 0===s||s.kill())}get controller(){return this._controller}set controller(t){this._controller&&this._controller.release(),this._controller=t,t&&(t.onChanged=t=>this.onChanged(t),this._owner&&t.validate())}get propPath(){return this._propPath}set propPath(t){this._propPath=t,this._propPathArr=t?t.split("."):null,this.onChanged(null)}get tween(){return this._tweenCfg}set tween(t){this._tweenCfg=t}onChanged(t){this._owner&&this._controller&&this.runGear(t)}getValue(t){let e=this.values[t];return void 0===e&&0!=t&&(e=this.values[0],null!=e&&"object"==typeof e&&"function"==typeof e.clone&&(e=e.clone())),e}compareValue(t,e){if(null!=t&&"object"==typeof t&&"function"==typeof t.equal){if(t.equal(e))return!0}else if(t==e)return!0;return!1}doTween(t,i,s,h){if(this._tween){let t=this._tween.findTweener(null);if(t&&this.compareValue(h,t.endValue.getAt(0)))return;this._tween.kill(),this._tween.recover(),this._tween=null}if(this.compareValue(s,h))return;let r=this._tweenCfg;this._tween=e.Tween.create(t,this._owner).duration(r.duration).delay(r.delay).ease(e.Ease[r.easeType]).go(i,s,h).then(()=>{this._tween.recover(),this._tween=null}),t.cmdID&&this._tween.onUpdate(()=>{var t;return null===(t=this._owner._graphics)||void 0===t?void 0:t.repaint()})}runGear(t){var i;let s=this._propPathArr;if(!s)return;let h=this._owner,r=s.length;for(let t=0;t<r-1;t++)if(h=h[s[t]],null==h)return;let o=s[r-1];void 0===this.values[0]&&(this.values[0]=h[o]);let l=this.getValue(this._controller.selectedIndex);if(void 0===l)return;let n=h[o];if(null==n||!this._tweenCfg||!this._tweenCfg.enabled||!t||!t.changing||x.disableAllTweenEffect||this._owner._getBit(e.NodeFlags.EDITING_NODE))return h[o]=l,void(h.cmdID&&(null===(i=this._owner._graphics)||void 0===i||i.repaint()));this.doTween(h,o,n,l)}}x.disableAllTweenEffect=!1;class v extends x{}class C extends x{}class I extends x{}class b extends x{}class T extends x{doTween(t,i,s,h){super.doTween(t,i,s,h),this._tween&&this._tween.interp(e.Tween.seperateChannel)}}class P extends x{doTween(t,i,s,h){super.doTween(t,i,s,h),this._tween&&this._tween.interp(e.Tween.seperateChannel,4)}}class B extends x{constructor(){super(),this._flag=!0,this._condition=0,this._pages=[],this.propPath="internalVisible"}get pages(){return this._pages}set pages(t){this._pages=t,this.onChanged(null)}get condition(){return this._condition}set condition(t){this._condition=t,this.onChanged(null)}runGear(t){this._tween&&(this._tween.kill(),this._tween.recover(),this._tween=null);let e=this._controller.selectedIndex;this._flag=-1==e||0==this._pages.length||-1!=this._pages.indexOf(e),null!=t&&t.changing&&1!==this._owner.gears.length?M.add(this._owner):B.check(this._owner,null,!1)}static check(t,i,s){var h,r;let o,l,n=0;for(let e of t.gears)e instanceof B?(o=null==o?e._flag:0==e._condition?o&&e._flag:o||e._flag,l=e):s&&null!=e._tween&&(null===(h=e.controller)||void 0===h?void 0:h.inst)==i&&(n=Math.max(n,null===(r=e._tween.findTweener(null))||void 0===r?void 0:r.remainTime));o=null==o||o,0===n||o||t.internalVisible==o?t.internalVisible=o:l._tween=e.Tween.create(t).duration(n).then(()=>{t.internalVisible=!1,l._tween.recover(),l._tween=null})}static checkAll(t){if(0!=M.size){for(let e of M)B.check(e,t,!0);M.clear()}}}const M=new Set;class z extends e.EventDispatcher{constructor(){super(),this.name="",this._pages=[],this._selectedIndex=-1,this._previousIndex=-1,this._refs=new Set}get pages(){return this._pages}set pages(t){this._pages=t,t.length>0&&-1==this._selectedIndex&&(this.selectedIndex=0)}get numPages(){return this._pages.length}set numPages(t){this._pages.length=t;for(let e=0;e<t;e++)null==this._pages[e]&&(this._pages[e]="")}addPage(t){return t=t||"",this._pages.push(t),-1==this._selectedIndex&&(this.selectedIndex=0),this}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){if(0!=this._pages.length&&this._selectedIndex!=t){if(t>this._pages.length-1)return void console.warn(`index out of bounds: ${t}`);this._previousIndex=this._selectedIndex,this._selectedIndex=t,this.changing=!0;try{for(let t of this._refs)t.onChanged(this);B.checkAll(this),this.event(e.Event.CHANGED)}finally{this.changing=!1}}}get selectedPage(){return this._selectedIndex<0||this._selectedIndex>=this._pages.length?null:this._pages[this._selectedIndex]}set selectedPage(t){let e=this._pages.indexOf(t);-1===e&&(e=0),this.selectedIndex=e}get previousIndex(){return this._previousIndex}set oppositeIndex(t){t>0?this.selectedIndex=0:this._pages.length>1&&(this.selectedIndex=1)}}var L;t.UIEvent=void 0,(L=t.UIEvent||(t.UIEvent={})).ContentSizeChanged="content_size_changed",L.ControllersChanged="controllers_changed",L.Scroll="scroll",L.ScrollEnd="scroll_end",L.PullDownRelease="pull_down_release",L.PullUpRelease="pull_up_release",L.ClickItem="click_item",L.Popup="popup",L.InstanceReload="instance_reload";class E{constructor(t,e){2==arguments.length?(this._target=t,this._name=e||""):(this._target=t.owner,this._name=t.name),this._inst=null}get target(){return this._target}get name(){return this._name}get inst(){return this._inst}get selectedIndex(){return this._inst?this._inst.selectedIndex:-1}set selectedIndex(t){this._inst&&(this._inst.selectedIndex=t)}get selectedPage(){return this._inst?this._inst.selectedPage:""}set selectedPage(t){this._inst&&(this._inst.selectedPage=t)}get previousIndex(){return this._inst?this._inst.selectedIndex:0}set oppositeIndex(t){this._inst&&(this._inst.oppositeIndex=t)}release(){this._inited&&(this._inited=!1,this._target.off(t.UIEvent.ControllersChanged,this,this._check),e.LayaEnv.isPlaying||this._target.off(t.UIEvent.InstanceReload,this,this._reload),this._inst&&(this._inst._refs.delete(this),this._inst=null))}validate(){this._inited||(this._inited=!0,this._target.on(t.UIEvent.ControllersChanged,this,this._check),e.LayaEnv.isPlaying||this._target.on(t.UIEvent.InstanceReload,this,this._reload),this._check(!0))}_reload(t){this._target=t,this._check()}_check(t){let e=this._target.getController(this._name);e!=this._inst&&(this._inst&&this._inst._refs.delete(this),this._inst=e,e&&this._inst._refs.add(this),t||this.onChanged(e))}}class R{}R.modalLayerColor="rgba(50, 50, 50, 0.2)",R.horizontalScrollBar=null,R.verticalScrollBar=null,R.defaultScrollStep=25,R.defaultScrollDecelerationRate=.967,R.defaultScrollBarDisplay=t.ScrollBarDisplay.Always,R.defaultScrollTouchEffect=!0,R.defaultScrollBounceEffect=!0,R.defaultScrollSnappingThreshold=.1,R.defaultScrollPagingThreshold=.3,R.popupMenu=null,R.popupMenuSeperator=null,R.tooltipsWidget=null,R.defaultTooltipsShowDelay=100,R.defaultComboBoxVisibleItemCount=20,R.touchScrollSensitivity=10,R.touchDragSensitivity=10,R.clickDragSensitivity=2,R.bringWindowToFrontOnClick=!0;const k=Symbol();class D{constructor(){this._data=[]}get owner(){return this._owner}set owner(t){this._owner=t,this._target&&(this._owner?this.setTarget():this.unsetTarget())}set target(t){this._target!=t&&(this._target&&this.unsetTarget(),this._target=t,this._owner&&this._target&&this.setTarget())}get target(){return this._target}get data(){return this._data}set data(t){this._data=t}add(e,i){return e==t.RelationType.Size?(this.add(t.RelationType.Width,i),void this.add(t.RelationType.Height,i)):e==t.RelationType.Pos?(this.add(t.RelationType.Left_Left,i),void this.add(t.RelationType.Top_Top,i)):e==t.RelationType.CenterAndMiddle?(this.add(t.RelationType.Center_Center,i),void this.add(t.RelationType.Middle_Middle,i)):void(-1==this._data.findIndex((t,i)=>t==e&&i%2==0)&&this._data.push(e,i?1:0))}remove(e){if(e==t.RelationType.Size)return this.remove(t.RelationType.Width),void this.remove(t.RelationType.Height);for(let t=0,i=this._data.length;t<i;t+=2)if(this._data[t]==e){this._data.splice(t,2);break}}setTarget(){let i=this._target;this._tx=i.x,this._ty=i.y,this._tw=i.width,this._th=i.height,i.on(e.Event.MOVED,this,this.posChanged),i.on(e.Event.RESIZE,this,this.sizeChanged),e.LayaEnv.isPlaying||i.on(t.UIEvent.InstanceReload,this,this.instReload)}unsetTarget(){this._target.off(e.Event.MOVED,this,this.posChanged),this._target.off(e.Event.RESIZE,this,this.sizeChanged),e.LayaEnv.isPlaying||this._target.off(t.UIEvent.InstanceReload,this,this.instReload)}applyOnSelfResized(){if(0!=this._data.length)for(let e=0,i=this._data.length;e<i;e+=2)switch(this._data[e]){case t.RelationType.Center_Center:this._owner.x-=(.5-this._owner.anchorX)*this._owner._deltaWidth;break;case t.RelationType.Right_Center:case t.RelationType.Right_Left:case t.RelationType.Right_Right:this._owner.x-=(1-this._owner.anchorX)*this._owner._deltaWidth;break;case t.RelationType.Middle_Middle:this._owner.y-=(.5-this._owner.anchorY)*this._owner._deltaHeight;break;case t.RelationType.Bottom_Middle:case t.RelationType.Bottom_Top:case t.RelationType.Bottom_Bottom:this._owner.y-=(1-this._owner.anchorY)*this._owner._deltaHeight}}applyOnPosChanged(e,i,s){let h;switch(e){case t.RelationType.Left_Left:case t.RelationType.Left_Center:case t.RelationType.Left_Right:case t.RelationType.Center_Center:case t.RelationType.Right_Left:case t.RelationType.Right_Center:case t.RelationType.Right_Right:this._owner.x+=i;break;case t.RelationType.Top_Top:case t.RelationType.Top_Middle:case t.RelationType.Top_Bottom:case t.RelationType.Middle_Middle:case t.RelationType.Bottom_Top:case t.RelationType.Bottom_Middle:case t.RelationType.Bottom_Bottom:this._owner.y+=s;break;case t.RelationType.Width:case t.RelationType.Height:break;case t.RelationType.LeftExt_Left:case t.RelationType.LeftExt_Right:h=this._owner.left,this._owner.width=this._owner._rawWidth-i,this._owner.left=h+i;break;case t.RelationType.RightExt_Left:case t.RelationType.RightExt_Right:h=this._owner.left,this._owner.width=this._owner._rawWidth+i,this._owner.left=h;break;case t.RelationType.TopExt_Top:case t.RelationType.TopExt_Bottom:h=this._owner.top,this._owner.height=this._owner._rawHeight-s,this._owner.top=h+s;break;case t.RelationType.BottomExt_Top:case t.RelationType.BottomExt_Bottom:h=this._owner.top,this._owner.height=this._owner._rawHeight+s,this._owner.top=h}}applyOnSizeChanged(e,i,s,h,r,o){let l,n,a,_,d=0,c=0,u=0;switch(A[i]?(o||(d=this._target.x,c=this._target.anchorX),s?0!=this._tw&&(u=h/this._tw):u=h-this._tw):(o||(d=this._target.y,c=this._target.anchorY),s?0!=this._th&&(u=r/this._th):u=r-this._th),i){case t.RelationType.Left_Left:s?e.left=d+(e.left-d)*u:0!=c&&(e.x+=u*-c);break;case t.RelationType.Left_Center:s?e.left=d+(e.left-d)*u:e.x+=u*(.5-c);break;case t.RelationType.Left_Right:s?e.left=d+(e.left-d)*u:e.x+=u*(1-c);break;case t.RelationType.Center_Center:s?e.left=d+(e.left+.5*e._rawWidth-d)*u-.5*e._rawWidth:e.x+=u*(.5-c);break;case t.RelationType.Right_Left:s?e.left=d+(e.left+e._rawWidth-d)*u-e._rawWidth:0!=c&&(e.x+=u*-c);break;case t.RelationType.Right_Center:s?e.left=d+(e.left+e._rawWidth-d)*u-e._rawWidth:e.x+=u*(.5-c);break;case t.RelationType.Right_Right:s?e.left=d+(e.left+e._rawWidth-d)*u-e._rawWidth:e.x+=u*(1-c);break;case t.RelationType.Top_Top:s?e.top=d+(e.top-d)*u:0!=c&&(e.y+=u*-c);break;case t.RelationType.Top_Middle:s?e.top=d+(e.top-d)*u:e.y+=u*(.5-c);break;case t.RelationType.Top_Bottom:s?e.top=d+(e.top-d)*u:e.y+=u*(1-c);break;case t.RelationType.Middle_Middle:s?e.top=d+(e.top+.5*e._rawHeight-d)*u-.5*e._rawHeight:e.y+=u*(.5-c);break;case t.RelationType.Bottom_Top:s?e.top=d+(e.top+e._rawHeight-d)*u-e._rawHeight:0!=c&&(e.y+=u*-c);break;case t.RelationType.Bottom_Middle:s?e.top=d+(e.top+e._rawHeight-d)*u-e._rawHeight:e.y+=u*(.5-c);break;case t.RelationType.Bottom_Bottom:s?e.top=d+(e.top+e._rawHeight-d)*u-e._rawHeight:e.y+=u*(1-c);break;case t.RelationType.Width:if(0!=e._deltaWidth)break;null!=this._sw?(l=this._sw-this._tw,this._sw=null):l=e._rawWidth-this._tw,s&&(l*=u),o?(n=e.left,e.size(h+l,e._rawHeight),e.left=n):e.width=h+l;break;case t.RelationType.Height:if(0!=e._deltaHeight)break;null!=this._sh?(l=this._sh-this._th,this._sh=null):l=e._rawHeight-this._th,s&&(l*=u),o?(n=e.top,e.size(e._rawWidth,r+l),e.top=n):e.height=r+l;break;case t.RelationType.LeftExt_Left:n=e.left,l=s?d+(n-d)*u-n:u*-c,e.width=e._rawWidth-l,e.left=n+l;break;case t.RelationType.LeftExt_Right:n=e.left,l=s?d+(n-d)*u-n:u*(1-c),e.width=e._rawWidth-l,e.left=n+l;break;case t.RelationType.RightExt_Left:n=e.left,l=s?d+(n+e._rawWidth-d)*u-(n+e._rawWidth):u*-c,e.width=e._rawWidth+l,e.left=n;break;case t.RelationType.RightExt_Right:if(0!=e._deltaWidth)break;n=e.left,a=e._rawWidth,null!=this._sw&&(a=this._sw,this._sw=null),s?(l=d+(n+a-d)*u-(n+a),e.width=a+l,e.left=n):(l=u*(1-c),e.width=a+l,e.left=n);break;case t.RelationType.TopExt_Top:n=e.top,l=s?d+(n-d)*u-n:u*-c,e.height=e._rawHeight-l,e.top=n+l;break;case t.RelationType.TopExt_Bottom:n=e.top,l=s?d+(n-d)*u-n:u*(1-c),e.height=e._rawHeight-l,e.top=n+l;break;case t.RelationType.BottomExt_Top:n=e.top,l=s?d+(n+e._rawHeight-d)*u-(n+e._rawHeight):u*-c,e.height=e._rawHeight+l,e.top=n;break;case t.RelationType.BottomExt_Bottom:if(0!=e._deltaHeight)break;n=e.top,_=e._rawHeight,null!=this._sh&&(_=this._sh,this._sh=null),s?(l=d+(n+_-d)*u-(n+_),e.height=_+l,e.top=n):(l=u*(1-c),e.height=_+l,e.top=n)}}posChanged(){if(!this._owner||this._owner[k]||this._isDisabled)return this._tx=this._target.x,void(this._ty=this._target.y);if(this._target.isAncestorOf(this._owner))return;let t=e.SerializeUtil.isDeserializing;t&&(e.SerializeUtil.isDeserializing=!1),this._owner[k]=!0;let i=this._target.x-this._tx,s=this._target.y-this._ty;for(let t=0,e=this._data.length;t<e;t+=2)this.applyOnPosChanged(this._data[t],i,s);this._owner[k]=!1,t&&(e.SerializeUtil.isDeserializing=!0),this._tx=this._target.x,this._ty=this._target.y}sizeChanged(){let t=this._target.width,i=this._target.height,s=this._owner;if(!s||s[k]||this._isDisabled)return this._tw=t,void(this._th=i);let h=this._target.isAncestorOf(s),r=e.SerializeUtil.isDeserializing;r&&(e.SerializeUtil.isDeserializing=!1),s[k]=!0;for(let e=0,r=this._data.length;e<r;e+=2)this.applyOnSizeChanged(s,this._data[e],1==this._data[e+1],t,i,h);s[k]=!1,r&&(e.SerializeUtil.isDeserializing=!0),this._tw=t,this._th=i}instReload(t){this.target=t}}const A=[];!function(){const e=[t.RelationType.Width,t.RelationType.Left_Left,t.RelationType.Left_Center,t.RelationType.Left_Right,t.RelationType.Center_Center,t.RelationType.Right_Left,t.RelationType.Right_Center,t.RelationType.Right_Right,t.RelationType.LeftExt_Left,t.RelationType.LeftExt_Right,t.RelationType.RightExt_Left,t.RelationType.RightExt_Right];for(let t of e)A[t]=!0}();class F extends e.Sprite{constructor(){super(),this._grayed=!1,this._draggable=!1,this._rawWidth=0,this._rawHeight=0,this._deltaWidth=0,this._deltaHeight=0,this._giveWidth=0,this._giveHeight=0,this.sourceWidth=0,this.sourceHeight=0,this._nodeType=2,this._controllers={},this._gears=[],this._relations=[],this._controllerCount=0,this._initialize()}get left(){return this._x-this._width*this._anchorX}set left(t){this.pos(t+this._width*this._anchorX,this.y)}get top(){return this._y-this._height*this._anchorY}set top(t){this.pos(this._x,t+this._height*this._anchorY)}setLeftTop(t,e){t=null!=t?t+this._width*this._anchorX:this._x,e=null!=e?e+this._height*this._anchorY:this._y,this.pos(t,e)}center(t){let e=t;return e||(e=this.parent?this.parent:F._defaultRoot),this.setLeftTop(Math.floor(.5*(e.width-this.width)),Math.floor(.5*(e.height-this.height))),this}pos(i,s){var h,r,o;return this._x==i&&this._y==s||(super.pos(i,s),2==(null===(h=this.parent)||void 0===h?void 0:h._nodeType)&&(null===(o=(r=this.parent).setLayoutChangedFlag)||void 0===o||o.call(r,t.LayoutChangedReason.Pos)),this.event(e.Event.MOVED)),this}size(i,s,h){var r;if(this._width==i&&this._height==s){if(!this._forceSizeFlag)return this;this._forceSizeFlag=!1}if(this._rawWidth=i,this._rawHeight=s,h||(this._giveWidth=i,this._giveHeight=s),i<0&&(i=0),s<0&&(s=0),this._deltaWidth=i-this._width,this._deltaHeight=s-this._height,super.size(i,s),this.setLayoutChangedFlag(),this._sizeChanged(h),this.parent){if(this._relations.length>0)for(let t of this._relations)t.applyOnSelfResized();2==(null===(r=this.parent)||void 0===r?void 0:r._nodeType)&&this.parent.setLayoutChangedFlag(t.LayoutChangedReason.Size)}return this.event(e.Event.RESIZE),this._deltaWidth=0,this._deltaHeight=0,this}makeFullSize(e,i){let s=e;return s||(s=this.parent instanceof F?this.parent:F._defaultRoot),this.size(s.width,s.height),i&&this.addRelation(s,t.RelationType.Size),this}get grayed(){return this._grayed}set grayed(t){if(t=!!t,this._grayed!==t){this._grayed=t;let i=this.getController("grayed");i&&(i.selectedIndex=t?1:0,t=!1);let s=this.getPostProcess(t);if(t){let t=s.getEffect(e.GrayscaleEffect2D);t||(t=s.addEffect(new e.GrayscaleEffect2D))}else if(s){let t=s.getEffect(e.GrayscaleEffect2D);t&&(s.removeEffect(t),e.LayaEnv.isPlaying||0!==s.effects.length||(this.postProcess=null))}}}get enabled(){return!this.grayed&&this.mouseEnabled}set enabled(t){this.grayed=!t,this.mouseEnabled=t}get internalVisible(){return!this._getBit(e.NodeFlags.NOT_IN_PAGE)}set internalVisible(t){var i;0===(this._bits&e.NodeFlags.NOT_IN_PAGE)!==t&&(this._setBit(e.NodeFlags.NOT_IN_PAGE,!t),this._processVisible(),(null===(i=this._parent)||void 0===i?void 0:i.activeInHierarchy)&&this.active&&this._processActive(t,!0))}get tooltips(){return this._tooltips}set tooltips(t){this._tooltips&&(this.off(e.Event.ROLL_OVER,this,this._rollOver),this.off(e.Event.ROLL_OUT,this,this._rollOut)),this._tooltips=t,this._tooltips&&(this.on(e.Event.ROLL_OVER,this,this._rollOver),this.on(e.Event.ROLL_OUT,this,this._rollOut))}_rollOver(){F._defaultRoot.popupMgr.showTooltips(this._tooltips,R.defaultTooltipsShowDelay)}_rollOut(){F._defaultRoot.popupMgr.hideTooltips()}get text(){return""}set text(t){}get icon(){return null}set icon(t){}get background(){return this._background}set background(t){this._background&&this.graphics.removeCmd(this._background,!0),this._background=t,t&&(t.lock=!0,this.graphics.addCmd(t,0))}get draggable(){return this._draggable}set draggable(t){this._draggable!=t&&(this._draggable=t,t&&(this._dragSupport||(this._dragSupport=new e.DragSupport(this))),this._dragSupport&&(this._dragSupport.autoStart=t))}get relations(){return this._relations}set relations(t){this._relations.length>0&&this._relations.filter(e=>!t.includes(e)).forEach(t=>t.owner=null),this._relations=t,t.forEach(t=>t.owner=this)}_addRelations(t){for(let e of t)e.owner=this,this._relations.push(e)}addRelation(t,e,i){let s=this._relations.find(e=>e.target==t);return s||(s=new D,s.owner=this,s.target=t,this._relations.push(s)),s.add(e,i),this}removeRelation(t,e){let i=this._relations.find(e=>e.target==t);return i&&i.remove(e),this}clearRelations(){return this._relations.length=0,this}get controllers(){return this._controllers}get controllerCount(){return this._controllerCount}set controllers(t){this._controllers=t;let e=0;for(let i in t)t[i].name=i,t[i].owner=this,e++;this._controllerCount=e,this._controllersChanged()}addController(t,e){if(this._controllers[t])return console.warn(`controller ${t} already exists`),this._controllers[t];let i=new z;return i.name=t,i.owner=this,null!=e&&(i.numPages=e),this._controllers[t]=i,this._controllerCount++,this._controllersChanged(),i}getController(t){return this._controllers[t]}setPage(t,e){let i=this._controllers[t];i&&("number"==typeof e?i.selectedIndex=e:i.selectedPage=e)}_controllersChanged(){this.event(t.UIEvent.ControllersChanged)}get gears(){return this._gears}set gears(t){let e;this._gears.length>0&&this._gears.filter(e=>!t.includes(e)).forEach(t=>{t instanceof B&&(e=!0),t.owner=null}),this._gears=t,t.forEach(t=>t.owner=this),e&&B.check(this)}_addGears(t){this._gears.push(...t),t.forEach(t=>t.owner=this)}addGear(t){this._gears.push(t),t.owner=this}removeGear(t){let e=this._gears.indexOf(t);-1!=e&&(this._gears.splice(e,1),t.owner=null)}onClick(t,i,s){1==arguments.length&&(i=t,t=null),this.on(e.Event.CLICK,t,i,s)}offClick(t,i){1==arguments.length&&(i=t,t=null),this.off(e.Event.CLICK,t,i)}destroy(){this._background&&(this._background.lock=!1),super.destroy();for(let t in this._controllers)this._controllers[t].offAll();for(let t of this._gears)t.owner=null}_sizeChanged(t){}_childChanged(e){super._childChanged(e),this.setLayoutChangedFlag(t.LayoutChangedReason.Hierarchy)}_processVisible(){var e,i,s;return!!super._processVisible()&&(2==(null===(e=this.parent)||void 0===e?void 0:e._nodeType)&&(null===(s=(i=this.parent).setLayoutChangedFlag)||void 0===s||s.call(i,t.LayoutChangedReason.Visible)),!0)}setLayoutChangedFlag(t){}_onConstruct(t){if(t&&this._relations.length>0)for(let t of this._relations)t._sw=this._width,t._sh=this._height,t.target&&(t.target._forceSizeFlag=!0);this.onConstruct()}onConstruct(){}onAfterDeserialize(){if(super.onAfterDeserialize(),e.SerializeUtil.hasProp("_startPages")){let t=this._startPages;if(t)for(let e in t){let i=this.getController(e);i&&(i.selectedIndex=t[e])}}}}class W{constructor(t){this._owner=t,this._color=new e.Color}destroy(){this._tex&&(this._owner._getBit(e.NodeFlags.EDITING_NODE)&&this._tex.off("reload",this,this.onTextureReload),this._tex=null),this._drawCmd&&(this._drawCmd.lock=!1,this._drawCmd.recover())}setTexture(t){this._tex&&this._owner._getBit(e.NodeFlags.EDITING_NODE)&&this._tex.off("reload",this,this.onTextureReload),this._tex=t,t?(this._owner._getBit(e.NodeFlags.EDITING_NODE)&&t.on("reload",this,this.onTextureReload),this.createCmd()):this._drawCmd&&(this._drawCmd=this._owner.graphics.replaceCmd(this._drawCmd,null,!0))}setMesh(t){this._meshFactory!==t?(this._meshFactory=t,this._tex&&this.createCmd()):this._owner.graphics.repaint()}setColor(t){this._color.parse(t),this._drawCmd&&(this._drawCmd.color=this._color.getABGR(),this._owner.graphics.repaint())}onTextureReload(){var t;null===(t=this._onReload)||void 0===t||t.call(this),this.setTexture(this._tex)}createCmd(){var t;let i,s;if(i=this._meshFactory?e.DrawTrianglesCmd:this._tex._sizeGrid?e.Draw9GridTextureCmd:e.DrawTextureCmd,this._drawCmd&&this._drawCmd.cmdID===i.ID){let s=this._drawCmd.texture;return s!==this._tex&&(null==s||s._removeReference(),null===(t=this._tex)||void 0===t||t._addReference()),this._drawCmd.texture=this._tex,i===e.DrawTrianglesCmd&&(this._drawCmd.mesh=this._meshFactory),void this._owner.graphics.repaint()}s=this._meshFactory?e.DrawTrianglesCmd.create2(this._tex,this._meshFactory):this._tex._sizeGrid?e.Draw9GridTextureCmd.create(this._tex,0,0,1,1,this._tex._sizeGrid,!0):e.DrawTextureCmd.create(this._tex,0,0,1,1,null,1,null,null,null,!0),s.lock=!0,s.color=this._color.getABGR(),this._drawCmd=this._owner.graphics.replaceCmd(this._drawCmd,s,!0)}}class O extends F{constructor(){super(),this._frame=0,this._autoPlay=!0,this._loop=!0,this._srcWidth=0,this._srcHeight=0,this._loadId=0,this._src="",this._color="#ffffff",this._fitMode=t.LoaderFitMode.Contain,this._shrinkOnly=!1,this._align=t.AlignType.Center,this._valign=t.VAlignType.Middle,this._content=new e.Sprite,this._content.hideFlags|=e.HideFlags.HideAndDontSave,this._renderer=new W(this._content),this._renderer._onReload=()=>this.onTextureReload(),this.addChild(this._content)}get src(){return this._src}set src(t){null==t&&(t=""),this._src!=t&&(this._src=t,t?this.loadContent():this.clearContent())}get icon(){return this._src}set icon(t){this.src=t}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,e.ILaya.timer.callLater(this,this.updateLayout))}get valign(){return this._valign}set valign(t){this._valign!=t&&(this._valign=t,e.ILaya.timer.callLater(this,this.updateLayout))}get fitMode(){return this._fitMode}set fitMode(t){this._fitMode!=t&&(this._fitMode=t,e.ILaya.timer.callLater(this,this.updateLayout))}get shrinkOnly(){return this._shrinkOnly}set shrinkOnly(t){this._shrinkOnly!=t&&(this._shrinkOnly=t,e.ILaya.timer.callLater(this,this.updateLayout))}get color(){return this._color}set color(t){this._color=t,this._renderer.setColor(t),this._ani&&(this._ani.color=this._ani.color.parse(t))}get ani(){return this._ani}get frame(){return this._frame}set frame(t){this._frame=t,this._ani&&(this._ani.frame=t)}get autoPlay(){return this._autoPlay}set autoPlay(t){this._autoPlay=t,this._ani&&(this._ani.autoPlay=t)}get loop(){return this._loop}set loop(t){this._loop=t,this._ani&&(this._ani.loop=t)}get texture(){return this._renderer._tex}set texture(t){this._src="instance-0",this.onLoaded(t,++this._loadId)}get mesh(){return this._renderer._meshFactory}set mesh(t){this._renderer.setMesh(t)}get material(){return this._content.material}set material(t){this._content.material=t}loadContent(){let t=++this._loadId,i=e.Loader.getRes(this._src,e.Loader.IMAGE);i?this.onLoaded(i,t):e.ILaya.loader.load(this._src,{maybeType:e.Loader.IMAGE}).then(e=>this.onLoaded(e,t))}onLoaded(t,i){this._loadId!=i||this.destroyed||(t instanceof e.Texture?(this._ani&&this._ani.setAtlas(null),this._renderer.setTexture(t),this._srcWidth=t.sourceWidth,this._srcHeight=t.sourceHeight):t instanceof e.AtlasResource?(this._renderer.setTexture(null),this._ani||(this._ani=this._content.addComponent(e.FrameAnimation),this._ani.color=this._ani.color.parse(this._color),this._ani.stretchMode=e.AnimationStretchMode.Fill,this._ani.autoPlay=this._autoPlay,this._ani.loop=this._loop,this._ani.frame=this._frame),this._ani.setAtlas(t),this._srcWidth=this._ani.width,this._srcHeight=this._ani.height):(this._renderer.setTexture(null),this._ani&&this._ani.setAtlas(null),this._srcWidth=0,this._srcHeight=0),e.ILaya.timer.runCallLater(this,this.updateLayout,!0),this.event(e.Event.LOADED))}onTextureReload(){let t=this._renderer._tex;this._srcWidth=t.sourceWidth,this._srcHeight=t.sourceHeight,e.ILaya.timer.runCallLater(this,this.updateLayout,!0),this.event(e.Event.LOADED)}clearContent(){this._srcWidth=0,this._srcHeight=0,this._loadId++,this._renderer.setTexture(null),this._ani&&(this._ani.source=null)}updateLayout(){let e=this._srcWidth,i=this._srcHeight;if(0==e||0==i)return;this._updatingLayout=!0;let s,h,r=1,o=1;this._fitMode!=t.LoaderFitMode.None&&0!=e&&0!=i&&(r=this.width/e,o=this.height/i,1==r&&1==o||(this._fitMode==t.LoaderFitMode.CoverHeight?r=o:this._fitMode==t.LoaderFitMode.CoverWidth?o=r:this._fitMode==t.LoaderFitMode.Contain?r>o?r=o:o=r:this._fitMode==t.LoaderFitMode.Cover&&(r>o?o=r:r=o),this._shrinkOnly&&(r>1&&(r=1),o>1&&(o=1)),e*=r,i*=o)),this._content.size(e,i),s=this._align==t.AlignType.Center?Math.floor((this.width-e)/2):this._align==t.AlignType.Right?this.width-e:0,h=this._valign==t.VAlignType.Middle?Math.floor((this.height-i)/2):this._valign==t.VAlignType.Bottom?this.height-i:0,this._content.pos(s,h),this._updatingLayout=!1}_sizeChanged(){super._sizeChanged(),this._updatingLayout||e.ILaya.timer.callLater(this,this.updateLayout)}destroy(){super.destroy(),this._renderer.destroy()}}class N extends F{constructor(){super(),this._requestingCmd=0,this.bringToFontOnClick=R.bringWindowToFrontOnClick,this.on(e.Event.DISPLAY,this,this._onShown),this.on(e.Event.UNDISPLAY,this,this._onHidden),this.on(e.Event.MOUSE_DOWN,this,this._winTouchBegin)}get contentPane(){return this._contentPane}set contentPane(e){this._contentPane!=e&&(this._contentPane&&this.removeChild(this._contentPane),this._contentPane=e,this._contentPane&&(this.addChild(this._contentPane),this.size(this._contentPane.width,this._contentPane.height),this._contentPane.addRelation(this,t.RelationType.Size),this._frame=this._contentPane.getChild("frame"),this._frame&&(this.closeButton=this._frame.getChild("closeButton"),this.dragArea=this._frame.getChild("dragArea"),this.contentArea=this._frame.getChild("contentArea"))))}get frame(){return this._frame}get closeButton(){return this._closeButton}set closeButton(t){this._closeButton&&this._closeButton.off(e.Event.CLICK,this,this.closeEventHandler),this._closeButton=t,this._closeButton&&this._closeButton.on(e.Event.CLICK,this,this.closeEventHandler)}get dragArea(){return this._dragArea}set dragArea(t){this._dragArea!=t&&(this._dragArea&&(this._dragArea.draggable=!1,this._dragArea.off(e.Event.DRAG_START,this,this._dragStart)),this._dragArea=t,this._dragArea&&(this._dragArea.draggable=!0,this._dragArea.on(e.Event.DRAG_START,this,this._dragStart)))}get contentArea(){return this._contentArea}set contentArea(t){this._contentArea=t}show(){F._defaultRoot.showWindow(this)}hide(){this.isShowing&&this.doHideAnimation()}hideImmediately(){F._defaultRoot.hideWindowImmediately(this)}toggleStatus(){this.isTop?this.hide():this.show()}get isShowing(){return null!=this.parent}get isTop(){return this.parent&&this.parent.getChildIndex(this)==this.parent.numChildren-1}get modal(){return this._modal}set modal(t){this._modal=t}bringToFront(){F._defaultRoot.bringToFront(this)}showModalWait(t){null!=t&&(this._requestingCmd=t),R.windowModalWaiting&&(this._modalWaitPane||(this._modalWaitPane=e.Loader.createNodes(R.windowModalWaiting)),this._modalWaitPane.mouseEnabled=!0,this.layoutModalWaitPane(),this.addChild(this._modalWaitPane))}layoutModalWaitPane(){if(this._contentArea){let t=this._frame.localToGlobal(H.setTo(0,0));t=this.globalToLocal(t),this._modalWaitPane.pos(t.x+this._contentArea.x,t.y+this._contentArea.y),this._modalWaitPane.size(this._contentArea.width,this._contentArea.height)}else this._modalWaitPane.size(this.width,this.height)}closeModalWait(t){return(null==t||this._requestingCmd==t)&&(this._requestingCmd=0,this.modalWaiting&&this.removeChild(this._modalWaitPane),!0)}get modalWaiting(){return null!=this._modalWaitPane&&null!=this._modalWaitPane.parent}onInit(){}onShown(){}onHide(){}doShowAnimation(){this.onShown()}doHideAnimation(){this.hideImmediately()}destroy(){this.parent&&this.hideImmediately(),super.destroy()}closeEventHandler(){this.hide()}_onShown(){this._inited?this.doShowAnimation():this._loading||(this._loading=!0,Promise.resolve(this.onInit()).then(()=>{this._loading=!1,this._inited=!0,this.isShowing&&this.doShowAnimation()}))}_onHidden(){this.closeModalWait(),this.onHide()}_winTouchBegin(){this.isShowing&&this.bringToFontOnClick&&this.bringToFront()}_dragStart(){this._dragArea.stopDrag(),this.startDrag()}}const H=new e.Point,j=Symbol("popupTarget");class G{constructor(t){this._owner=t,this._popupStack=[],this._justClosedPopups=[],e.InputManager.onMouseDownCapture.add(this._touchBegin,this),e.ILaya.stage.on(e.Event.BLUR,this,this.checkPopups)}showPopup(t,e,i){if(this._popupStack.length>0){let e=this._popupStack.indexOf(t);if(-1!=e)for(let t=this._popupStack.length-1;t>=e;t--)this._owner.removeChild(this._popupStack.pop())}if(this._popupStack.push(t),e){let i=e;for(;i;){if(i.parent==this._owner){t.zOrder<i.zOrder&&(t.zOrder=i.zOrder);break}i=i.parent}}t[j]=e,this._owner.addChild(t),this._owner.adjustModalLayer(),this.validatePopupPosition(t,e,i)}validatePopupPosition(i,s,h,r,o){let l,n,a,_,d=0,c=0;if(null==r&&(r=0),null==o&&(o=0),s){let t=s.localToGlobal(e.Point.TEMP.setTo(0,0));l=t.x,n=t.y;let i=s.localToGlobal(e.Point.TEMP.setTo(s.width,s.height));d=i.x-l,c=i.y-n}else{let t=this._owner.globalToLocal(e.Point.TEMP.copy(e.InputManager.getTouchPos()));l=t.x,n=t.y}a=l+r,a+i.width>this._owner.width&&(a=l+d-i.width-r),_=n+c+o,((void 0===h||h===t.PopupDirection.Auto)&&_+i.height>this._owner.height||h===t.PopupDirection.Up)&&(_=n-i.height-o-1,_<0&&(_=0,a+=d/2,a+i.width>this._owner.width&&(a=this._owner.width-i.width))),i.pos(a,_)}togglePopup(t,e,i){return-1==this._justClosedPopups.indexOf(t)&&(this.showPopup(t,e,i),!0)}hidePopup(t){if(t){let e=this._popupStack.indexOf(t);if(-1!=e)for(let t=this._popupStack.length-1;t>=e;t--)this.closePopup(this._popupStack.pop())}else{for(let t=this._popupStack.length-1;t>=0;t--)this.closePopup(this._popupStack[t]);this._popupStack.length=0}}get hasAnyPopup(){return 0!=this._popupStack.length}isPopupJustClosed(t){return-1!=this._justClosedPopups.indexOf(t)}closePopup(t){t.parent&&(t instanceof N?t.hide():this._owner.removeChild(t))}showTooltips(t,i){if(null==this._defaultTooltipWin){if(!R.tooltipsWidget)return void console.warn("UIConfig.tooltipsWidget not defined");this._defaultTooltipWin=e.Loader.createNodes(R.tooltipsWidget),this._defaultTooltipWin.mouseEnabled=!1}this._defaultTooltipWin.text=t,this.showTooltipsWin(this._defaultTooltipWin,i)}showTooltipsWin(t,i){this.hideTooltips(),this._tooltipWin=t,null!=i&&0!=i?e.ILaya.timer.once(i,this,this._doShowTooltips):this._doShowTooltips()}_doShowTooltips(){null!=this._tooltipWin&&(this.validatePopupPosition(this._tooltipWin,null,t.PopupDirection.Auto,10,20),this._owner.addChild(this._tooltipWin))}hideTooltips(){this._tooltipWin&&(this._tooltipWin.parent&&this._owner.removeChild(this._tooltipWin),this._tooltipWin=null)}checkPopups(){if(this._justClosedPopups.length=0,this._popupStack.length>0){let t=e.InputManager.touchTarget,i=!1;for(;t;){let e=this._popupStack.indexOf(t);if(-1!=e){for(let t=this._popupStack.length-1;t>e;t--){let t=this._popupStack.length-1,e=this._popupStack[t];this.closePopup(e),this._justClosedPopups.push(e),this._popupStack.splice(t,1)}i=!0;break}t=t.parent}if(!i)for(let t=this._popupStack.length-1;t>=0;t--){let e=this._popupStack[t];this.closePopup(e),this._justClosedPopups.push(e),this._popupStack.splice(t,1)}}}_touchBegin(){this._tooltipWin&&this.hideTooltips(),this.checkPopups()}}class U extends F{static get inst(){var t;return null!==(t=F._defaultRoot)&&void 0!==t?t:F._defaultRoot=new U}constructor(){super(),this.name="GRoot",this.zOrder=U.LAYER,this.mouseThrough=!0,this.hideFlags|=e.HideFlags.HideAndDontSave,this.size(e.ILaya.stage.width,e.ILaya.stage.height),e.ILaya.stage.addChild(this),this._popupMgr=new G(this),this._modalLayer=new F,this._modalLayer.mouseEnabled=!0,this._modalLayer.hideFlags|=e.HideFlags.HideAndDontSave,this._modalLayer.size(this.width,this.height),this._modalLayer.addRelation(this,t.RelationType.Size),e.ILaya.stage.on(e.Event.RESIZE,()=>{this.size(e.ILaya.stage.width,e.ILaya.stage.height)})}get popupMgr(){return this._popupMgr}showWindow(t){this.addChild(t),t.x>this.width?t.x=this.width-t.width:t.x+t.width<0&&(t.x=0),t.y>this.height?t.y=this.height-t.height:t.y+t.height<0&&(t.y=0),this.adjustModalLayer()}hideWindow(t){t.hide()}hideWindowImmediately(t){t.parent==this&&this.removeChild(t),this.adjustModalLayer()}bringToFront(t){let e,i=this.numChildren;for(e=this._modalLayer.parent&&!t.modal?this.getChildIndex(this._modalLayer)-1:i-1;e>=0;e--){let i=this.getChildAt(e);if(i==t)return;if(i instanceof N)break}e>=0&&this.setChildIndex(t,e)}showModalWait(i){R.globalModalWaiting&&(null==this._modalWaitPane&&(this._modalWaitPane=e.Loader.createNodes(R.globalModalWaiting)),this._modalWaitPane.size(this.width,this.height),this._modalWaitPane.addRelation(this,t.RelationType.Size),this.addChild(this._modalWaitPane),this._modalWaitPane.text=i||"")}closeModalWait(){this._modalWaitPane&&this._modalWaitPane.parent&&this.removeChild(this._modalWaitPane)}closeAllExceptModals(){let t=this.children.slice(),e=t.length;for(let i=0;i<e;i++){let e=t[i];e instanceof N&&!e.modal&&e.hide()}}closeAllWindows(){let t=this.children.slice(),e=t.length;for(let i=0;i<e;i++){let e=t[i];e instanceof N&&e.hide()}}getTopWindow(){for(let t=this.numChildren-1;t>=0;t--){let e=this.getChildAt(t);if(e instanceof N)return e}return null}get modalLayer(){return this._modalLayer}get hasModalWindow(){return null!=this._modalLayer.parent}get modalWaiting(){return this._modalWaitPane&&this._modalWaitPane.displayedInStage}showPopup(t,e,i){this._popupMgr.showPopup(t,e,i)}togglePopup(t,e,i){return this._popupMgr.togglePopup(t,e,i)}hidePopup(t){this._popupMgr.hidePopup(t)}get hasAnyPopup(){return this._popupMgr.hasAnyPopup}adjustModalLayer(){let t=this.numChildren;this._modalWaitPane&&this._modalWaitPane.parent&&this.setChildIndex(this._modalWaitPane,t-1);for(let e=t-1;e>=0;e--){let t=this.getChildAt(e);if(t instanceof N&&t.modal)return 0===this._modalLayer.graphics.cmds.length&&this._modalLayer.graphics.drawRect(0,0,1,1,R.modalLayerColor,null,0,!0),void(null==this._modalLayer.parent?this.addChildAt(this._modalLayer,e):this.setChildIndexBefore(this._modalLayer,e))}this._modalLayer.parent&&this.removeChild(this._modalLayer)}}U.LAYER=1e3;class V{static get inst(){return V._inst||(V._inst=new V)}constructor(){this.iconWidth=200,this.iconHeight=200;let i=this.agent=new O;i.name="dragAgent",i.anchor(.5,.5),i.mouseEnabled=!1,i.draggable=!0,i.fitMode=t.LoaderFitMode.Contain,i.shrinkOnly=!0,i.align=t.AlignType.Center,i.valign=t.VAlignType.Middle,i.zOrder=Number.POSITIVE_INFINITY,i.on(e.Event.DRAG_END,this,this._dragEnd)}get dragging(){return null!=this.agent.parent}start(t,i,s,h,r){if(null!=this.agent.parent)return;this._source=t;let o=e.InputManager.getTouchPos();if(this.agent.pos(o.x,o.y),"string"==typeof i)this.agent.src=i;else if(null!=i){if(null==this._rt){let t=new e.RenderTexture2D(this.iconWidth,this.iconHeight,e.RenderTargetFormat.R8G8B8A8);this._rt=new e.Texture(t)}i.drawToRenderTexture2D(this._rt.width,this._rt.height,0,0,this._rt.bitmap),this.agent.texture=this._rt}this.agent.size(h||this.iconWidth,r||this.iconHeight),U.inst.addChild(this.agent),this.agent.startDrag(null,!1,null,null,s)}stop(){null!=this.agent.parent&&(this.agent.src=null,this.agent.stopDrag(),this.agent.removeSelf(),this._source=null)}_dragEnd(t,i){if(null==this.agent.parent)return;this.agent.src=null,this.agent.removeSelf();let s=this._source;if(this._source=null,!i){let i=e.InputManager.touchTarget;for(;null!=i;){if(i.hasListener(e.Event.DROP))return void i.event(e.Event.DROP,[s,t]);i=i.parent}}}}class Y{constructor(){this.ratio=0,this.priority=0,this.min=0,this.max=0}setRatio(t){return this.ratio=t,this}setPriority(t){return this.priority=t,this}setLimit(t,e){return this.min=t,this.max=e,this}setFixed(){return this.fixed=!0,this}}class X{constructor(t){this._type=0,this._rows=0,this._columns=0,this._rowGap=0,this._columnGap=0,this._stretchX=0,this._stretchY=0,this._pageMode=!1,this._align=0,this._valign=0,this._minChildSize=0,this._contentWidth=0,this._contentHeight=0,this._owner=t,this._padding=[0,0,0,0],this._stretchParamsX=[],this._stretchParamsY=[]}get type(){return this._type}set type(i){var s;if(this._type!==i){if(this._type=i,!e.SerializeUtil.isDeserializing)switch(null===(s=this._owner.scroller)||void 0===s||s._setDefaultDirection(),i){case t.LayoutType.SingleColumn:case t.LayoutType.FlowX:this._stretchY=t.StretchMode.None;break;case t.LayoutType.SingleRow:case t.LayoutType.FlowY:this._stretchX=t.StretchMode.None}this.setChangedFlag()}}get rows(){return this._rows}set rows(t){this._rows!==t&&(this._rows=t,this.setChangedFlag())}get columns(){return this._columns}set columns(t){this._columns!==t&&(this._columns=t,this.setChangedFlag())}get rowGap(){return this._rowGap}set rowGap(t){this._rowGap!==t&&(this._rowGap=t,this.setChangedFlag())}get columnGap(){return this._columnGap}set columnGap(t){this._columnGap!==t&&(this._columnGap=t,this.setChangedFlag())}get padding(){return this._padding}set padding(t){var e;null!=t&&Array.isArray(t)||(t=[0,0,0,0]),this._padding=t,this.setChangedFlag(),null===(e=this._owner.scroller)||void 0===e||e._ownerSizeChanged()}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.setChangedFlag())}get valign(){return this._valign}set valign(t){this._valign!==t&&(this._valign=t,this.setChangedFlag())}get stretchX(){return this._stretchX}set stretchX(t){this._stretchX!==t&&(this._stretchX=t,this.setChangedFlag())}get stretchY(){return this._stretchY}set stretchY(t){this._stretchY!==t&&(this._stretchY=t,this.setChangedFlag())}get stretchParamsX(){return this._stretchParamsX}set stretchParamsX(t){this._stretchParamsX.length=0,this._stretchParamsX.push(...t)}get stretchParamsY(){return this._stretchParamsY}set stretchParamsY(t){this._stretchParamsY.length=0,this._stretchParamsY.push(...t)}get foldInvisibles(){return this._foldInvisibles}set foldInvisibles(t){this._foldInvisibles!=t&&(this._foldInvisibles=t,this.setChangedFlag())}get minChildSize(){return this._minChildSize}set minChildSize(t){this._minChildSize!==t&&(this._minChildSize=t,this.setChangedFlag())}get pageMode(){return this._pageMode}set pageMode(t){this._pageMode!=t&&(this._pageMode=t,this.setChangedFlag())}getSnappingPosition(t,i,s,h,r){r||(r=new e.Point);let o=this._owner.children,l=o.length;if(0===l)return r.x=0,r.y=0,r;this.refresh();let n=null,a=null,_=0;if(0!==i){for(;_<l;_++)if(n=o[_],i<n.top){if(0===_){i=0;break}a=o[_-1],i=i<a.top+a.height/2?a.top:n.top;break}_===l&&(i=n.top)}if(0!==t){for(_>0&&_--;_<l;_++)if(n=o[_],t<n.left){if(0===_){t=0;break}a=o[_-1],t=t<a.left+a.width/2?a.left:n.left;break}_===l&&(t=n.left)}return r.x=t,r.y=i,r}setChangedFlag(i){if(this._layoutChanged)return;let s=this._type;(s!==t.LayoutType.None||this._owner.scroller)&&(i!==t.LayoutChangedReason.Visible||this._foldInvisibles)&&(i===t.LayoutChangedReason.Pos&&s!==t.LayoutType.None||(i===t.LayoutChangedReason.Size&&(this._childSizeChangedFlag=!0),this._layoutChanged=!0,-1===$.indexOf(this)&&($.push(this),K||(K=!0,e.ILaya.timer.callLater(null,X.refreshAllLayouts)))))}refresh(e){if(this._owner.destroyed||this._disabled)this._layoutChanged=!1;else{if(e)this._layoutChanged||(this._childSizeChangedFlag=!0);else if(!this._layoutChanged||this._refreshing)return;switch(this._refreshing=!0,this._type){case t.LayoutType.None:this.applyNone();break;case t.LayoutType.SingleRow:this.applyFlowX(!0);break;case t.LayoutType.SingleColumn:this.applyFlowY(!0);break;case t.LayoutType.FlowX:this.applyFlowX();break;case t.LayoutType.FlowY:this.applyFlowY()}this._refreshing=!1,this._layoutChanged=!1,this._childSizeChangedFlag=!1}}get viewWidth(){var t;let e=null===(t=this._owner.scroller)||void 0===t?void 0:t.viewWidth;return null==e&&(e=this._owner.width-this._padding[3]-this._padding[1]),e}set viewWidth(t){this._owner.scroller?this._owner.scroller.setViewSize(t,this._owner.scroller.viewHeight):this._owner.width=t+this._padding[3]+this._padding[1]}get viewHeight(){var t;let e=null===(t=this._owner.scroller)||void 0===t?void 0:t.viewHeight;return null==e&&(e=this._owner.height-this._padding[0]-this._padding[2]),e}set viewHeight(t){this._owner.scroller?this._owner.scroller.setViewSize(this._owner.scroller.viewWidth,t):this._owner.height=t+this._padding[0]+this._padding[2]}get contentWidth(){return this._contentWidth}get contentHeight(){return this._contentHeight}setContentSize(e,i){var s;this._contentWidth=e,this._contentHeight=i,0!==e&&0!==i&&(this._stretchX===t.StretchMode.ResizeToFit&&this._stretchY===t.StretchMode.ResizeToFit?this._owner.scroller?this._owner.scroller.setViewSize(e,i):this._owner.size(e+this._padding[3]+this._padding[1],i+this._padding[0]+this._padding[2]):this._stretchX===t.StretchMode.ResizeToFit?this.viewWidth=e:this._stretchY===t.StretchMode.ResizeToFit&&(this.viewHeight=i)),null===(s=this._owner.scroller)||void 0===s||s._ownerContentSizeChanged(),this._owner.event(t.UIEvent.ContentSizeChanged)}resizeToFit(i,s){this.refresh();let h=this._owner.numChildren;if((null==i||i>h)&&(i=h),s=s||0,0===i)this._type===t.LayoutType.SingleColumn||this._type===t.LayoutType.FlowX?this.viewHeight=s:this.viewWidth=s;else{let h=i-1,r=null;for(;h>=0&&(r=this._owner.getChildAt(h),this._foldInvisibles&&!r._struct.enabled||r._getBit(e.NodeFlags.ESCAPE_LAYOUT));)h--;if(h<0)this._type===t.LayoutType.SingleColumn||this._type===t.LayoutType.FlowX?this.viewHeight=s:this.viewWidth=s;else{let e=0;this._type===t.LayoutType.SingleColumn||this._type===t.LayoutType.FlowX?(e=r.y+r.height,e<s&&(e=s),this.viewHeight=e):(e=r.x+r.width,e<s&&(e=s),this.viewWidth=e)}}}applyNone(){e.SpriteUtils.getChildrenBounds(this._owner,!1,this._foldInvisibles,!1,J),this.setContentSize(Math.max(0,Math.ceil(J.right)),Math.max(0,Math.ceil(J.bottom)))}applyFlowX(e){var i;let s=this._rows,h=this._columns,r=this._pageMode;e&&(s=1,0!==h||r||(h=1e6));let o=this._rowGap,l=this._columnGap,n=this._stretchX===t.StretchMode.Stretch,a=this._stretchY===t.StretchMode.Stretch,_=n?0:this._align,d=q.take(),c=this.getLayoutChildren(d),u=d.children,g=this.viewWidth,p=this.viewHeight,f=0,w=0,m=0,y=0,S=0,x=0,v=0,C=0,I=0,b=0;if(n){(0===h||c<h)&&(h=c);let t=this.checkStretchParams(this._stretchParamsX,d);for(let t=0;t<h;t++)d.swidth[t]=this._childSizeChangedFlag?u[t].width:u[t]._giveWidth;this.handleStrecth(g,h,l,t,d.swidth,d.width)}if(c>0&&a){0===s&&(s=1);for(let t=0;t<s;t++)d.sheight[t]=this._childSizeChangedFlag?u[0].height:u[0]._giveHeight;this.handleStrecth(p,s,o,this._stretchParamsY,d.sheight,d.height)}function T(t){I=Math.ceil(I),0!==w&&(w+=o),f>v&&(v=f),f=1===_?.5*(g-f):2===_?g-f:0,r&&(w+I>p||x===s)&&0!==w&&(m+=g,w=0,b++,x=0);for(let e=t-S;e<t;e++)d.posx[e]+=m+f,d.posy[e]=y+w;f=0,w+=I,I=0,S=0,x++}for(let t=0;t<2;t++){for(let t=0;t<c;t++){let i=u[t];i.size(n?d.width[S%h]:i._giveWidth,a?d.height[x%s]:i._giveHeight,!0);let r=Math.ceil(i.width);0===h&&f+l+r>g&&0!==f&&(T(t),i.size(n?d.width[S]:i._giveWidth,a?d.height[x%s]:i._giveHeight,!0),r=Math.ceil(i.width)),0!==f&&(f+=l),d.posx[t]=f,f+=r,i.height>I&&(I=i.height),S++,(S===h&&!e||t===c-1)&&T(t+1)}C=y+w;let t=null===(i=this._owner.scroller)||void 0===i?void 0:i._shouldCheckOverflow();if(null==t)break;if(C<=p&&n&&1&t?(g+=this._owner.scroller.vScrollBar.width,this.handleStrecth(g,h,l,this._stretchParamsX,d.swidth,d.width)):t&=-2,v<=g&&a&&2&t?(p+=this._owner.scroller.hScrollBar.height,this.handleStrecth(p,s,o,this._stretchParamsY,d.sheight,d.height)):t&=-3,0===t)break;f=w=m=y=S=x=v=C=I=0}if(w=0,C<p&&this._stretchY!==t.StretchMode.ResizeToFit&&(1===this._valign?w=(p-C)/2:2===this._valign&&(w=p-C)),f=0,this._stretchX===t.StretchMode.ResizeToFit&&(1!==_&&2!==_||(f=Math.floor((v-g)/2),f>0&&(f=0))),this._owner.scroller||(f+=this._padding[3],w+=this._padding[0]),e&&!a&&3===this._valign)for(let t=0;t<c;t++)u[t].left=d.posx[t]+f;else for(let t=0;t<c;t++)u[t].setLeftTop(d.posx[t]+f,d.posy[t]+w);r&&(v=g*(b+1)),this.setContentSize(v,C),q.recover(d)}applyFlowY(e){var i;let s=this._rows,h=this._columns,r=this._pageMode;e&&(h=1,0!==s||r||(s=1e6));let o=this._rowGap,l=this._columnGap,n=this._stretchX===t.StretchMode.Stretch,a=this._stretchY===t.StretchMode.Stretch,_=a?0:this._valign,d=q.take(),c=this.getLayoutChildren(d),u=d.children,g=this.viewWidth,p=this.viewHeight,f=0,w=0,m=0,y=0,S=0,x=0,v=0,C=0,I=0,b=0;if(c>0&&n){0===h&&(h=1);for(let t=0;t<h;t++)d.swidth[t]=this._childSizeChangedFlag?u[0].width:u[0]._giveWidth;this.handleStrecth(g,h,l,this._stretchParamsX,d.swidth,d.width)}if(a){(0===s||c<s)&&(s=c);let t=this.checkStretchParams(this._stretchParamsY,d);for(let t=0;t<s;t++)d.sheight[t]=this._childSizeChangedFlag?u[t].height:u[t]._giveHeight;this.handleStrecth(p,s,o,t,d.sheight,d.height)}function T(t){I=Math.ceil(I),0!==f&&(f+=l),w>C&&(C=w),w=1===_?.5*(p-w):2===_?p-w:0,r&&(f+I>g||S===h)&&0!==f&&(y+=p,f=0,b++,S=0);for(let e=t-x;e<t;e++)d.posx[e]=m+f,d.posy[e]+=y+w;w=0,f+=I,I=0,x=0,S++}for(let t=0;t<2;t++){for(let t=0;t<c;t++){let i=u[t];i.size(n?d.width[S%h]:i._giveWidth,a?d.height[x%s]:i._giveHeight,!0);let r=Math.ceil(i.height);0===s&&w+o+r>p&&0!==w&&(T(t),i.size(n?d.width[S%h]:i._giveWidth,a?d.height[x]:i._giveHeight,!0),r=Math.ceil(i.height)),0!==w&&(w+=o),d.posy[t]=w,w+=r,i.width>I&&(I=i.width),x++,(x===s&&!e||t===c-1)&&T(t+1)}v=m+f;let t=null===(i=this._owner.scroller)||void 0===i?void 0:i._shouldCheckOverflow();if(null==t)break;if(C<=p&&n&&1&t?(g+=this._owner.scroller.vScrollBar.width,this.handleStrecth(g,h,l,this._stretchParamsX,d.swidth,d.width)):t&=-2,v<=g&&a&&2&t?(p+=this._owner.scroller.hScrollBar.height,this.handleStrecth(p,s,o,this._stretchParamsY,d.sheight,d.height)):t&=-3,0===t)break;f=w=m=y=S=x=v=C=I=0}if(f=0,v<g&&this._stretchX!==t.StretchMode.ResizeToFit&&(f=1===this._align?(g-v)/2:2===this._align?g-v:0),w=0,this._stretchY===t.StretchMode.ResizeToFit&&(1!==_&&2!==_||(w=Math.floor((C-p)/2),w>0&&(w=0))),this._owner.scroller||(f+=this._padding[3],w+=this._padding[0]),e&&!n&&3===this._align)for(let t=0;t<c;t++)u[t].top=d.posy[t]+w;else for(let t=0;t<c;t++)u[t].setLeftTop(d.posx[t]+f,d.posy[t]+w);r&&(C=p*(b+1)),this.setContentSize(v,C),q.recover(d)}getLayoutChildren(t){let i=0,s=0;t.invisibleCnt=0;for(let h of this._owner.children)2===h._nodeType&&(this._foldInvisibles&&!h._struct.enabled||h._getBit(e.NodeFlags.ESCAPE_LAYOUT)?t.invisibles[t.invisibleCnt++]=i:t.children[s++]=h,i++);return s}checkStretchParams(t,e){if(0===e.invisibleCnt)return t;let i=e.stretchParams,s=0,h=0,r=e.invisibles[s];for(let o=0;o<t.length;o++)o!==r?i[h++]=t[o]:(s++,r=s>=e.invisibleCnt?-1:e.invisibles[s]);return i}handleStrecth(t,e,i,s,h,r){if(r=r||h,1===e&&!s[0])return void(r[0]=t);let o,l=Math.max(0,t-i*(e-1)),n=this._minChildSize,a=0,_=0,d=0;for(let t=0;t<e;t++){let e=s[t]||Q;0!==e.ratio?(o=!0,d+=e.ratio):_+=h[t]}d=Math.max(0,1-d);for(let t=0;t<e;t++){let e=s[t]||Q,i=h[t];if(o&&(i=0!==e.ratio?Math.floor(l*e.ratio):d*(i/_)),!e.fixed){let t=0!==e.min?e.min:n;i<t&&(i=t),e.max>0&&i>e.max&&(i=e.max)}r[t]=i,a+=i}let c=a-l;if(c>0){let t=0;for(;c>0;){let i=0;for(let h=0;h<e;h++){let e=s[h]||Q;if(e.fixed){Z[h]=null;continue}let o=0!==e.min?e.min:n;r[h]>o&&(t>=2||0===t&&e.priority>0||1===t&&(e==Q||0===e.ratio&&e.priority>=0))?(Z[h]=o,i++):Z[h]=null}if(0===i){if(t++,t>2)break;continue}let h=c/i,o=0;for(let t=0;t<e;t++){let e=Z[t];if(null==e)continue;if(o+=h,i--,o<0){if(0!==i)continue;o=Math.floor(o)}let s=r[t];o=Math.ceil(o),s=Math.max(s-o,e),o=h-o,c-=r[t]-s,r[t]=s}c=Math.floor(c),t++}}else if(c<0){let t=0;for(c=-c;c>0;){let i=0;for(let h=0;h<e;h++){let e=s[h]||Q;if(e.fixed){Z[h]=null;continue}let o=0!==e.max?e.max:1e6;r[h]<o&&(t>=2||0===t&&e.priority>0||1===t&&(e==Q||0===e.ratio&&e.priority>=0))?(Z[h]=o,i++):Z[h]=null}if(0===i){if(t++,t>2)break;continue}let h=c/i,o=0;for(let t=0;t<e;t++){let e=Z[t];if(null==e)continue;if(o+=h,i--,o<1){if(0!==i)continue;o=1}let s=r[t];o=Math.floor(o),s=Math.min(s+o,e),o=h-o,c-=s-r[t],r[t]=s}c=Math.ceil(c),t++}}}static refreshAllLayouts(t){let e=$.length;if(0!==e)if(t)for(let i=0;i<e;i++){let e=$[i];e&&t.isAncestorOf(e._owner)&&($[i]=null,e.refresh())}else{K=!1;for(let t=0;t<e;t++){let e=$[t];e&&($[t]=null,e.refresh())}$.length>e?$.splice(0,e):$.length=0}}}var K=!1,$=[];const q=e.Pool.createPool(class{constructor(){this.children=[],this.invisibles=[],this.invisibleCnt=0,this.stretchParams=[],this.posx=[],this.posy=[],this.width=[],this.swidth=[],this.height=[],this.sheight=[]}}),Z=[],J=new e.Rectangle,Q=new Y;class tt extends F{constructor(t){super(),this._layout=new(t||X)(this)}get layout(){return this._layout}setLayoutChangedFlag(t){var e;null===(e=this._layout)||void 0===e||e.setChangedFlag(t)}_sizeChanged(t){t&&this._layout.refresh()}}let et={text:""};function it(t,i,s,h){"object"==typeof s&&(h=s,s="");let r=t[i];return r?h?e.Utils.parseTemplate(r,h):r:s}class st extends e.Resource{static getById(t){return st._allInsts.get(t)||null}static create(t,e){return new st(t,e)}static translate(t,e){let i;return st.decodeI18nText(t,et),et.sid?i=st.getById(et.sid):et.key&&(i=st.provider),i&&(t=i.t(et.key,et.text,null!=e?e:void 0)),t}static decodeI18nText(t,e){if(e=e||{},!t||!t.startsWith("i18n:"))return e.sid=null,e.key=null,e.text=t,e;let i=t.indexOf(":",5),s=t.indexOf("|",5);return-1!=i?(e.sid=t.substring(5,i),-1!=s?(e.key=t.substring(i+1,s),e.text=t.substring(s+1)):(e.key=t.substring(i+1),e.text=null)):-1!=s?(e.sid=null,e.key=t.substring(5,s),e.text=t.substring(s+1)):(e.sid=null,e.key=t.substring(5),e.text=null),e}static encodeI18nText(t,e){var i;return null==e&&(e=null!==(i=t.text)&&void 0!==i?i:""),t.key?t.sid?"i18n:"+t.sid+":"+t.key+"|"+e:"i18n:"+t.key+"|"+e:e}constructor(t,e){super(!1),this._id2=t,st._allInsts.set(t,this),this._lngs=[],this._fallbackLng=e||"en"}get id(){return this._id}setContent(t,e){let i=st.provider;return i&&i.isInitialized?(t||(t=i.language),st.provider.addResourceBundle(t,this._id2,e,!0,!0),-1==this._lngs.indexOf(t)&&this._lngs.push(t),t==i.language?this._t=i.getFixedT(i.language,this._id2):this._t||t!=this._fallbackLng||(this._t=i.getFixedT(this._fallbackLng,this._id2)),this):(console.error("no i18n provider or i18 is not initialized"),this)}t(t,e,i){return this._t?this._t(t,e,i):"string"==typeof e?e:t}_disposeResource(){super._disposeResource(),st._allInsts.delete(this._id2);for(let t of this._lngs)st.provider.removeResourceBundle(t,this._id2)}}st.provider=new class{constructor(){var t;this.isInitialized=!0,this.language=(null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.language)||"en",this._content={},this._t=it.bind(null,{})}t(t,e,i){return this._t(t,e,i)}addResourceBundle(t,e,i,s,h){let r=this._content[t];r||(r=this._content[t]={});let o=it.bind(null,i);t===this.language&&(this._t=o),r[e]={resources:i,t:o}}removeResourceBundle(t,e){let i=this._content[t];i&&delete i[e]}getFixedT(t,e){var i;let s=null===(i=this._content[t])||void 0===i?void 0:i[e];return s?s.t:this._t}},st._allInsts=new Map;class ht extends F{constructor(){super(),this._fitContent=0,this.textIns=new e.Text,this.textIns.hideFlags|=e.HideFlags.HideAndDontSave,this.textIns.padding.fill(2),this.textIns._onPostLayout=()=>this._onPostLayout(),this.textIns._onTranslate=st.translate,this.textIns.on(e.Event.LINK,t=>this.event(e.Event.LINK,t)),this.addChild(this.textIns)}get textWidth(){return this.textIns.textWidth}get textHeight(){return this.textIns.textHeight}get text(){return this.textIns.text}set text(t){this.textIns.text=t}get font(){return this.textIns.font}set font(t){this.textIns.font=t}get fontSize(){return this.textIns.fontSize}set fontSize(t){this.textIns.fontSize=t}get color(){return this.textIns.color}set color(t){this.textIns.color=t}get bold(){return this.textIns.bold}set bold(t){this.textIns.bold=t}get italic(){return this.textIns.italic}set italic(t){this.textIns.italic=t}get align(){return this.textIns.align}set align(t){this.textIns.align=t}get valign(){return this.textIns.valign}set valign(t){this.textIns.valign=t}get alignItems(){return this.textIns.alignItems}set alignItems(t){this.textIns.alignItems=t}get wordWrap(){return this.textIns.wordWrap}set wordWrap(t){this.textIns.wordWrap=t}get fitContent(){return this._fitContent}set fitContent(i){this._fitContent!=i&&(i!=t.TextFitContent.Both&&i!=t.TextFitContent.Height||e.SerializeUtil.isDeserializing||this._getBit(e.NodeFlags.EDITING_NODE)&&!(this.textIns.textWidth>0&&this.textIns.textHeight>0)||(i==t.TextFitContent.Height?this.height=this.textIns.textHeight:this.size(this.textIns.textWidth,this.textIns.textHeight)),this._fitContent=i)}get leading(){return this.textIns.leading}set leading(t){this.textIns.leading=t}get padding(){return this.textIns.padding}set padding(t){this.textIns.padding=t}get stroke(){return this.textIns.stroke}set stroke(t){this.textIns.stroke=t}get strokeColor(){return this.textIns.strokeColor}set strokeColor(t){this.textIns.strokeColor=t}get overflow(){return this.textIns.overflow}set overflow(t){this.textIns.overflow=t}get underline(){return this.textIns.underline}set underline(t){this.textIns.underline=t}get underlineColor(){return this.textIns.underlineColor}set underlineColor(t){this.textIns.underlineColor=t}get strikethrough(){return this.textIns.strikethrough}set strikethrough(t){this.textIns.strikethrough=t}get strikethroughColor(){return this.textIns.strikethroughColor}set strikethroughColor(t){this.textIns.strikethroughColor=t}get html(){return this.textIns.html}set html(t){this.textIns.html=t}get ubb(){return this.textIns.ubb}set ubb(t){this.textIns.ubb=t}get maxWidth(){return this.textIns.maxWidth}set maxWidth(t){this.textIns.maxWidth=t}get singleCharRender(){return this.textIns.singleCharRender}set singleCharRender(t){this.textIns.singleCharRender=t}get templateVars(){return this.textIns.templateVars}set templateVars(t){this.textIns.templateVars=t}setVar(t,e){return this.textIns.setVar(t,e),this}size(i,s){return this._fitContent!=t.TextFitContent.Both||this._fitFlag||this._getBit(e.NodeFlags.EDITING_NODE)&&!(this.textIns.textWidth>0)||(i=this._width),this._fitContent!=t.TextFitContent.Both&&this._fitContent!=t.TextFitContent.Height||this._fitFlag||this._getBit(e.NodeFlags.EDITING_NODE)&&!(this.textIns.textHeight>0)||(s=this._height),super.size(i,s)}typeset(t){return this.textIns.typeset(t),this}_transChanged(t){super._transChanged(t),0!=(t&e.TransformKind.Width)&&(this.textIns.width=this._width),0!=(t&e.TransformKind.Height)&&(this.textIns.height=this._height)}_onPostLayout(){this._fitContent!=t.TextFitContent.Both&&this._fitContent!=t.TextFitContent.Height||this._getBit(e.NodeFlags.EDITING_NODE)&&!(this.textIns.textWidth>0&&this.textIns.textHeight>0)||(this._fitFlag=!0,this._fitContent==t.TextFitContent.Height?this.height=this.textIns.textHeight:this.size(this.textIns.textWidth,this.textIns.textHeight),this._fitFlag=!1)}}class rt extends F{constructor(){super(),this.textIns=new e.Input,this.textIns.hideFlags|=e.HideFlags.HideAndDontSave,this.textIns.overflow="hidden",this.textIns.padding.fill(2),this.textIns._onTranslate=(t,e,i)=>1===i?st.translate(t,e):t,this.textIns.on(e.Event.INPUT,()=>this.event(e.Event.INPUT)),this.textIns.on(e.Event.ENTER,()=>this.event(e.Event.ENTER)),this.textIns.on(e.Event.CHANGE,()=>this.event(e.Event.CHANGE)),this.textIns.on(e.Event.FOCUS,()=>this.event(e.Event.FOCUS)),this.textIns.on(e.Event.BLUR,()=>this.event(e.Event.BLUR)),this.addChild(this.textIns)}get text(){return this.textIns.text}set text(t){this.textIns.text=t}get font(){return this.textIns.font}set font(t){this.textIns.font=t}get fontSize(){return this.textIns.fontSize}set fontSize(t){this.textIns.fontSize=t}get color(){return this.textIns.color}set color(t){this.textIns.color=t}get bold(){return this.textIns.bold}set bold(t){this.textIns.bold=t}get italic(){return this.textIns.italic}set italic(t){this.textIns.italic=t}get align(){return this.textIns.align}set align(t){this.textIns.align=t}get valign(){return this.textIns.valign}set valign(t){this.textIns.valign=t}get leading(){return this.textIns.leading}set leading(t){this.textIns.leading=t}get padding(){return this.textIns.padding}set padding(t){this.textIns.padding=t}get underline(){return this.textIns.underline}set underline(t){this.textIns.underline=t}get underlineColor(){return this.textIns.underlineColor}set underlineColor(t){this.textIns.underlineColor=t}get strikethrough(){return this.textIns.strikethrough}set strikethrough(t){this.textIns.strikethrough=t}get strikethroughColor(){return this.textIns.strikethroughColor}set strikethroughColor(t){this.textIns.strikethroughColor=t}get stroke(){return this.textIns.stroke}set stroke(t){this.textIns.stroke=t}get strokeColor(){return this.textIns.strokeColor}set strokeColor(t){this.textIns.strokeColor=t}get multiline(){return this.textIns.multiline}set multiline(t){this.textIns.multiline=t}get editable(){return this.textIns.editable}set editable(t){this.textIns.editable=t}get restrict(){return this.textIns.restrict}set restrict(t){this.textIns.restrict=t}get prompt(){return this.textIns.prompt}set prompt(t){this.textIns.prompt=t}get promptColor(){return this.textIns.promptColor}set promptColor(t){this.textIns.promptColor=t}get maxChars(){return this.textIns.maxChars}set maxChars(t){this.textIns.maxChars=t}get type(){return this.textIns.type}set type(t){this.textIns.type=t}focus(){this.textIns.focus=!0}blur(){this.textIns.focus=!1}_transChanged(t){super._transChanged(t),0!=(t&e.TransformKind.Size)&&this.textIns.size(this.width,this.height)}}class ot{static create(t,e,i){return t&&t.destroy(),e?new ot(e,i):null}constructor(i,s){this.p=i,e.LayaEnv.isPlaying||(i.on(t.UIEvent.InstanceReload,this,this._reload),this._callback=s)}destroy(){e.LayaEnv.isPlaying||this.p.off(t.UIEvent.InstanceReload,this,this._reload)}_reload(t){this.p=t,this._callback()}}class lt extends F{get title(){return this._titleWidget?this._titleWidget.p.text:""}set title(t){this._titleWidget&&(this._titleWidget.p.text=t)}get text(){return this.title}set text(t){this.title=t}get icon(){return this._iconWidget?this._iconWidget.p.icon:""}set icon(t){this._iconWidget&&(this._iconWidget.p.icon=t)}get titleColor(){let t=this.findTextWidget();return t?t.color:"#000000"}set titleColor(t){let e=this.findTextWidget();e&&(e.color=t)}get titleFontSize(){let t=this.findTextWidget();return t?t.fontSize:0}set titleFontSize(t){let e=this.findTextWidget();e&&(e.fontSize=t)}get titleWidget(){var t;return(null===(t=this._titleWidget)||void 0===t?void 0:t.p)||null}set titleWidget(t){this._titleWidget=ot.create(this._titleWidget,t,()=>this._onPartChanged("title")),this._onPartChanged("title")}get iconWidget(){var t;return(null===(t=this._iconWidget)||void 0===t?void 0:t.p)||null}set iconWidget(t){this._iconWidget=ot.create(this._iconWidget,t,()=>this._onPartChanged("icon")),this._onPartChanged("icon")}_onPartChanged(t){}findTextWidget(){let t=this._titleWidget;for(;t;){let e=t.p;if(e instanceof ht||e instanceof rt)return e;if(!(e instanceof lt))break;t=e._titleWidget}return null}}class nt extends F{constructor(){super(),this._src="",this._loadId=0,this._color="#ffffff",this._autoSize=!0,this._renderer=new W(this),this._renderer._onReload=()=>this.onTextureReload()}get src(){return this._src}set src(t){if(null==t&&(t=""),this._src==t)return;this._src=t;let i=++this._loadId;if(t){let s=e.SerializeUtil.isDeserializing?null:e.Loader.getRes(t);s?this.onLoaded(s,i):e.ILaya.loader.load(t,e.Loader.IMAGE).then(t=>this.onLoaded(t,i))}else this.onLoaded(null,i)}get texture(){return this._renderer._tex}set texture(t){this._src="instance-0",this.onLoaded(t,++this._loadId)}get mesh(){return this._renderer._meshFactory}set mesh(t){this._renderer.setMesh(t)}get icon(){return this.src}set icon(t){this.src=t}get autoSize(){return this._autoSize}set autoSize(t){this._autoSize!=t&&(t&&this._renderer._tex&&this.size(this._renderer._tex.sourceWidth,this._renderer._tex.sourceHeight),this._autoSize=t)}get color(){return this._color}set color(t){this._color=t,this._renderer.setColor(t)}onLoaded(t,i){this._loadId!=i||this.destroyed||(this._renderer.setTexture(t),this._autoSize&&(t?this.size(t.sourceWidth,t.sourceHeight):this._getBit(e.NodeFlags.EDITING_NODE)||this.size(0,0),this._autoSize=!0),this.event(e.Event.LOADED))}onTextureReload(){if(this._autoSize){let t=this._renderer._tex;this.size(t.sourceWidth,t.sourceHeight),this._autoSize=!0}this.event(e.Event.LOADED)}_sizeChanged(t){super._sizeChanged(),t||e.SerializeUtil.isDeserializing||(this._autoSize=!1)}destroy(){super.destroy(),this._renderer.destroy()}}const at={[t.ButtonStatus.Over]:t.ButtonStatus.Up,[t.ButtonStatus.SelectedOver]:t.ButtonStatus.Down,[t.ButtonStatus.Disabled]:t.ButtonStatus.Up,[t.ButtonStatus.SelectedDisabled]:t.ButtonStatus.Down},_t=Symbol();var dt;class ct extends lt{constructor(){super(),this._selected=!1,this._titleStr="",this._iconStr="",this._selectedTitleStr="",this._selectedIconStr="",this._soundVolumeScale=0,this._selectedPage=0,this._downEffect=0,this._scaleEffect=!1,this._mode=t.ButtonMode.Common,this._soundVolumeScale=1,this._changeStateOnClick=!0,this.on(e.Event.ROLL_OVER,this,this._rollover),this.on(e.Event.ROLL_OUT,this,this._rollout),this.on(e.Event.MOUSE_DOWN,this,this._btnTouchBegin),this.on(e.Event.MOUSE_UP,this,this._btnTouchEnd),this.on(e.Event.CLICK,this,this._click),this.on(e.Event.RIGHT_CLICK,this,this._rightClick),this.on(e.Event.UNDISPLAY,this,this._removeFromStage)}destroy(){this._selectedController&&this._selectedController.release(),super.destroy()}get title(){return this._titleStr}set title(t){null==t&&(t=""),this._titleStr=t,super.title=this._selected&&this._selectedTitleStr?this._selectedTitleStr:t}get selectedTitle(){return this._selectedTitleStr}set selectedTitle(t){null==t&&(t=""),this._selectedTitleStr=t,super.title=this._selected&&this._selectedTitleStr?t:this._titleStr}get icon(){return this._iconStr}set icon(t){null==t&&(t=""),this._iconStr=t,super.icon=this._selected&&this._selectedIconStr?this._selectedIconStr:t}get selectedIcon(){return this._selectedIconStr}set selectedIcon(t){null==t&&(t=""),this._selectedIconStr=t,super.icon=this._selected&&this._selectedIconStr?t:this._iconStr}get downEffect(){return this._downEffect}set downEffect(t){this._downEffect=t}get sound(){return this._sound}set sound(t){this._sound=t}get soundVolumeScale(){return this._soundVolumeScale}set soundVolumeScale(t){this._soundVolumeScale=t}get selected(){return this._selected}set selected(e){this._mode!=t.ButtonMode.Common&&this._selected!=e&&(this._selected=e,this.setCurrentState(),this._selectedTitleStr&&this._titleWidget&&(this._titleWidget.p.text=this._selected?this._selectedTitleStr:this._titleStr),this._selectedIconStr&&this._iconWidget&&(this._iconWidget.p.icon=this._selected?this._selectedIconStr:this._iconStr),this._selectedController&&(this._selected?this._selectedController.selectedIndex=this._selectedPage:this._mode==t.ButtonMode.Check&&this._selectedController.selectedIndex==this._selectedPage&&(this._selectedController.oppositeIndex=this._selectedPage)))}get mode(){return this._mode}set mode(e){this._mode!=e&&(e==t.ButtonMode.Common&&(this.selected=!1),this._mode=e)}get selectedController(){return this._selectedController}set selectedController(t){this._selectedController&&this._selectedController.release(),this._selectedController=t,t&&(t.validate(),t.onChanged=this.selectChanged.bind(this),this.selectChanged())}get selectedPage(){return this._selectedPage}set selectedPage(t){this._selectedPage=t,this._selectedController&&(this.selected=this._selectedPage==this._selectedController.selectedIndex)}get changeStateOnClick(){return this._changeStateOnClick}set changeStateOnClick(t){this._changeStateOnClick=t}get mouseEnabled(){return super.mouseEnabled}set mouseEnabled(t){super.mouseEnabled=t,this.mouseEnabled||(this._over=!1,this.setCurrentState())}fireClick(i,s){this._mode===t.ButtonMode.Common&&(i?(this.setState(t.ButtonStatus.Over),e.Laya.timer.once(100,this,this.setState,[t.ButtonStatus.Down]),e.Laya.timer.once(200,null,()=>{this.setState(t.ButtonStatus.Up),(null==s||s)&&this.event(e.Event.CLICK)})):(null==s||s)&&this.event(e.Event.CLICK))}setState(i){if(this._buttonController){if(i>=this._buttonController.numPages&&null==(i=at[i]))return;this._buttonController.selectedIndex=i}if(this._downEffect==t.ButtonDownEffect.Dark){let s=i==t.ButtonStatus.Down||i==t.ButtonStatus.SelectedOver||i==t.ButtonStatus.SelectedDisabled;dt||(dt=new e.Color);for(let t of this.children)t instanceof nt&&(s?(t[_t]=t.color,dt.parse(t.color),dt.r*=.8,dt.g*=.8,dt.b*=.8,t.color=dt.toString()):t[_t]&&(t.color=t[_t]))}else if(this._downEffect==t.ButtonDownEffect.UpScale||this._downEffect==t.ButtonDownEffect.DownScale){let e=this._downEffect==t.ButtonDownEffect.DownScale?.9:1/.9;i==t.ButtonStatus.Down||i==t.ButtonStatus.SelectedOver||i==t.ButtonStatus.SelectedDisabled?this._scaleEffect||(this.scale(this.scaleX*e,this.scaleY*e),this._scaleEffect=!0):this._scaleEffect&&(this.scale(this.scaleX/e,this.scaleY/e),this._scaleEffect=!1)}}setCurrentState(){this._selected?this.setState(this.grayed?t.ButtonStatus.SelectedDisabled:this._over?t.ButtonStatus.SelectedOver:t.ButtonStatus.Down):this.setState(this.grayed?t.ButtonStatus.Disabled:this._over?t.ButtonStatus.Over:t.ButtonStatus.Up)}_controllersChanged(){super._controllersChanged();let t=this.getController("button");this._buttonController!=t&&(this._buttonController=t,this.setCurrentState())}_onPartChanged(t){"title"==t?this._titleStr&&(this.title=this._titleStr):"icon"==t&&this._iconStr&&(this.icon=this._iconStr)}selectChanged(){this.selected=this._selectedPage==this._selectedController.selectedIndex}_rollover(){this._over=!0,this._down||this.grayed||this.setState(this._selected?t.ButtonStatus.SelectedOver:t.ButtonStatus.Over)}_rollout(){this._over=!1,this._down||this.grayed||this.setState(this._selected?t.ButtonStatus.Down:t.ButtonStatus.Up)}_btnTouchBegin(e){0==e.button&&(this._down=!0,this._mode==t.ButtonMode.Common&&this.setState(this.grayed?t.ButtonStatus.SelectedDisabled:t.ButtonStatus.Down))}_btnTouchEnd(){this._down&&(this._down=!1,this._mode==t.ButtonMode.Common?this.setState(this.grayed?t.ButtonStatus.Disabled:this._over?t.ButtonStatus.Over:t.ButtonStatus.Up):this._over||!this._buttonController||this._buttonController.selectedIndex!=t.ButtonStatus.Over&&this._buttonController.selectedIndex!=t.ButtonStatus.SelectedOver||this.setCurrentState())}_removeFromStage(){this._over&&this._rollout()}_click(i){var s;this._sound&&(e.SoundManager.playSound(this._sound).volume=this._soundVolumeScale);let h=null===(s=this.parent)||void 0===s?void 0:s.selection;h&&h.mode!=t.SelectionMode.None&&(h.handleClick(this,i),this._mode!=t.ButtonMode.Common)||(this._mode==t.ButtonMode.Check?this._changeStateOnClick&&(this.selected=!this._selected,this.event(e.Event.CHANGED)):this._mode==t.ButtonMode.Radio?this._changeStateOnClick&&!this._selected&&(this.selected=!0,this.event(e.Event.CHANGED)):this._selectedController&&(this._selectedController.selectedIndex=this._selectedPage))}_rightClick(e){let i=this.parent.selection;i&&i.mode!=t.SelectionMode.None&&i.handleClick(this,e)}}class ut extends lt{constructor(){super(),this.popupDirection=0,this.visibleItemCount=0,this._itemsUpdated=!0,this._selectedIndex=-1,this._items=[],this._icons=[],this._values=[],this.on(e.Event.ROLL_OVER,this,this._rollover),this.on(e.Event.ROLL_OUT,this,this._rollout),this.on(e.Event.MOUSE_DOWN,this,this._mousedown),this.on(e.Event.MOUSE_UP,this,this._mouseup)}get items(){return this._items}set items(t){let i=this._items;i.length=0,t&&i.push(...t),this._itemsUpdated=!0,e.SerializeUtil.isDeserializing||(i.length>0?(this._selectedIndex>=i.length?this._selectedIndex=i.length-1:-1==this._selectedIndex&&(this._selectedIndex=0),this.title=i[this._selectedIndex],this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.title="",this._icons&&(this.icon=null),this._selectedIndex=-1))}get icons(){return this._icons}set icons(t){let i=this._icons;i.length=0,t&&i.push(...t),this._itemsUpdated=!0,e.SerializeUtil.isDeserializing||-1!=this._selectedIndex&&this._selectedIndex<i.length&&(this.icon=i[this._selectedIndex])}get values(){return this._values}set values(t){this._values.length=0,t&&this._values.push(...t),this._itemsUpdated=!0}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){var e;if(this._selectedIndex==t)return;this._selectedIndex=t,t>=0&&t<this._items.length?(this.title=this._items[t],t<this._icons.length&&(this.icon=this._icons[t])):(this.title="",this._icons&&(this.icon=""));let i=null===(e=this._selectedController)||void 0===e?void 0:e.inst;null!=i&&t>=0&&t<i.numPages&&!i.changing&&(this._selectedController.selectedIndex=t)}get value(){return this._values[this._selectedIndex]}set value(t){let e=this._values.indexOf(t);-1==e&&null==t&&(e=this._values.indexOf("")),this.selectedIndex=e}get dropdownRes(){return this._dropdownRes}set dropdownRes(t){this._dropdownRes=t,this._getBit(e.NodeFlags.EDITING_NODE)||this.createDropdown()}get dropdown(){return this._dropdown}get selectedController(){return this._selectedController}set selectedController(t){this._selectedController&&this._selectedController.release(),this._selectedController=t,t&&(t.validate(),t.onChanged=this.selectChanged.bind(this),this.selectChanged())}destroy(){this._dropdown&&(this._dropdown.destroy(),this._dropdown=null),this._selectedController&&this._selectedController.release(),super.destroy()}updateList(){this._dropdown.stage&&(this._updateDropDown(),this._list.layout.refresh(),U.inst.popupMgr.validatePopupPosition(this._dropdown,this,this.popupDirection))}createDropdown(){if(this._dropdown&&(this._dropdown.destroy(),this._dropdown=null,this._list=null),this._dropdownRes){if(this._dropdown=this._dropdownRes.create(),this._list=this._dropdown.getChild("list"),null==this._list)return void console.warn(this._dropdownRes.url+": should container a list component named list.");this._list.on(t.UIEvent.ClickItem,this,this._clickItem),this._list.addRelation(this._dropdown,t.RelationType.Width),this._list.removeRelation(this._dropdown,t.RelationType.Height),this._dropdown.addRelation(this._list,t.RelationType.Height),this._dropdown.removeRelation(this._list,t.RelationType.Width),this._dropdown.on(e.Event.UNDISPLAY,this,this._popupWinClosed)}}_controllersChanged(){super._controllersChanged();let t=this.getController("button");this._buttonController!=t&&(this._buttonController=t,this._buttonController.numPages>0&&this.setCurrentState())}selectChanged(){this.selectedIndex=this._selectedController.selectedIndex}setState(t){if(this._buttonController){if(t>=this._buttonController.numPages&&null==(t=at[t]))return;this._buttonController.selectedIndex=t}}setCurrentState(){let e=this._dropdown&&this._dropdown.displayedInStage?t.ButtonStatus.Down:this._over?t.ButtonStatus.Over:t.ButtonStatus.Up;this.setState(this.grayed?t.ButtonStatus.Disabled:e)}showDropdown(){this._dropdown?U.inst.popupMgr.isPopupJustClosed(this._dropdown)||(this.event(t.UIEvent.Popup),this._itemsUpdated&&this._updateDropDown(),this._list.selection.index=-1,this._dropdown.width=this.width,this._list.layout.refresh(),U.inst.popupMgr.showPopup(this._dropdown,this,this.popupDirection),this.setState(t.ButtonStatus.Down)):this.setState(t.ButtonStatus.Down)}_updateDropDown(){this._itemsUpdated=!1,this._list.removeChildrenToPool();let t=this._items.length;for(let e=0;e<t;e++){let t=this._list.addItemFromPool();t.name=e<this._values.length?this._values[e]:"",t.text=this._items[e],t.icon=e<this._icons.length?this._icons[e]:""}this._list.resizeToFit(this.visibleItemCount>0?this.visibleItemCount:R.defaultComboBoxVisibleItemCount)}_popupWinClosed(){this.setCurrentState()}_clickItem(t){U.inst.popupMgr.hidePopup(this._dropdown),this._selectedIndex=-1,this.selectedIndex=this._list.getChildIndex(t),this.event(e.Event.CHANGED)}_rollover(){this._over=!0,this._down||this._dropdown&&this._dropdown.parent||this.setCurrentState()}_rollout(){this._over=!1,this._down||this._dropdown&&this._dropdown.parent||this.setCurrentState()}_mousedown(t){t.target instanceof e.Input||(this._down=!0,this.showDropdown())}_mouseup(){this._down&&(this._down=!1,this.setCurrentState())}}class gt{constructor(){this._count=0,this._items={}}clear(){for(let t in this._items){this._items[t].forEach(t=>t.destroy())}this._items={},this._count=0}get count(){return this._count}get defaultRes(){return this._defaultRes}set defaultRes(t){this._defaultRes=t,t&&!t.url&&(t.url="data:"+pt++)}get defaultRuntime(){return this._defaultRuntime}set defaultRuntime(t){this._defaultRuntime=t,this._createOptions=t?{runtime:t}:null}take(t){var i;if(!t&&!(t=null===(i=this._defaultRes)||void 0===i?void 0:i.url))return console.warn("set defaultRes first!"),null;let s,h=this._items[t];return h&&h.length>0?(this._count--,h.shift()):(s=t.startsWith("data:")?this._defaultRes.create(this._createOptions):e.Loader.getRes(t).create(this._createOptions),s&&(s.hideFlags|=e.HideFlags.HideAndDontSave),s)}recover(t){let e=t.url;if(!e)return void t.destroy();let i=this._items[e];i||(i=[],this._items[e]=i),this._count++,i.push(t)}}var pt=0;class ft extends X{constructor(){super(...arguments),this._lineItemCnt=0,this._numItems=0,this._itemSize=new e.Point,this._firstIndex=0,this._changed=0,this._itemInfoVer=0}get numItems(){return this._virtual?this._numItems:this._owner.children.length}set numItems(t){if(this._virtual){if(null==this._owner.itemRenderer)throw new Error("set itemRenderer first!");this._numItems=t,this._loop?this._realNumItems=6*this._numItems:this._realNumItems=this._numItems;let i=this._items.length;if(this._realNumItems>i)for(let t=i;t<this._realNumItems;t++){let t={width:0,height:0,flag:0};t.width=this._itemSize.x,t.height=this._itemSize.y,this._items.push(t)}else for(let t=this._realNumItems;t<i;t++)this._items[t].selected=!1;0!==this._changed&&e.ILaya.timer.clearCallLater(this,this._refreshVirtualList),this._refreshVirtualList()}else{let e=this._owner.children.length;if(t>e)for(let i=e;i<t;i++)this._owner.itemProvider?this._owner.addItemFromPool(this._owner.itemProvider(i)):this._owner.addItemFromPool();else this._owner.removeChildrenToPool(t,e);if(this._owner.itemRenderer)for(let e=0;e<t;e++)this._owner.itemRenderer(e,this._owner.getChildAt(e))}}get itemSize(){return this._itemSize}set itemSize(i){this._itemSize.setTo(i.x,i.y),this._virtual&&(this._type===t.LayoutType.SingleColumn||this._type===t.LayoutType.FlowX?this._owner.scroller.step=this._itemSize.y:this._owner.scroller.step=this._itemSize.x,this._changed=2,e.ILaya.timer.callLater(this,this._refreshVirtualList))}_setVirtual(i){if(!this._virtual){if(this._virtual=!0,this._loop=i,this._items=[],this._itemSizes=[],this._owner.removeChildrenToPool(),0===this._itemSize.x&&0===this._itemSize.y){let t=this._owner.getFromPool();if(null==t)throw new Error("Virtual List must have a default list item resource.");this._itemSize.x=t.width,this._itemSize.y=t.height,this._owner.returnToPool(t)}this._owner.itemPool.clear(),this._type===t.LayoutType.SingleColumn||this._type===t.LayoutType.FlowX?(this._owner.scroller.step=this._itemSize.y,this._loop&&(this._owner.scroller._loop=2)):(this._owner.scroller.step=this._itemSize.x,this._loop&&(this._owner.scroller._loop=1)),this._owner.on(t.UIEvent.Scroll,this,this._scrolled),this._changed=2,e.ILaya.timer.callLater(this,this._refreshVirtualList)}}childIndexToItemIndex(t){if(!this._virtual)return t;if(this._pageMode){for(let e=this._firstIndex;e<this._realNumItems;e++)if(this._items[e].obj&&--t<0)return e;return t}return t+=this._firstIndex,this._loop&&this._numItems>0&&(t%=this._numItems),t}itemIndexToChildIndex(t){if(!this._virtual)return t;if(this._pageMode)return this._owner.getChildIndex(this._items[t].obj);if(this._loop&&this._numItems>0){let e=this._firstIndex%this._numItems;t>=e?t-=e:t=this._numItems-e+t}else t-=this._firstIndex;return t}shouldSnapToNext(t,e,i){return t<0&&e>R.defaultScrollSnappingThreshold*i||t>0&&e>(1-R.defaultScrollSnappingThreshold)*i||0===t&&e>i/2}getSnappingPosition(i,s,h,r,o){if(this._virtual){if(o||(o=new e.Point),this._type===t.LayoutType.SingleColumn||(this._pageMode?this._type===t.LayoutType.FlowY:this._type===t.LayoutType.FlowX)){let t=s;wt=s;let e=this.getIndexOnPos1(!1);if(s=wt,e<this._items.length&&e<this._realNumItems){let i=this._items[e].height;this.shouldSnapToNext(r,t-s,i)&&(s+=i+this._rowGap)}}else{let t=i;wt=i;let e=this.getIndexOnPos2(!1);if(i=wt,e<this._items.length&&e<this._realNumItems){let s=this._items[e].width;this.shouldSnapToNext(h,t-i,s)&&(i+=s+this._columnGap)}}return o.x=i,o.y=s,o}return super.getSnappingPosition(i,s,h,r,o)}getRectByItemIndex(i){if(!this._virtual||0===this._numItems)return new e.Rectangle;if(this._checkVirtualList(),i>=this._items.length)throw new Error("Invalid child index: "+i+">"+this._items.length);let s;this._loop&&(i=Math.floor(this._firstIndex/this._numItems)*this._numItems+i);let h=this._items[i],r=0;if(this._type===t.LayoutType.SingleColumn||this._type===t.LayoutType.FlowX){for(let t=this._lineItemCnt-1;t<i;t+=this._lineItemCnt)r+=this._items[t].height+this._rowGap;s=new e.Rectangle(0,r,this._itemSize.x,h.height)}else{for(let t=this._lineItemCnt-1;t<i;t+=this._lineItemCnt)r+=this._items[t].width+this._columnGap;s=new e.Rectangle(r,0,h.width,this._itemSize.y)}return s}setChangedFlag(t){super.setChangedFlag(t),this._layoutChanged&&null==t&&this._virtual&&(this._changed=2,e.ILaya.timer.callLater(this,this._refreshVirtualList))}refresh(t){this._virtual||super.refresh(t)}_checkVirtualList(){0!==this._changed&&(this._refreshVirtualList(),e.ILaya.timer.clearCallLater(this,this._refreshVirtualList))}refreshVirtualList(){0===this._changed&&(this._changed=1),e.ILaya.timer.callLater(this,this._refreshVirtualList)}getColumns(){return this._columns>0?this._columns:Math.max(1,Math.floor((this.viewWidth+this._columnGap)/(this._itemSize.x+this._columnGap)))}getRows(){return this._rows>0?this._rows:Math.max(1,Math.floor((this.viewHeight+this._rowGap)/(this._itemSize.y+this._rowGap)))}_refreshVirtualList(){if(this._owner.destroyed)return;let e=2===this._changed;this._changed=0,this._eventLocked=!0;let i=this.viewWidth,s=this.viewHeight;if(e)if(this._lineItemCnt=1,this._lineItemCnt2=1,this._type===t.LayoutType.FlowX?(this._lineItemCnt=this.getColumns(),this._pageMode&&(this._lineItemCnt2=this.getRows())):this._type===t.LayoutType.FlowY&&(this._lineItemCnt=this.getRows(),this._pageMode&&(this._lineItemCnt2=this.getColumns())),this._itemSizes.length=0,this._type===t.LayoutType.SingleColumn||this._type===t.LayoutType.FlowX){if(this._stretchX===t.StretchMode.Stretch){for(let t=0;t<this._lineItemCnt;t++)this._itemSizes[t]=this._itemSize.x;this.handleStrecth(i,this._lineItemCnt,this._columnGap,this.stretchParamsX,this._itemSizes)}}else if(this._stretchY===t.StretchMode.Stretch){for(let t=0;t<this._lineItemCnt;t++)this._itemSizes[t]=this._itemSize.y;this.handleStrecth(s,this._lineItemCnt,this._rowGap,this.stretchParamsY,this._itemSizes)}let h=0,r=0;if(this._realNumItems>0){let e=Math.ceil(this._realNumItems/this._lineItemCnt)*this._lineItemCnt,o=Math.min(this._lineItemCnt,this._realNumItems);if(this._pageMode){let o=Math.ceil(e/(this._lineItemCnt*this._lineItemCnt2));this._type===t.LayoutType.SingleRow||this._type===t.LayoutType.FlowX?(r=o*i,h=s):(r=i,h=o*s)}else if(this._type===t.LayoutType.SingleColumn||this._type===t.LayoutType.FlowX){for(let t=0;t<e;t+=this._lineItemCnt)h+=this._items[t].height+this._rowGap;if(h>0&&(h-=this._rowGap),this._stretchX===t.StretchMode.Stretch)r=i;else{for(let t=0;t<o;t++)r+=this._items[t].width+this._columnGap;r>0&&(r-=this._columnGap)}}else{for(let t=0;t<e;t+=this._lineItemCnt)r+=this._items[t].width+this._columnGap;if(r>0&&(r-=this._columnGap),this._stretchY===t.StretchMode.Stretch)h=s;else{for(let t=0;t<o;t++)h+=this._items[t].height+this._rowGap;h>0&&(h-=this._rowGap)}}this._offsetX=0,this._offsetY=0,r<i&&(1===this._align?this._offsetX=(i-r)/2:2===this._align&&(this._offsetX=i-r),this._owner.scroller||(this._offsetX+=this._padding[3])),h<s&&(1===this._valign?this._offsetY=(s-h)/2:2===this._valign&&(this._offsetY=s-h),this._owner.scroller||(this._offsetY+=this._padding[0]))}this.setContentSize(r,h),this._eventLocked=!1,this.handleScroll(!0)}_scrolled(){this.handleScroll(!1)}getIndexOnPos1(t){if(this._realNumItems<this._lineItemCnt)return wt=0,0;if(this._owner.numChildren>0&&!t){let t=this._owner.getChildAt(0).top;if(t>wt){for(let e=this._firstIndex-this._lineItemCnt;e>=0;e-=this._lineItemCnt)if(t-=this._items[e].height+this._rowGap,t<=wt)return wt=t,e;return wt=0,0}for(let e=this._firstIndex;e<this._realNumItems;e+=this._lineItemCnt){let i=t+this._items[e].height+this._rowGap;if(i>wt)return wt=t,e;t=i}return wt=t,this._realNumItems-this._lineItemCnt}{let t=0;for(let e=0;e<this._realNumItems;e+=this._lineItemCnt){let i=t+this._items[e].height+this._rowGap;if(i>wt)return wt=t,e;t=i}return wt=t,this._realNumItems-this._lineItemCnt}}getIndexOnPos2(t){if(this._realNumItems<this._lineItemCnt)return wt=0,0;if(this._owner.numChildren>0&&!t){let t=this._owner.getChildAt(0).left;if(t>wt){for(let e=this._firstIndex-this._lineItemCnt;e>=0;e-=this._lineItemCnt)if(t-=this._items[e].width+this._columnGap,t<=wt)return wt=t,e;return wt=0,0}for(let e=this._firstIndex;e<this._realNumItems;e+=this._lineItemCnt){let i=t+this._items[e].width+this._columnGap;if(i>wt)return wt=t,e;t=i}return wt=t,this._realNumItems-this._lineItemCnt}{let t=0;for(let e=0;e<this._realNumItems;e+=this._lineItemCnt){let i=t+this._items[e].width+this._columnGap;if(i>wt)return wt=t,e;t=i}return wt=t,this._realNumItems-this._lineItemCnt}}getIndexOnPos3(t){if(this._realNumItems<this._lineItemCnt)return wt=0,0;let e=this.viewWidth,i=Math.floor(wt/e),s=i*(this._lineItemCnt*this._lineItemCnt2),h=i*e;for(let t=0;t<this._lineItemCnt;t++){let e=h+this._items[s+t].width+this._columnGap;if(e>wt)return wt=h,s+t;h=e}return wt=h,s+this._lineItemCnt-1}getIndexOnPos4(t){if(this._realNumItems<this._lineItemCnt)return wt=0,0;let e=this.viewHeight,i=Math.floor(wt/e),s=i*(this._lineItemCnt*this._lineItemCnt2),h=i*e;for(let t=0;t<this._lineItemCnt;t++){let e=h+this._items[s+t].height+this._rowGap;if(e>wt)return wt=h,s+t;h=e}return wt=h,s+this._lineItemCnt-1}handleScroll(e){if(!this._eventLocked){if(this._pageMode)this._type===t.LayoutType.SingleRow||this._type===t.LayoutType.FlowX?this.handleScroll3(e):this.handleScroll4(e);else if(this._type===t.LayoutType.SingleColumn||this._type===t.LayoutType.FlowX){let t=0;for(;this.handleScroll1(e);)if(t++,e=!1,t>20){console.log("list will never be <the> filled item renderer function always returns a different size.");break}}else{let t=0;for(;this.handleScroll2(e);)if(t++,e=!1,t>20){console.log("list will never be <the> filled item renderer function always returns a different size.");break}}this._layoutChanged=!1}}handleScroll1(e){let i=this._owner.scroller,s=i.scrollingPosY,h=s+i.viewHeight,r=h===i.contentHeight;wt=s;let o=this.getIndexOnPos1(e);if(s=wt,o===this._firstIndex&&!e)return!1;let l=this._firstIndex;this._firstIndex=o;let n,a=o,_=l>o,d=this._owner.numChildren,c=l+d-1,u=_?c:l,g=0,p=s,f=0,w=0,m=this._owner.itemPool,y=m.defaultRes.url;for(this._itemInfoVer++;a<this._realNumItems&&(r||p<h);){let i=this._items[a];if((null==i.obj||e)&&(this._owner.itemProvider&&(y=this._owner.itemProvider(a%this._numItems),y||(y=m.defaultRes.url)),i.obj&&i.obj.url!=y&&(i.obj instanceof ct&&(i.selected=i.obj.selected),this._owner.removeChildToPool(i.obj),i.obj=null)),null==i.obj){if(_)for(let t=u;t>=l;t--){let e=this._items[t];if(e.obj&&e.flag!==this._itemInfoVer&&e.obj.url==y){e.obj instanceof ct&&(e.selected=e.obj.selected),i.obj=e.obj,e.obj=null,t===u&&u--;break}}else for(let t=u;t<=c;t++){let e=this._items[t];if(e.obj&&e.flag!==this._itemInfoVer&&e.obj.url==y){e.obj instanceof ct&&(e.selected=e.obj.selected),i.obj=e.obj,e.obj=null,t===u&&u++;break}}i.obj?this._owner.setChildIndex(i.obj,_?a-o:this._owner.numChildren):(i.obj=m.take(y),_?this._owner.addChildAt(i.obj,a-o):this._owner.addChild(i.obj)),i.obj instanceof ct&&(i.obj.selected=i.selected),n=!0}else n=e;if(n){let e=a%this._lineItemCnt;this._stretchX===t.StretchMode.Stretch&&i.obj.size(this._itemSizes[e],i.obj.height),this._owner.itemRenderer(a%this._numItems,i.obj),X.refreshAllLayouts(this._owner),0===e&&(f+=Math.ceil(i.obj.height)-i.height,a===o&&l>o&&(w=Math.ceil(i.obj.height)-i.height)),i.width=Math.ceil(i.obj.width),i.height=Math.ceil(i.obj.height)}i.flag=this._itemInfoVer,i.obj.setLeftTop(this._offsetX+g,p),a===o&&(h+=i.height),g+=i.width+this._columnGap,a%this._lineItemCnt===this._lineItemCnt-1&&(g=0,p+=i.height+this._rowGap),a++}for(let t=0;t<d;t++){let e=this._items[l+t];e.flag!==this._itemInfoVer&&e.obj&&(e.obj instanceof ct&&(e.selected=e.obj.selected),this._owner.removeChildToPool(e.obj),e.obj=null)}d=this._owner.children.length;let S=0;for(let t=0;t<d;t++){let e=this._items[o+t].obj;this._owner.children[t]!=e&&this._owner.setChildIndex(e,t);let i=e.width;i>S&&(S=i)}let x,v=0;if(this._type===t.LayoutType.SingleColumn&&0!==(x=i._shouldCheckOverflow())){let t;if(2&x&&(v=S-i.contentWidth,t=Math.abs(v)>=1),1&x&&i.contentHeight<i.viewHeight&&S<=i.viewWidth&&(S=i.viewWidth+i.vScrollBar.width,t=!0),t)for(let t=0;t<d;t++){this._owner.children[t].width=S}}return 0===v&&0===f&&0===w||i._changeContentSizeOnScrolling(v,f,0,w),a>0&&this._owner.numChildren>0&&this._owner._$container.y<=0&&this._owner.getChildAt(0).top>-this._owner._$container.y}handleScroll2(e){let i=this._owner.scroller.scrollingPosX,s=i+this._owner.scroller.viewWidth,h=s===this._owner.scroller.contentWidth;wt=i;let r=this.getIndexOnPos2(e);if(i=wt,r===this._firstIndex&&!e)return!1;let o=this._firstIndex;this._firstIndex=r;let l,n=r,a=o>r,_=this._owner.numChildren,d=o+_-1,c=a?d:o,u=i,g=0,p=0,f=0,w=this._owner.itemPool,m=w.defaultRes.url;for(this._itemInfoVer++;n<this._realNumItems&&(h||u<s);){let i=this._items[n];if((null==i.obj||e)&&(this._owner.itemProvider&&(m=this._owner.itemProvider(n%this._numItems),m||(m=w.defaultRes.url)),i.obj&&i.obj.url!=m&&(i.obj instanceof ct&&(i.selected=i.obj.selected),this._owner.removeChildToPool(i.obj),i.obj=null)),null==i.obj){if(a)for(let t=c;t>=o;t--){let e=this._items[t];if(e.obj&&e.flag!==this._itemInfoVer&&e.obj.url==m){e.obj instanceof ct&&(e.selected=e.obj.selected),i.obj=e.obj,e.obj=null,t===c&&c--;break}}else for(let t=c;t<=d;t++){let e=this._items[t];if(e.obj&&e.flag!==this._itemInfoVer&&e.obj.url==m){e.obj instanceof ct&&(e.selected=e.obj.selected),i.obj=e.obj,e.obj=null,t===c&&c++;break}}i.obj?this._owner.setChildIndex(i.obj,a?n-r:this._owner.numChildren):(i.obj=w.take(m),a?this._owner.addChildAt(i.obj,n-r):this._owner.addChild(i.obj)),i.obj instanceof ct&&(i.obj.selected=i.selected),l=!0}else l=e;if(l){let e=n%this._lineItemCnt;this._stretchY===t.StretchMode.Stretch&&i.obj.size(i.obj.width,this._itemSizes[e]),this._owner.itemRenderer(n%this._numItems,i.obj),X.refreshAllLayouts(this._owner),0==e&&(p+=Math.ceil(i.obj.width)-i.width,n===r&&o>r&&(f=Math.ceil(i.obj.width)-i.width)),i.width=Math.ceil(i.obj.width),i.height=Math.ceil(i.obj.height)}i.flag=this._itemInfoVer,i.obj.setLeftTop(u,this._offsetY+g),n===r&&(s+=i.width),g+=i.height+this._rowGap,n%this._lineItemCnt===this._lineItemCnt-1&&(g=0,u+=i.width+this._columnGap),n++}for(let t=0;t<_;t++){let e=this._items[o+t];e.flag!==this._itemInfoVer&&e.obj&&(e.obj instanceof ct&&(e.selected=e.obj.selected),this._owner.removeChildToPool(e.obj),e.obj=null)}_=this._owner.numChildren;for(let t=0;t<_;t++){let e=this._items[r+t].obj;this._owner.children[t]!=e&&this._owner.setChildIndex(e,t)}return 0===p&&0===f||this._owner.scroller._changeContentSizeOnScrolling(p,0,f,0),n>0&&this._owner.numChildren>0&&this._owner._$container.x<=0&&this._owner.getChildAt(0).left>-this._owner._$container.x}handleScroll3(e){let i=this._owner.scroller.scrollingPosX;wt=i;let s=this.getIndexOnPos3(e);if(i=wt,s===this._firstIndex&&!e)return;let h=this._firstIndex;this._firstIndex=s;let r,o,l,n=h,a=this._items.length,_=this._lineItemCnt*this._lineItemCnt2,d=s%this._lineItemCnt,c=this.viewWidth,u=this.viewHeight,g=Math.floor(s/_)*_,p=g+2*_;this._stretchX!==t.StretchMode.Stretch&&this._stretchY!==t.StretchMode.Stretch||(this._lineItemCnt===this._columns&&(o=(c-this._columnGap*(this._lineItemCnt-1))/this._lineItemCnt),this._lineItemCnt2===this._rows&&(l=(u-this._rowGap*(this._lineItemCnt2-1))/this._lineItemCnt2));let f=this._owner.itemPool,w=f.defaultRes.url;this._itemInfoVer++;for(let t=g;t<p;t++){if(t>=this._realNumItems)continue;let e=t%this._lineItemCnt;if(t-g<_){if(e<d)continue}else if(e>d)continue;this._items[t].flag=this._itemInfoVer}let m=null,y=0;for(let t=g;t<p;t++){if(t>=this._realNumItems)continue;let i=this._items[t];if(i.flag===this._itemInfoVer){if(null==i.obj){for(;n<a;){let t=this._items[n];if(t.obj&&t.flag!==this._itemInfoVer){t.obj instanceof ct&&(t.selected=t.obj.selected),i.obj=t.obj,t.obj=null;break}n++}-1===y&&(y=this._owner.getChildIndex(m)+1),null==i.obj?(this._owner.itemProvider&&(w=this._owner.itemProvider(t%this._numItems),w||(w=f.defaultRes.url)),i.obj=f.take(w),this._owner.addChildAt(i.obj,y)):y=this._owner.setChildIndexBefore(i.obj,y),y++,i.obj instanceof ct&&(i.obj.selected=i.selected),r=!0}else r=e,y=-1,m=i.obj;r&&(null==o&&null==l||i.obj.size(null!=o?o:i.obj.width,null!=l?l:i.obj.height),this._owner.itemRenderer(t%this._numItems,i.obj),X.refreshAllLayouts(this._owner),i.width=Math.ceil(i.obj.width),i.height=Math.ceil(i.obj.height))}}let S=g/_*c,x=S,v=0,C=0;for(let t=g;t<p;t++){if(t>=this._realNumItems)continue;let e=this._items[t];e.flag===this._itemInfoVer&&e.obj.setLeftTop(x,v),e.height>C&&(C=e.height),t%this._lineItemCnt===this._lineItemCnt-1?(x=S,v+=C+this._rowGap,C=0,t===g+_-1&&(S+=c,x=S,v=0)):x+=e.width+this._columnGap}for(let t=n;t<a;t++){let e=this._items[t];e.flag!==this._itemInfoVer&&e.obj&&(e.obj instanceof ct&&(e.selected=e.obj.selected),this._owner.removeChildToPool(e.obj),e.obj=null)}}handleScroll4(e){let i=this._owner.scroller.scrollingPosY;wt=i;let s=this.getIndexOnPos4(e);if(i=wt,s===this._firstIndex&&!e)return;let h=this._firstIndex;this._firstIndex=s;let r,o,l,n=h,a=this._items.length,_=this._lineItemCnt*this._lineItemCnt2,d=s%this._lineItemCnt,c=this.viewWidth,u=this.viewHeight,g=Math.floor(s/_)*_,p=g+2*_;this._stretchX!==t.StretchMode.Stretch&&this._stretchY!==t.StretchMode.Stretch||(this._lineItemCnt2===this._columns&&(o=(c-this._columnGap*(this._lineItemCnt2-1))/this._lineItemCnt2),this._lineItemCnt===this._rows&&(l=(u-this._rowGap*(this._lineItemCnt-1))/this._lineItemCnt));let f=this._owner.itemPool,w=f.defaultRes.url;this._itemInfoVer++;for(let t=g;t<p;t++){if(t>=this._realNumItems)continue;let e=t%this._lineItemCnt;if(t-g<_){if(e<d)continue}else if(e>d)continue;this._items[t].flag=this._itemInfoVer}let m=null,y=0;for(let t=g;t<p;t++){if(t>=this._realNumItems)continue;let i=this._items[t];if(i.flag===this._itemInfoVer){if(null==i.obj){for(;n<a;){let t=this._items[n];if(t.obj&&t.flag!==this._itemInfoVer){t.obj instanceof ct&&(t.selected=t.obj.selected),i.obj=t.obj,t.obj=null;break}n++}-1===y&&(y=this._owner.getChildIndex(m)+1),null==i.obj?(this._owner.itemProvider&&(w=this._owner.itemProvider(t%this._numItems),w||(w=f.defaultRes.url)),i.obj=f.take(w),this._owner.addChildAt(i.obj,y)):y=this._owner.setChildIndexBefore(i.obj,y),y++,i.obj instanceof ct&&(i.obj.selected=i.selected),r=!0}else r=e,y=-1,m=i.obj;r&&(null==o&&null==l||i.obj.size(null!=o?o:i.obj.width,null!=l?l:i.obj.height),this._owner.itemRenderer(t%this._numItems,i.obj),X.refreshAllLayouts(this._owner),i.width=Math.ceil(i.obj.width),i.height=Math.ceil(i.obj.height))}}let S=g/_*u,x=0,v=S,C=0;for(let t=g;t<p;t++){if(t>=this._realNumItems)continue;let e=this._items[t];e.flag===this._itemInfoVer&&e.obj.setLeftTop(x,v),e.width>C&&(C=e.width),t%this._lineItemCnt===this._lineItemCnt-1?(x+=C+this._columnGap,v=S,C=0,t===g+_-1&&(S+=u,x=0,v=S)):v+=e.height+this._rowGap}for(let t=n;t<a;t++){let e=this._items[t];e.flag!==this._itemInfoVer&&e.obj&&(e.obj instanceof ct&&(e.selected=e.obj.selected),this._owner.removeChildToPool(e.obj),e.obj=null)}}}let wt=0;class mt{constructor(t){this.scrollItemToViewOnClick=!1,this.allowSelectByRightClick=!0,this._mode=0,this._lastIndex=0,this._owner=t,this._lastIndex=-1}get mode(){return this._mode}set mode(t){this._mode=t}get index(){return this._owner.children.findIndex(t=>t instanceof ct&&t.selected)}set index(e){e>=0&&e<this._owner.numChildren?(this._mode!=t.SelectionMode.Single&&this.clear(),this.add(e)):this.clear()}get controller(){return this._controller}set controller(t){this._controller&&this._controller.release(),this._controller=t,t&&(t.validate(),t.onChanged=this.selectChanged.bind(this),this.selectChanged())}get(t){t||(t=[]);for(let e=0,i=this._owner.children.length;e<i;e++){let i=this._owner.children[e];i instanceof ct&&i.selected&&t.push(e)}return t}add(i,s){var h;if(this._mode==t.SelectionMode.Disabled)return;let r;this._mode==t.SelectionMode.Single&&this.clear(),s&&(null===(h=this._owner.scroller)||void 0===h||h.scrollTo(i)),this._lastIndex=i,r=this._owner._getBit(e.NodeFlags.EDITING_NODE)?this._owner.children.filter(t=>!t._extra.isTemplateNode)[i]:this._owner.getChildAt(i),r instanceof ct&&!r.selected&&(r.selected=!0),this.syncController(i)}remove(i){if(this._mode==t.SelectionMode.Disabled)return;let s;s=this._owner._getBit(e.NodeFlags.EDITING_NODE)?this._owner.children.filter(t=>!t._extra.isTemplateNode)[i]:this._owner.getChildAt(i),s instanceof ct&&(s.selected=!1)}clear(){for(let t of this._owner.children)t instanceof ct&&!t._extra.isTemplateNode&&(t.selected=!1)}clearExcept(t){for(let e of this._owner.children)e instanceof ct&&e!=t&&!e._extra.isTemplateNode&&(e.selected=!1)}selectAll(){for(let t of this._owner.children)t instanceof ct&&!t.selected&&(t.selected=!0)}selectReverse(){for(let t of this._owner.children)t instanceof ct&&(t.selected=!t.selected)}enableFocusEvents(t){this._triggerFocusEvents!=t&&(this._triggerFocusEvents=t)}handleFocus(t){let e="focus_in"==t.type?"list_focus_in":"list_focus_out";for(let t of this._owner.children)t instanceof ct&&t.selected&&t.event(e)}handleClick(i,s){let h=this._owner.scroller;if(null==h?void 0:h.isDragged)return;if(2==s.button&&!this.allowSelectByRightClick)return;if(i.mode==t.ButtonMode.Common)return void this._owner.event(t.UIEvent.ClickItem,[i,s]);let r=!1,o=this._owner.getChildIndex(i);if(this._mode==t.SelectionMode.Disabled);else if(this._mode==t.SelectionMode.Single)i.selected||(this.clearExcept(i),i.selected=!0,i.event(e.Event.CHANGED));else if(s.shiftKey){if(!i.selected)if(-1!=this._lastIndex){let t=Math.min(this._lastIndex,o),s=Math.max(this._lastIndex,o);s=Math.min(s,this._owner.numChildren-1);for(let h=t;h<=s;h++){let t=this._owner.getChildAt(h);t instanceof ct&&(t.selected=!0,t==i&&i.event(e.Event.CHANGED))}r=!0}else i.selected=!0,i.event(e.Event.CHANGED)}else s.ctrlKey||s.metaKey||this._mode==t.SelectionMode.MultipleBySingleClick?(i.selected=!i.selected,i.event(e.Event.CHANGED)):i.selected?0==s.button&&this.clearExcept(i):(this.clearExcept(i),i.selected=!0,i.event(e.Event.CHANGED));r||(this._lastIndex=o),h&&this.scrollItemToViewOnClick&&h.scrollTo(i,!0),i.selected&&this.syncController(o),s.isDblClick&&s.target instanceof e.Input||this._owner.event(t.UIEvent.ClickItem,[i,s])}enableArrowKeyNavigation(i,s){i?(this._keyEvent=null!=s?s:t.UIEvent.ClickItem,this._owner.on(e.Event.KEY_DOWN,this,this._keydown)):this._owner.off(e.Event.KEY_DOWN,this,this._keydown)}_keydown(t){if(t.target instanceof e.Input||t.ctrlKey||t.metaKey||t.altKey||t.shiftKey)return;let i=-1;switch(t.key){case"ArrowLeft":i=this.handleArrowKey(7,t);break;case"ArrowRight":i=this.handleArrowKey(3,t);break;case"ArrowUp":i=this.handleArrowKey(1,t);break;case"ArrowDown":i=this.handleArrowKey(5,t)}-1!=i&&t.stopPropagation()}handleArrowKey(e,i){var s;let h=this.index;if(-1==h)return this._owner.numChildren>0?(this.clear(),this.add(0,!0),this._keyEvent&&this._owner.event(this._keyEvent,[this._owner.getChildAt(0),i]),0):-1;let r=h,o=null===(s=this._owner.layout)||void 0===s?void 0:s.type;switch(null==o&&(o=t.LayoutType.FlowX),e){case 1:if(o==t.LayoutType.SingleColumn||o==t.LayoutType.FlowY)r--;else if(o==t.LayoutType.FlowX){let t,e=this._owner.getChildAt(r),i=0;for(t=r-1;t>=0;t--){let s=this._owner.getChildAt(t);if(s.y!=e.y){e=s;break}i++}for(;t>=0;t--){if(this._owner.getChildAt(t).y!=e.y){r=t+i+1;break}}}break;case 3:if(o==t.LayoutType.SingleRow||o==t.LayoutType.FlowX)r++;else if(o==t.LayoutType.FlowY){let t,e=this._owner.getChildAt(r),i=0,s=this._owner.numChildren;for(t=r+1;t<s;t++){let s=this._owner.getChildAt(t);if(s.x!=e.x){e=s;break}i++}for(;t<s;t++){if(this._owner.getChildAt(t).x!=e.x){r=t-i-1;break}}}break;case 5:if(o==t.LayoutType.SingleColumn||o==t.LayoutType.FlowY)r++;else if(o==t.LayoutType.FlowX){let t,e=this._owner.getChildAt(r),i=0,s=this._owner.numChildren;for(t=r+1;t<s;t++){let s=this._owner.getChildAt(t);if(s.y!=e.y){e=s;break}i++}for(;t<s;t++){if(this._owner.getChildAt(t).y!=e.y){r=t-i-1;break}}}break;case 7:if(o==t.LayoutType.SingleRow||o==t.LayoutType.FlowX)r--;else if(o==t.LayoutType.FlowY){let t,e=this._owner.getChildAt(r),i=0;for(t=r-1;t>=0;t--){let s=this._owner.getChildAt(t);if(s.x!=e.x){e=s;break}i++}for(;t>=0;t--){if(this._owner.getChildAt(t).x!=e.x){r=t+i+1;break}}}}return r!=h&&r>=0&&r<this._owner.numChildren?(this.clear(),this.add(r,!0),this._keyEvent&&this._owner.event(this._keyEvent,[this._owner.getChildAt(r),i]),r):-1}selectChanged(){this._controller&&(this.index=this._controller.selectedIndex)}syncController(t){let e=this._controller;e&&(this._controller=null,e.selectedIndex=t,this._controller=e)}_refresh(){this._mode!==t.SelectionMode.None&&(this._controller?this.index=this._controller.selectedIndex:this.index=this._lastIndex)}destroy(){this._controller&&this._controller.release()}}class yt extends mt{constructor(t){super(t),this._layout=t.layout}get index(){if(this._layout._virtual){for(let t=0;t<this._layout._realNumItems;t++){let e=this._layout._items[t];if(e.obj instanceof ct&&e.obj.selected||null==e.obj&&e.selected)return this._layout._loop?t%this._layout.numItems:t}return-1}return super.index}set index(e){this._layout._virtual?e>=0&&e<this._layout.numItems?(this._mode!=t.SelectionMode.Single&&this.clear(),this.add(e)):this.clear():super.index=e}get(t){if(this._layout._virtual){t||(t=[]);for(let e=0;e<this._layout._realNumItems;e++){let i=this._layout._items[e];if(i.obj instanceof ct&&i.obj.selected||null==i.obj&&i.selected){let i=e;if(this._layout._loop&&(i=e%this._layout.numItems,-1!=t.indexOf(i)))continue;t.push(i)}}return t}return super.get(t)}add(e,i){if(this._layout._virtual){if(this._mode==t.SelectionMode.Disabled)return;let s;this._layout._checkVirtualList(),this._mode==t.SelectionMode.Single&&this.clear(),i&&this._owner.scroller.scrollTo(e),this._lastIndex=e;let h=this._layout._items[e];h.obj&&(s=h.obj),h.selected=!0,s instanceof ct&&!s.selected&&(s.selected=!0)}else super.add(e,i)}remove(e){if(this._layout._virtual){if(this._mode==t.SelectionMode.Disabled)return;let i,s=this._layout._items[e];s.obj&&(i=s.obj),s.selected=!1,i instanceof ct&&(i.selected=!1)}else super.remove(e)}clear(){if(this._layout._virtual)for(let t=0;t<this._layout._realNumItems;t++){let e=this._layout._items[t];e.obj instanceof ct&&(e.obj.selected=!1),e.selected=!1}else super.clear()}clearExcept(t){if(this._layout._virtual)for(let e=0;e<this._layout._realNumItems;e++){let i=this._layout._items[e];i.obj!=t&&(i.obj instanceof ct&&(i.obj.selected=!1),i.selected=!1)}else super.clearExcept(t)}selectAll(){if(this._layout._virtual){this._layout._checkVirtualList();for(let t=0;t<this._layout._realNumItems;t++){let e=this._layout._items[t];e.obj instanceof ct&&!e.obj.selected&&(e.obj.selected=!0),e.selected=!0}}else super.selectAll()}selectReverse(){if(this._layout._virtual){this._layout._checkVirtualList();for(let t=0;t<this._layout._realNumItems;t++){let e=this._layout._items[t];e.obj instanceof ct&&(e.obj.selected=!e.obj.selected),e.selected=!e.selected}}else super.selectReverse()}handleClick(i,s){if(this._layout._virtual){let h=this._owner.scroller;if(null==h?void 0:h.isDragged)return;if(2===s.button&&!this.allowSelectByRightClick)return;if(i.mode==t.ButtonMode.Common)return void this._owner.event(t.UIEvent.ClickItem,[i,s]);let r=!1,o=this._layout.childIndexToItemIndex(this._owner.getChildIndex(i));if(this._mode==t.SelectionMode.Disabled);else if(this._mode==t.SelectionMode.Single)i.selected||(this.clearExcept(i),i.selected=!0,i.event(e.Event.CHANGED));else if(s.shiftKey){if(!i.selected)if(-1!=this._lastIndex){let t=Math.min(this._lastIndex,o),s=Math.max(this._lastIndex,o);s=Math.min(s,this._layout.numItems-1);for(let h=t;h<=s;h++){let t=this._layout._items[h];t.obj instanceof ct&&(t.obj.selected=!0,t.obj==i&&i.event(e.Event.CHANGED)),t.selected=!0}r=!0}else i.selected=!0,i.event(e.Event.CHANGED)}else s.ctrlKey||s.metaKey||this._mode==t.SelectionMode.MultipleBySingleClick?(i.selected=!i.selected,i.event(e.Event.CHANGED)):i.selected?0==s.button&&this.clearExcept(i):(this.clearExcept(i),i.selected=!0,i.event(e.Event.CHANGED));if(r||(this._lastIndex=o),s.isDblClick&&s.target instanceof e.Input)return;this._owner.event(t.UIEvent.ClickItem,[i,s])}else super.handleClick(i,s)}handleArrowKey(e,i){if(this._layout._virtual){let s=this.index;if(-1==s)return this._owner.numChildren>0?(this.clear(),this.add(0,!0),this._keyEvent&&this._owner.event(this._keyEvent,[this._owner.getChildAt(0),i]),0):-1;let h=s,r=this._layout.type;switch(e){case 1:r==t.LayoutType.SingleColumn||r==t.LayoutType.FlowY?h--:r==t.LayoutType.FlowX&&(h-=this._layout._lineItemCnt);break;case 3:r==t.LayoutType.SingleRow||r==t.LayoutType.FlowX?h++:r==t.LayoutType.FlowY&&(h+=this._layout._lineItemCnt);break;case 5:r==t.LayoutType.SingleColumn||r==t.LayoutType.FlowY?h++:r==t.LayoutType.FlowX&&(h+=this._layout._lineItemCnt);break;case 7:r==t.LayoutType.SingleRow||r==t.LayoutType.FlowX?h--:r==t.LayoutType.FlowY&&(h-=this._layout._lineItemCnt)}if(h!=s&&h>=0&&h<this._layout.numItems){if(this.clear(),this.add(h,!0),this._keyEvent){let t=this._layout.itemIndexToChildIndex(h);-1!=t&&this._owner.event(this._keyEvent,[this._owner.getChildAt(t),i])}return h}return-1}return super.handleArrowKey(e,i)}}class St extends tt{constructor(t,i){super(t),this._maskContainer=new e.Sprite,this._maskContainer.mouseThrough=!0,this._maskContainer.hideFlags|=e.HideFlags.HideAndDontSave,this.addChild(this._maskContainer);let s=new xt;s.mouseThrough=!0,s.hideFlags|=e.HideFlags.HideAndDontSave,this._maskContainer.addChild(s),this._setContainer(s),this._selection=new(i||mt)(this),this.clipping=!0}get scroller(){return this._scroller}set scroller(t){this._scroller&&(this._scroller.owner=null),this._scroller=t,t&&(t.owner=this)}get selection(){return this._selection}get selectedIndex(){return this._selection.index}set selectedIndex(t){this._selection.index=t}get clipping(){return this._clipping}set clipping(t){this._clipping!=t&&(this._clipping=t,this._clipping?this.scrollRect=new e.Rectangle(0,0,this.width,this.height):this.scrollRect=null,this._scroller&&this._scroller._processClipping())}get viewWidth(){return this._layout.viewWidth}set viewWidth(t){this._layout.viewWidth=t}get viewHeight(){return this._layout.viewHeight}set viewHeight(t){this._layout.viewHeight=t}get touchItem(){let t=e.InputManager.touchTarget;if(!t)return null;let i=t.parent;for(;null!=i;){if(i==this)return t.parent==this?t:null;t=i,i=i.parent}return null}_sizeChanged(t){this._scrollRect&&(this.scrollRect=this._scrollRect.setTo(0,0,this.width,this.height)),this._scroller&&this._scroller._ownerSizeChanged(),t&&this._layout.refresh()}_panelChildChanged(e){this.setLayoutChangedFlag(t.LayoutChangedReason.Hierarchy)}destroy(){this._scroller&&this._scroller.destroy(),this._selection&&this._selection.destroy(),super.destroy()}}class xt extends F{_childChanged(t){super._childChanged(t),this._parent._parent._panelChildChanged(t)}}class vt extends St{constructor(){super(ft,yt),this._layout.type=t.LayoutType.SingleColumn,this._selection.mode=t.SelectionMode.Single,this._pool=new gt}destroy(){this._pool.clear(),super.destroy()}get layout(){return this._layout}get itemTemplate(){return this._pool.defaultRes}set itemTemplate(t){this._pool.defaultRes=t}get itemPool(){return this._pool}getFromPool(t){let e=this._pool.take(t);return e&&(e.visible=!0),e}returnToPool(t){this._pool.recover(t)}addItemFromPool(t){let e=this.getFromPool(t);return e instanceof ct&&(e.selected=!1),this.addChild(e)}removeChildToPoolAt(t){let e=this.removeChildAt(t);this.returnToPool(e)}removeChildToPool(t){this.removeChild(t),this.returnToPool(t)}removeChildrenToPool(t,e){t=t||0,null==e&&(e=-1),(e<0||e>=this.children.length)&&(e=this.children.length-1);for(let i=t;i<=e;++i)this.removeChildToPoolAt(t)}get numItems(){return this._layout.numItems}set numItems(t){this._layout.numItems=t}resizeToFit(t,e){this._layout.resizeToFit(t,e)}childIndexToItemIndex(t){return this._layout.childIndexToItemIndex(t)}itemIndexToChildIndex(t){return this._layout.itemIndexToChildIndex(t)}refreshVirtualList(){this._layout.refreshVirtualList()}setVirtual(){this._setVirtual(!1)}setVirtualAndLoop(){this._setVirtual(!0)}_setVirtual(e){if(!this._layout._virtual){if(null==this.scroller)throw new Error("Virtual list must be scrollable!");if(e){if(this._layout.type==t.LayoutType.FlowX||this._layout.type==t.LayoutType.FlowY)throw new Error("Loop list does not support flowX or flowY layout!");this.scroller.bouncebackEffect=t.ScrollBounceBackEffect.Off}}this._layout._setVirtual(e)}onAfterDeserialize(){super.onAfterDeserialize(),!e.SerializeUtil.hasProp("_initItemNum","_itemData")||!e.LayaEnv.isPreview&&e.SerializeUtil._data._isDemo||this._buildInitItems()}_buildInitItems(){for(let t=this.children.length-1;t>=0;t--){let i=this.getChildAt(t);i.hasHideFlag(e.HideFlags.HideAndDontSave)&&i.destroy()}if(null==this.itemTemplate)return;let t=this._itemData;for(let i=0;i<this._initItemNum;i++){let s=t&&i<t.length?t[i]:null;if(null!=s){let t=s.res?s.res.create():this.getFromPool();t.hideFlags|=e.HideFlags.HideAndDontSave,t.text=s.title,s.icon&&(t.icon=s.icon),t instanceof ct&&(s.selectedTitle&&(t.selectedTitle=s.selectedTitle),s.selectedIcon&&(t.selectedIcon=s.selectedIcon),t.selected=!1),null!=s.name&&(t.name=s.name),this.addChild(t)}else this.addItemFromPool()}this.selection._refresh()}}class Ct extends F{constructor(){super(),this._color="#ffffff",this.comp=this.addComponent(e.FrameAnimation),this.comp.hideFlags|=e.HideFlags.HideAndDontSave,this.comp.stretchMode=e.AnimationStretchMode.ResizeToFit}get src(){return this.comp.source}set src(t){this.comp.source=t}get icon(){return this.src}set icon(t){this.src=t}get autoSize(){return this.comp.stretchMode===e.AnimationStretchMode.ResizeToFit}set autoSize(t){this.comp.stretchMode=t?e.AnimationStretchMode.ResizeToFit:e.AnimationStretchMode.Fill}get color(){return this._color}set color(t){this._color=t,this.comp.color.parse(t),this.comp.color=this.comp.color}get frame(){return this.comp.frame}set frame(t){this.comp.frame=t}get isPlaying(){return this.comp.isPlaying}get autoPlay(){return this.comp.autoPlay}set autoPlay(t){this.comp.autoPlay=t}get loop(){return this.comp.loop}set loop(t){this.comp.loop=t}get timeScale(){return this.comp.timeScale}set timeScale(t){this.comp.timeScale=t}_sizeChanged(t){super._sizeChanged(),t||e.SerializeUtil.isDeserializing||(this.autoSize=!1)}}class It extends F{constructor(){super(),this._min=0,this._max=0,this._value=0,this._titleType=0,this._reverse=!1,this._barMaxWidth=0,this._barMaxHeight=0,this._barMaxWidthDelta=0,this._barMaxHeightDelta=0,this._barStartX=0,this._barStartY=0,this._value=50,this._max=100}get titleType(){return this._titleType}set titleType(t){this._titleType!=t&&(this._titleType=t,e.ILaya.timer.callLater(this,this.update))}get min(){return this._min}set min(t){this._min!=t&&(this._min=t,e.ILaya.timer.callLater(this,this.update))}get max(){return this._max}set max(t){this._max!=t&&(this._max=t,e.ILaya.timer.callLater(this,this.update))}get value(){return this._value}set value(t){this._value!=t&&(this._tween&&(this._tween.kill(),this._tween=null),this._value=t,e.ILaya.timer.callLater(this,this.update))}tweenValue(t,i){let s;if(this._tween){let t=this._tween.findTweener("progress");s=t?t.value.get(null):this._value,t.kill()}else s=this._value;return this._value=t,e.Tween.create(this).name("progress").go(null,s,this._value).duration(i).ease("linear").onUpdate(t=>this.update(t.value.get(null)))}update(t){if(this._getBit(e.NodeFlags.EDITING_ROOT_NODE))return void this.updateTitle(this._max,this._max,1);null==t&&(t=this._value);let i=e.MathUtil.clamp01((t-this._min)/(this._max-this._min));this.updateTitle(t,this._max,i);let s=this.width-this._barMaxWidthDelta,h=this.height-this._barMaxHeightDelta;this._reverse?(this._hBar&&(this.setFillAmount(this._hBar,1-i)||(this._hBar.width=Math.round(s*i),this._hBar.x=this._barStartX+(s-this._hBar.width))),this._vBar&&(this.setFillAmount(this._vBar,1-i)||(this._vBar.height=Math.round(h*i),this._vBar.y=this._barStartY+(h-this._vBar.height)))):(this._hBar&&(this.setFillAmount(this._hBar,i)||(this._hBar.width=Math.round(s*i))),this._vBar&&(this.setFillAmount(this._vBar,i)||(this._vBar.height=Math.round(h*i))))}updateTitle(e,i,s){let h=this._titleWidget;if(h)switch(this._titleType){case t.ProgressTitleType.Percent:h.text=Math.floor(100*s)+"%";break;case t.ProgressTitleType.ValueAndMax:h.text=Math.floor(e)+"/"+Math.floor(i);break;case t.ProgressTitleType.Value:h.text=""+Math.floor(e);break;case t.ProgressTitleType.Max:h.text=""+Math.floor(i)}}setFillAmount(t,i){let s=t.mesh;return s instanceof e.ProgressMesh&&(s.amount=i,t.graphics.repaint(),!0)}_onConstruct(t){this._hBar&&(this._barMaxWidth=this._hBar.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._hBar.x),this._vBar&&(this._barMaxHeight=this._vBar.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._vBar.y),e.ILaya.timer.runCallLater(this,this.update),super._onConstruct(t)}_setup(t,e,i,s){this._hBar=t,this._vBar=e,this._titleWidget=i,this._reverse=s,this._value=this._max,this._onConstruct()}_sizeChanged(){super._sizeChanged(),this._hBar&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._vBar&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),e.ILaya.timer.callLater(this,this.update)}}class bt extends F{constructor(){super(),this._scrollPerc=0,this._fixedGripSize=!1,this._dragOffset=new e.Point,this.on(e.Event.MOUSE_DOWN,this,this._barTouchBegin)}setOwner(t,e){this._target=t,this._vertical=e}setDisplayPerc(t){this._vertical?(this._fixedGripSize||(this._gripButton.height=Math.max(Math.floor(t*this._bar.height),Math.min(20,this._bar.height))),this._gripButton.y=this._bar.y+(this._bar.height-this._gripButton.height)*this._scrollPerc):(this._fixedGripSize||(this._gripButton.width=Math.max(Math.floor(t*this._bar.width),Math.min(20,this._bar.width))),this._gripButton.x=this._bar.x+(this._bar.width-this._gripButton.width)*this._scrollPerc),this._gripButton.visible=0!=t&&1!=t}setScrollPerc(t){this._scrollPerc=t,this._vertical?this._gripButton.y=this._bar.y+(this._bar.height-this._gripButton.height)*this._scrollPerc:this._gripButton.x=this._bar.x+(this._bar.width-this._gripButton.width)*this._scrollPerc}get minSize(){return this._vertical?(this._arrowButton1?this._arrowButton1.height:0)+(this._arrowButton2?this._arrowButton2.height:0):(this._arrowButton1?this._arrowButton1.width:0)+(this._arrowButton2?this._arrowButton2.width:0)}get gripDragging(){return this._gripDragging}get fixedGripSize(){return this._fixedGripSize}set fixedGripSize(t){this._fixedGripSize=t}_onConstruct(t){this._gripButton&&(this._gripButton.on(e.Event.MOUSE_DOWN,this,this._gripTouchBegin),this._gripButton.on(e.Event.MOUSE_DRAG,this,this._gripTouchMove),this._gripButton.on(e.Event.MOUSE_UP,this,this._gripTouchEnd)),this._arrowButton1&&this._arrowButton1.on(e.Event.MOUSE_DOWN,this,this._arrowButton1Click),this._arrowButton2&&this._arrowButton2.on(e.Event.MOUSE_DOWN,this,this._arrowButton2Click),super._onConstruct(t)}_setup(t,e,i,s){this._arrowButton1=t,this._arrowButton2=e,this._bar=i,this._gripButton=s,this._onConstruct()}_gripTouchBegin(t){this._bar&&this._target&&(t.stopPropagation(),this._gripDragging=!0,this._target._updateScrollBarVisible(),this.globalToLocal(this._dragOffset.copy(t.touchPos)),this._dragOffset.x-=this._gripButton.x,this._dragOffset.y-=this._gripButton.y)}_gripTouchMove(t){if(!this.displayedInStage||!this._target)return;let e=this.globalToLocal(Tt.copy(t.touchPos));if(this._vertical){let t=e.y-this._dragOffset.y,i=this._bar.height-this._gripButton.height;this._target.percY=0==i?0:(t-this._bar.y)/i}else{let t=e.x-this._dragOffset.x,i=this._bar.width-this._gripButton.width;this._target.percX=0==i?0:(t-this._bar.x)/(this._bar.width-this._gripButton.width)}}_gripTouchEnd(t){this._target&&(this._gripDragging=!1,this._target._updateScrollBarVisible())}_arrowButton1Click(t){t.stopPropagation(),this._target&&(this._vertical?this._target.scrollUp():this._target.scrollLeft())}_arrowButton2Click(t){t.stopPropagation(),this._target&&(this._vertical?this._target.scrollDown():this._target.scrollRight())}_barTouchBegin(t){if(t.stopPropagation(),!this._target)return;let e=this._gripButton.globalToLocal(Tt.copy(t.touchPos));this._vertical?e.y<0?this._target.scrollUp(4):this._target.scrollDown(4):e.x<0?this._target.scrollLeft(4):this._target.scrollRight(4)}}const Tt=new e.Point;class Pt extends F{constructor(){super(),this.changeOnClick=!0,this.canDrag=!0,this._min=0,this._max=0,this._value=0,this._titleType=0,this._reverse=!1,this._wholeNumbers=!1,this._barMaxWidth=0,this._barMaxHeight=0,this._barMaxWidthDelta=0,this._barMaxHeightDelta=0,this._clickPercent=0,this._barStartX=0,this._barStartY=0,this._value=50,this._max=100,this._clickPos=new e.Point,this.on(e.Event.MOUSE_DOWN,this,this._barTouchBegin)}get titleType(){return this._titleType}set titleType(t){this._titleType!=t&&(this._titleType=t,e.ILaya.timer.callLater(this,this.update))}get wholeNumbers(){return this._wholeNumbers}set wholeNumbers(t){this._wholeNumbers!=t&&(this._wholeNumbers=t,e.ILaya.timer.callLater(this,this.update))}get min(){return this._min}set min(t){this._min!=t&&(this._min=t,e.ILaya.timer.callLater(this,this.update))}get max(){return this._max}set max(t){this._max!=t&&(this._max=t,e.ILaya.timer.callLater(this,this.update))}get value(){return this._value}set value(t){this._value!=t&&(this._value=t,e.ILaya.timer.callLater(this,this.update))}update(){this.updateWithPercent((this._value-this._min)/(this._max-this._min),!1)}updateWithPercent(t,i){if(this._getBit(e.NodeFlags.EDITING_ROOT_NODE))return void this.updateTitle(this._max,this._max,1);if(t=e.MathUtil.clamp01(t),i){let i=e.MathUtil.clamp(this._min+(this._max-this._min)*t,this._min,this._max);if(this._wholeNumbers&&(i=Math.round(i),t=e.MathUtil.clamp01((i-this._min)/(this._max-this._min))),i!=this._value&&(this._value=i,this.event(e.Event.CHANGED,e.Event.EMPTY),!this.canDrag))return}this.updateTitle(this._value,this._max,t);let s=this.width-this._barMaxWidthDelta,h=this.height-this._barMaxHeightDelta;this._reverse?(this._hBar&&(this._hBar.width=Math.round(s*t),this._hBar.x=this._barStartX+(s-this._hBar.width)),this._vBar&&(this._vBar.height=Math.round(h*t),this._vBar.y=this._barStartY+(h-this._vBar.height))):(this._hBar&&(this._hBar.width=Math.round(s*t)),this._vBar&&(this._vBar.height=Math.round(h*t)))}updateTitle(e,i,s){let h=this._titleWidget;if(h)switch(this._titleType){case t.ProgressTitleType.Percent:h.text=Math.floor(100*s)+"%";break;case t.ProgressTitleType.ValueAndMax:h.text=Math.floor(e)+"/"+Math.floor(i);break;case t.ProgressTitleType.Value:h.text=""+Math.floor(e);break;case t.ProgressTitleType.Max:h.text=""+Math.floor(i)}}_onConstruct(t){this._hBar&&(this._barMaxWidth=this._hBar.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._hBar.x),this._vBar&&(this._barMaxHeight=this._vBar.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._vBar.y),this._gripButton&&(this._gripButton.on(e.Event.MOUSE_DOWN,this,this._gripTouchBegin),this._gripButton.on(e.Event.MOUSE_DRAG,this,this._gripTouchMove)),this.update(),super._onConstruct(t)}_setup(t,e,i,s,h){this._hBar=t,this._vBar=e,this._gripButton=i,this._titleWidget=s,this._reverse=h,this._value=this._max,this._onConstruct()}_sizeChanged(){super._sizeChanged(),this._hBar&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._vBar&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),e.ILaya.timer.callLater(this,this.update)}_gripTouchBegin(t){0==t.button&&(this.canDrag=!0,t.stopPropagation(),this.globalToLocal(this._clickPos.copy(t.touchPos)),this._clickPercent=e.MathUtil.clamp01((this._value-this._min)/(this._max-this._min)))}_gripTouchMove(t){if(!this.canDrag)return;let e,i=this.globalToLocal(Bt.copy(t.touchPos)),s=i.x-this._clickPos.x,h=i.y-this._clickPos.y;this._reverse&&(s=-s,h=-h),e=this._hBar?this._clickPercent+s/this._barMaxWidth:this._clickPercent+h/this._barMaxHeight,this.updateWithPercent(e,!0)}_barTouchBegin(t){if(!this.changeOnClick)return;let i=this._gripButton.globalToLocal(Bt.copy(t.touchPos)),s=e.MathUtil.clamp01((this._value-this._min)/(this._max-this._min)),h=0;this._hBar&&(h=(i.x-this._gripButton.width/2)/this._barMaxWidth),this._vBar&&(h=(i.y-this._gripButton.height/2)/this._barMaxHeight),this._reverse?s-=h:s+=h,this.updateWithPercent(s,!0)}}const Bt=new e.Point;class Mt{constructor(t,e,i){this._expanded=!1,this._level=0,this._indentLevel=0,this._addIndent=0,this._isFolder=t,e&&(this._resURL=e),i&&(this._addIndent=i),this._children=[]}get expanded(){return this._expanded}set expanded(t){this._setExpanded(t)}_setExpanded(t,e){this._expanded!=t&&(this._expanded=t,this._tree&&this.isFolder&&(this._expanded?this._tree._afterExpanded(this,e):this._tree._afterCollapsed(this,e)),this._expandCtrler&&(this._expandCtrler.selectedIndex=this.expanded?1:0))}get isFolder(){return this._isFolder||this._children.length>0}set isFolder(t){this._isFolder!=t&&(this._isFolder=t,this._leafController&&(this._leafController.selectedIndex=this.isFolder?0:1))}get addIndent(){return this._addIndent}set addIndent(t){this._addIndent=t}get parent(){return this._parent}get text(){return this._cell?this._cell.text:null}set text(t){this._cell&&(this._cell.text=t)}get icon(){return this._cell?this._cell.icon:null}set icon(t){this._cell&&(this._cell.icon=t)}get cell(){return this._cell}set cell(t){if(this._cell){this._cell.treeNode=null,this._indentObj=null,this._leafController=null,this._expandCtrler&&this._expandCtrler.off(e.Event.CHANGED,this,this._expandedStateChanged);let t=this._cell.findChild("expandButton");t&&t.off(e.Event.CLICK,this,this._clickExpandButton),this._cell.off(e.Event.MOUSE_DOWN,this,this._cellMouseDown)}if(this._cell=t,this._cellFromPool=!1,this._cell){this._cell.treeNode=this,this._indentObj=this._cell.findChild("indent"),this._tree&&this._indentObj&&(this._indentObj.width=Math.max(this._indentLevel-1,0)*this._tree.indent),this._expandCtrler=this._cell.getController("expanded"),this._expandCtrler&&(this._expandCtrler.on(e.Event.CHANGED,this,this._expandedStateChanged),this._expandCtrler.selectedIndex=this.expanded?1:0);let t=this._cell.findChild("expandButton");t&&t.on(e.Event.CLICK,this,this._clickExpandButton),this._leafController=this._cell.getController("leaf"),this._leafController&&(this._leafController.selectedIndex=this.isFolder?0:1),this._cell.on(e.Event.MOUSE_DOWN,this,this._cellMouseDown)}}createCell(t){if(this._cell)return;let i=(this._tree||t).itemPool.take(this._resURL?this._resURL:"");if(!i)throw new Error("cannot create tree node object.");i.hideFlags|=e.HideFlags.HideAndDontSave,i instanceof ct&&(i.selected=!1),this.cell=i,this._cellFromPool=!0}get level(){return this._level}addChild(t){return this.addChildAt(t,this._children.length),t}addChildAt(t,e){if(!t)throw new Error("child is null");let i=this._children.length;if(e>=0&&e<=i)return t._parent==this?this.setChildIndex(t,e):(t._parent&&t._parent.removeChild(t),e==i?this._children.push(t):this._children.splice(e,0,t),this.isFolder&&this._leafController&&(this._leafController.selectedIndex=0),t._parent=this,t._level=this._level+1,t._indentLevel=this._indentLevel+1+t._addIndent,t._setTree(this._tree),(this._tree&&this==this._tree.rootNode||this._cell&&this._cell.parent&&this._expanded)&&this._tree._afterInserted(t)),t;throw new Error(`Invalid child index ${e}`)}removeChild(t){let e=this._children.indexOf(t);return-1!=e&&this.removeChildAt(e),t}removeChildAt(t){if(t>=0&&t<this.numChildren){let e=this._children[t];return this._children.splice(t,1),!this.isFolder&&this._leafController&&(this._leafController.selectedIndex=1),e._parent=null,this._tree&&(e._setTree(null),this._tree._afterRemoved(e)),e}throw new Error(`Invalid child index ${t}`)}removeChildren(t,e){t=t||0,null==e&&(e=-1),(e<0||e>=this.numChildren)&&(e=this.numChildren-1);for(let i=t;i<=e;++i)this.removeChildAt(t)}getChildAt(t){if(t>=0&&t<this.numChildren)return this._children[t];throw new Error(`Invalid child index ${t}`)}getChildIndex(t){return this._children.indexOf(t)}getPrevSibling(){if(null==this._parent)return null;let t=this._parent._children.indexOf(this);return t<=0?null:this._parent._children[t-1]}getNextSibling(){if(null==this._parent)return null;let t=this._parent._children.indexOf(this);return t<0||t>=this._parent._children.length-1?null:this._parent._children[t+1]}getLastVisibleDecendant(){let t=this.findLastVisibleChild(this);return t===this?null:t}findLastVisibleChild(t){var e;for(let i=t.children.length-1;i>=0;i--){let s=t.children[i];if((null===(e=s.cell)||void 0===e?void 0:e.parent)&&s.cell.visible)return this.findLastVisibleChild(s)||s;if(s.children.length>0&&s.expanded){let t=this.findLastVisibleChild(s);if(t)return t}}return null}setChildIndex(t,e){let i=this._children.indexOf(t);if(-1==i)throw new Error("Not a child of this container");let s=this._children.length;e<0?e=0:e>s&&(e=s),i!=e&&(this._children.splice(i,1),this._children.splice(e,0,t),(this._tree&&this==this._tree.rootNode||this._cell&&this._cell.parent&&this._expanded)&&this._tree._afterMoved(t))}swapChildren(t,e){let i=this._children.indexOf(t),s=this._children.indexOf(e);if(-1==i||-1==s)throw new Error("Not a child of this container");this.swapChildrenAt(i,s)}swapChildrenAt(t,e){let i=this._children[t],s=this._children[e];this._children[t]=s,this._children[e]=i,(this._tree&&this==this._tree.rootNode||this._cell&&this._cell.parent&&this._expanded)&&(t<e?(this._tree._afterMoved(s),this._tree._afterMoved(i)):(this._tree._afterMoved(i),this._tree._afterMoved(s)))}get numChildren(){return this._children.length}get children(){return this._children}expandToRoot(){let t=this;for(;t;)t.expanded=!0,t=t.parent}get tree(){return this._tree}_setTree(t){this._tree=t,this._tree&&this._indentObj&&(this._indentObj.width=Math.max(this._indentLevel-1,0)*this._tree.indent),this._tree&&this._tree.treeNodeWillExpand&&this._expanded&&this._tree.treeNodeWillExpand(this,!0);let e=this._children.length;for(let i=0;i<e;i++){let e=this._children[i];e._level=this._level+1,e._indentLevel=this._indentLevel+1+e._addIndent,e._setTree(t)}}_expandedStateChanged(){this._setExpanded(1==this._expandCtrler.selectedIndex,!0)}_cellMouseDown(t){this._tree&&this.isFolder&&(this._tree.selection._expandedStatusInEvt=this._expanded)}_clickExpandButton(t){t.stopPropagation()}}class zt extends mt{constructor(){super(...arguments),this._clickToExpand=0}get clickToExpand(){return this._clickToExpand}set clickToExpand(t){this._clickToExpand=t}getSelectedNode(){let t=this.index;return-1!=t?this._owner.getChildAt(t).treeNode:null}getSelectedNodes(t){Lt.length=0,this.get(Lt);let e=Lt.length,i=[];for(let t=0;t<e;t++){let e=this._owner.getChildAt(Lt[t]).treeNode;i.push(e)}return i}selectNode(t,e){let i=t.parent;for(;i&&i!=this._owner.rootNode;)i.expanded=!0,i=i.parent;t.cell&&this.add(this._owner.getChildIndex(t.cell),e)}unselectNode(t){t.cell&&this.remove(this._owner.getChildIndex(t.cell))}handleClick(t,e){let i=this._owner.scroller;if(!(null==i?void 0:i.isDragged)&&(2!=e.button||this.allowSelectByRightClick)){if(0!=this._clickToExpand){let i=t.treeNode;i&&i.isFolder&&this._expandedStatusInEvt==i.expanded&&(2==this._clickToExpand?e.isDblClick&&i._setExpanded(!i.expanded,!0):i._setExpanded(!i.expanded,!0))}super.handleClick(t,e)}}handleArrowKey(t,e){if(3==t||7==t){let e=this.index;if(-1!=e){let i=this._owner.getChildAt(e).treeNode;if(i.isFolder)return i.expanded=3==t,e}}return super.handleArrowKey(t,e)}}var Lt=[];class Et extends St{constructor(){super(null,zt),this.scrollToViewOnExpand=!1,this.indent=15,this.layout.type=t.LayoutType.SingleColumn,this.selection.mode=t.SelectionMode.Single,this._pool=new gt,this.rootNode=new Mt(!0),this.rootNode._setTree(this),this.rootNode.expanded=!0}get selection(){return this._selection}get clickToExpand(){return this._selection.clickToExpand}set clickToExpand(t){this._selection.clickToExpand=t}get itemTemplate(){return this._pool.defaultRes}set itemTemplate(t){this._pool.defaultRes=t}get itemPool(){return this._pool}expandAll(t){t||(t=this.rootNode),t.expanded=!0;let e=t.numChildren;for(let i=0;i<e;i++){let e=t.getChildAt(i);e.isFolder&&this.expandAll(e)}}collapseAll(t){t||(t=this.rootNode),t!=this.rootNode&&(t.expanded=!1);let e=t.numChildren;for(let i=0;i<e;i++){let e=t.getChildAt(i);e.isFolder&&this.collapseAll(e)}}createCell(t){t.createCell(),this.treeNodeRender&&this.treeNodeRender(t,t.cell)}_afterInserted(t){t.cell||this.createCell(t);let e=this.getInsertIndexForNode(t);this.addChildAt(t.cell,e),this.treeNodeRender&&this.treeNodeRender(t,t.cell),t.isFolder&&t.expanded&&this.checkChildren(t,e)}getInsertIndexForNode(t){let e=t.getPrevSibling();null==e&&(e=t.parent);let i=this.getChildIndex(e.cell)+1,s=t.level,h=this.numChildren;for(let t=i;t<h;t++){let e=this.getChildAt(t).treeNode;if(e&&e.level<=s)break;i++}return i}_afterRemoved(t){this.removeNode(t)}_afterExpanded(t,e){if(t!=this.rootNode){if(this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!0),t.onExpanded&&t.onExpanded(!0),null!=t.cell&&(this.treeNodeRender&&this.treeNodeRender(t,t.cell),t.cell.parent&&(this.checkChildren(t,this.getChildIndex(t.cell)),this.scrollToViewOnExpand&&null!=this.scroller))){let e=t.getLastVisibleDecendant();null==e&&t.cell.visible&&(e=t),e&&this.scroller.scrollTo(e.cell,!1,t.cell)}}else this.checkChildren(this.rootNode,0)}_afterCollapsed(t,e){t!=this.rootNode?(this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!1),t.onExpanded&&t.onExpanded(!1),null!=t.cell&&(this.treeNodeRender&&this.treeNodeRender(t,t.cell),t.cell.parent&&this.hideFolderNode(t))):this.checkChildren(this.rootNode,0)}_afterMoved(t){let e,i=this.getChildIndex(t.cell);e=t.isFolder?this.getFolderEndIndex(i,t.level):i+1;let s=this.getInsertIndexForNode(t);if(i==s||i==s-1)return;let h=e-i;if(s<i)for(let t=0;t<h;t++){let e=this.getChildAt(i+t);this._setChildIndex(e,i+t,s+t)}else for(let t=0;t<h;t++){let t=this.getChildAt(i);this._setChildIndex(t,i,s-1)}}getFolderEndIndex(t,e){let i=this.numChildren;for(let s=t+1;s<i;s++){if(this.getChildAt(s).treeNode.level<=e)return s}return i}checkChildren(t,e){let i=t.numChildren;for(let s=0;s<i;s++){e++;let i=t.getChildAt(s);null==i.cell&&this.createCell(i),i.cell.parent||this.addChildAt(i.cell,e),i.isFolder&&i.expanded&&(e=this.checkChildren(i,e))}return e}hideFolderNode(t){let e=t.numChildren;for(let i=0;i<e;i++){let e=t.getChildAt(i);e.cell&&this.removeChild(e.cell),e.isFolder&&e.expanded&&this.hideFolderNode(e)}}removeNode(t){if(t.cell&&(t.cell.removeSelf(),t._cellFromPool&&(this._pool.recover(t.cell),t.cell=null)),t.isFolder){let e=t.numChildren;for(let i=0;i<e;i++){let e=t.getChildAt(i);this.removeNode(e)}}}onAfterDeserialize(){super.onAfterDeserialize(),!e.SerializeUtil.hasProp("_initItemNum","_itemData")||!e.LayaEnv.isPreview&&e.SerializeUtil._data._isDemo||this._buildInitItems()}_buildInitItems(){var t,e;if(this.rootNode.removeChildren(),null==this.itemTemplate)return;let i,s=this._itemData,h=0;for(let r=0;r<this._initItemNum;r++){let o=s&&r<s.length?s[r]:null;if(null!=o){let l=o.level||0,n=((null===(t=s[r+1])||void 0===t?void 0:t.level)||0)>l,a=new Mt(n,null===(e=o.res)||void 0===e?void 0:e.url);if(a.expanded=!0,0==r)this.rootNode.addChild(a);else if(l>h)i.addChild(a);else if(l<h){for(let t=l;t<=h;t++)i=i.parent;i.addChild(a)}else i.parent.addChild(a);i=a,h=l;let _=a.cell;_.text=o.title,o.icon&&(_.icon=o.icon),_ instanceof ct&&(o.selectedTitle&&(_.selectedTitle=o.selectedTitle),o.selectedIcon&&(_.selectedIcon=o.selectedIcon),_.selected=!1),null!=o.name&&(_.name=o.name)}else{let t=new Mt;this.rootNode.addChild(t),h=0,i=t}}this.selection._refresh()}}class Rt{constructor(){this.enabled=!0,this.easeType="quadOut",this.duration=300,this.delay=0}}var kt=new e.Point,Dt=new e.Rectangle,At=new e.Rectangle,Ft=new e.Point,Wt=new e.Point,Ot=0;const Nt=.3,Ht=.5;var jt;class Gt{constructor(){this._dir=0,this._step=0,this._decelerationRate=0,this._barDisplay=0,this._barDisplay2=0,this._touchEffect2=0,this._bouncebackEffect2=0,this._touchEffectButton=0,this._xPos=0,this._yPos=0,this._aniFlag=0,this._headerLockedSize=0,this._footerLockedSize=0,this._tweening=0,this._loop=0,this._barMargin=[0,0,0,0],this._viewSize=new e.Point,this._contentSize=new e.Point,this._pageSize=new e.Point(1,1),this._overlapSize=new e.Point,this._tweenTime=new e.Point,this._tweenStart=new e.Point,this._tweenDuration=new e.Point,this._tweenChange=new e.Point,this._slidingPoints=[],this._containerPos=new e.Point,this._beginTouchPos=new e.Point,this._cachedScrollRect=new e.Rectangle,this._step=R.defaultScrollStep,this._decelerationRate=R.defaultScrollDecelerationRate,this._barDisplay=R.defaultScrollBarDisplay,this._touchEffect=R.defaultScrollTouchEffect,this._bouncebackEffect=R.defaultScrollTouchEffect}get owner(){return this._owner}set owner(t){this._owner!=t&&(this._owner&&(this._owner.offAllCaller(this),0!==this._tweening&&e.ILaya.timer.clear(this,this.tweenUpdate),this._hScrollBar&&(this._hScrollBar.destroy(),this._hScrollBar=null),this._vScrollBar&&(this._vScrollBar.destroy(),this._vScrollBar=null),this._header&&(this._header.destroy(),this._header=null),this._footer&&(this._footer.destroy(),this._footer=null),this._container.pos(0,0),this._owner.setLayoutChangedFlag()),this._owner=t,t&&(this._layout=t.layout,this._container=t._$container,this._maskContainer=this._container.parent,this._container.pos(0,0),e.SerializeUtil.isDeserializing||(t.clipping=!0,this._setDefaultDirection()),this.createHzScrollBar(),this.createVtScrollBar(),t.on(e.Event.MOUSE_DOWN,this,this._touchBegin),t.on(e.Event.MOUSE_WHEEL,this,this._mouseWheel),t.on(e.Event.ROLL_OVER,this,this._rollOver),t.on(e.Event.ROLL_OUT,this,this._rollOut),t.setLayoutChangedFlag(),this._processClipping(),this._ownerSizeChanged()))}destroy(){this.owner=null}get hScrollBar(){return this._hScrollBar}get vScrollBar(){return this._vScrollBar}get header(){return this._header}get footer(){return this._footer}get hScrollBarRes(){return this._hScrollBarRes}set hScrollBarRes(t){this._hScrollBarRes=t,this.createHzScrollBar(!0)}get vScrollBarRes(){return this._vScrollBarRes}set vScrollBarRes(t){this._vScrollBarRes=t,this.createVtScrollBar(!0)}get headerRes(){return this._headerRes}set headerRes(t){this._headerRes=t,this.createHeader()}get footerRes(){return this._footerRes}set footerRes(t){this._footerRes=t,this.createFooter()}get direction(){return this._dir}set direction(e){this._dir!==e&&(this._dir=e,null!=this._refreshBarAxis&&(this._refreshBarAxis=this._dir===t.ScrollDirection.Both||this._dir===t.ScrollDirection.Vertical?"y":"x"),this.createHzScrollBar(),this.createVtScrollBar())}get barDisplay(){return this._barDisplay2}set barDisplay(e){this._barDisplay2!==e&&(this._barDisplay2=e,this._barDisplay=e===t.ScrollBarDisplay.Default?R.defaultScrollBarDisplay:e,this.createHzScrollBar(),this.createVtScrollBar())}get barOnLeft(){return this._barOnLeft}set barOnLeft(t){this._barOnLeft!=t&&(this._barOnLeft=t,this.onSizeChanged())}get barFloating(){return this._barFloating}set barFloating(t){this._barFloating!=t&&(this._barFloating=t,this.onSizeChanged())}get barMargin(){return this._barMargin}set barMargin(t){null!=t&&Array.isArray(t)||(t=[0,0,0,0]),this._barMargin=t,this.onSizeChanged()}get bouncebackEffect(){return this._bouncebackEffect2}set bouncebackEffect(e){this._bouncebackEffect2=e,e===t.ScrollBounceBackEffect.Default?this._bouncebackEffect=R.defaultScrollBounceEffect:this._bouncebackEffect=e==t.ScrollBounceBackEffect.On}get touchEffect(){return this._touchEffect2}set touchEffect(e){this._touchEffect2=e,e===t.ScrollTouchEffect.Default?this._touchEffect=R.defaultScrollTouchEffect:this._touchEffect=e===t.ScrollTouchEffect.On}get touchEffectButton(){return this._touchEffectButton}set touchEffectButton(t){this._touchEffectButton=t}get pageMode(){return this._pageMode}set pageMode(t){this._pageMode=t}set step(t){this._step=t}get step(){return this._step}get snapToItem(){return this._snapToItem}set snapToItem(t){this._snapToItem=t}get inertiaDisabled(){return this._inertiaDisabled}set inertiaDisabled(t){this._inertiaDisabled=t}get paddingMaskDisabled(){return this._paddingMaskDisabled}set paddingMaskDisabled(t){this._paddingMaskDisabled!=t&&(this._paddingMaskDisabled=t,this._processClipping())}get mouseWheelDisabled(){return this._mouseWheelDisabled}set mouseWheelDisabled(t){this._mouseWheelDisabled=t}get decelerationRate(){return this._decelerationRate}set decelerationRate(t){this._decelerationRate=t}get isDragged(){return this._dragged}get percX(){return 0===this._overlapSize.x?0:this._xPos/this._overlapSize.x}set percX(t){this.setPercX(t,!1)}setPercX(t,i){this._layout.refresh(),this.setPosX(this._overlapSize.x*e.MathUtil.clamp01(t),i)}get percY(){return 0===this._overlapSize.y?0:this._yPos/this._overlapSize.y}set percY(t){this.setPercY(t,!1)}setPercY(t,i){this._layout.refresh(),this.setPosY(this._overlapSize.y*e.MathUtil.clamp01(t),i)}get posX(){return this._xPos}set posX(t){this.setPosX(t,!1)}setPosX(t,i){this._layout.refresh(),1===this._loop&&(t=this.loopCheckingNewPos(t,"x")),(t=e.MathUtil.clamp(t,0,this._overlapSize.x))!==this._xPos&&(this._xPos=t,this.posChanged(i))}get posY(){return this._yPos}set posY(t){this.setPosY(t,!1)}setPosY(t,i){this._layout.refresh(),1===this._loop&&(t=this.loopCheckingNewPos(t,"y")),(t=e.MathUtil.clamp(t,0,this._overlapSize.y))!==this._yPos&&(this._yPos=t,this.posChanged(i))}get contentWidth(){return this._contentSize.x}get contentHeight(){return this._contentSize.y}get viewWidth(){return this._viewSize.x}get viewHeight(){return this._viewSize.y}setViewSize(t,e){t=t+this._layout.padding[3]+this._layout.padding[1],this._vScrollBar&&!this._barFloating&&(t+=this._vScrollBar.width),e=e+this._layout.padding[0]+this._layout.padding[2],this._hScrollBar&&!this._barFloating&&(e+=this._hScrollBar.height),this._owner.size(t,e)}get pageX(){if(!this._pageMode)return 0;let t=Math.floor(this._xPos/this._pageSize.x);return this._xPos-t*this._pageSize.x>.5*this._pageSize.x&&t++,t}set pageX(t){this.setPageX(t,!1)}get pageY(){if(!this._pageMode)return 0;let t=Math.floor(this._yPos/this._pageSize.y);return this._yPos-t*this._pageSize.y>.5*this._pageSize.y&&t++,t}set pageY(t){this.setPageY(t,!1)}setPageX(t,e){this._pageMode&&(this._layout.refresh(),this._overlapSize.x>0&&this.setPosX(t*this._pageSize.x,e))}setPageY(t,e){this._pageMode&&(this._layout.refresh(),this._overlapSize.y>0&&this.setPosY(t*this._pageSize.y,e))}get pageCountX(){return Math.ceil(this._contentSize.x/this._viewSize.x)}get pageCountY(){return Math.ceil(this._contentSize.y/this._viewSize.y)}get isBottomMost(){return this._yPos===this._overlapSize.y||0===this._overlapSize.y}get isRightMost(){return this._xPos===this._overlapSize.x||0===this._overlapSize.x}get scrollingPosX(){return e.MathUtil.clamp(-this._container.x,0,this._overlapSize.x)}get scrollingPosY(){return e.MathUtil.clamp(-this._container.y,0,this._overlapSize.y)}scrollTop(t){this.setPercY(0,t)}scrollBottom(t){this.setPercY(1,t)}scrollUp(t,e){t=t||1,this._pageMode?this.setPosY(this._yPos-this._pageSize.y*t,e):this.setPosY(this._yPos-this._step*t,e)}scrollDown(t,e){t=t||1,this._pageMode?this.setPosY(this._yPos+this._pageSize.y*t,e):this.setPosY(this._yPos+this._step*t,e)}scrollLeft(t,e){t=t||1,this._pageMode?this.setPosX(this._xPos-this._pageSize.x*t,e):this.setPosX(this._xPos-this._step*t,e)}scrollRight(t,e){t=t||1,this._pageMode?this.setPosX(this._xPos+this._pageSize.x*t,e):this.setPosX(this._xPos+this._step*t,e)}getRect(t,i){return t._parent!=this._owner._$container?e.SpriteUtils.transformRect(t._parent,i.setTo(t.x,t.y,t.width,t.height),this._owner._$container,i):i.setTo(t.x,t.y,t.width,t.height),i}scrollTo(t,i,s){let h,r,o;if(this._layout.refresh(),this._needRefresh&&this.refresh(),"number"==typeof t&&(t=this._layout instanceof ft&&this._layout._virtual?this._layout.getRectByItemIndex(t):this._owner.getChildAt(t)),t instanceof e.Rectangle)h=t;else{if(null==t.parent)return;h=this.getRect(t,Dt)}if(s instanceof F)if(s!=t&&null!=s.parent){let t=this.getRect(s,At);this._overlapSize.x>0&&h.right-t.x>this._viewSize.x&&(h.x=t.x,h.width=t.width,r=!0),this._overlapSize.y>0&&h.bottom-t.y>this._viewSize.y&&(h.y=t.y,h.height=t.height,o=!0)}else r=o=!1;else r=o=!!s;if(this._overlapSize.y>0){let t=this._yPos+this._viewSize.y;if(r||h.y<=this._yPos){if(!r&&h.y+h.height>=t)return;this._pageMode?this.setPosY(Math.floor(h.y/this._pageSize.y)*this._pageSize.y,i):this.setPosY(h.y,i)}else h.y+h.height>t&&(this._pageMode?this.setPosY(Math.floor(h.y/this._pageSize.y)*this._pageSize.y,i):h.height<=this._viewSize.y/2?this.setPosY(h.y+2*h.height-this._viewSize.y,i):this.setPosY(h.y+Math.min(h.height-this._viewSize.y,0),i))}if(this._overlapSize.x>0){let t=this._xPos+this._viewSize.x;if(o||h.x<=this._xPos){if(!o&&h.x+h.width>=t)return;this._pageMode?this.setPosX(Math.floor(h.x/this._pageSize.x)*this._pageSize.x,i):this.setPosX(h.x,i)}else h.x+h.width>t&&(this._pageMode?this.setPosX(Math.floor(h.x/this._pageSize.x)*this._pageSize.x,i):h.width<=this._viewSize.x/2?this.setPosX(h.x+2*h.width-this._viewSize.x,i):this.setPosX(h.x+Math.min(h.width-this._viewSize.x,0),i))}!i&&this._needRefresh&&this.refresh()}isChildInView(t){if(this._overlapSize.y>0){let e=t.top+this._container.y;if(e<-t.height||e>this._viewSize.y)return!1}if(this._overlapSize.x>0){let e=t.left+this._container.x;if(e<-t.width||e>this._viewSize.x)return!1}return!0}getFirstChildInView(){let t=0;for(let e of this._owner.children){if(2===e._nodeType&&this.isChildInView(e))return t;t++}return-1}cancelDragging(){e.ILaya.stage.off(e.Event.MOUSE_MOVE,this,this._touchMove),e.ILaya.stage.off(e.Event.MOUSE_UP,this,this._touchEnd),jt==this&&(jt=null),Ot=0,this._dragged=!1}_setDefaultDirection(){let e=this._layout;e.pageMode||(e.type===t.LayoutType.SingleColumn||e.type===t.LayoutType.FlowX?this.direction=t.ScrollDirection.Vertical:e.type!==t.LayoutType.SingleRow&&e.type!==t.LayoutType.FlowY||(this.direction=t.ScrollDirection.Horizontal))}createVtScrollBar(i){if(this._owner){if(i){let t=this._vScrollBar;return this._vScrollBar=null,this.createVtScrollBar(),void(t&&t!==this._vScrollBar&&(t.destroy(),this.onSizeChanged()))}if(this._barDisplay===t.ScrollBarDisplay.Hidden||this._dir!==t.ScrollDirection.Both&&this._dir!==t.ScrollDirection.Vertical)this._vScrollBar&&(this._vScrollBar.destroy(),this._vScrollBar=null,this.onSizeChanged());else{if(this._vScrollBar)return;let i=this._vScrollBarRes?this._vScrollBarRes:R.verticalScrollBar?e.ILaya.loader.getRes(R.verticalScrollBar):null;if(i){if(this._vScrollBar=i.create(),!this._vScrollBar)return void console.warn("failed to create a vertical scrollbar");this._vScrollBar.hideFlags|=e.HideFlags.HideAndDontSave,this._vScrollBar.setOwner(this,!0),this._vScrollBar.visible=this._barDisplay!==t.ScrollBarDisplay.OnScroll,this._owner._addChild(this._vScrollBar),this.onSizeChanged()}}}}createHzScrollBar(i){if(this._owner){if(i){let t=this._hScrollBar;this._hScrollBar=null,this.createHzScrollBar(),t&&t!==this._hScrollBar&&(t.destroy(),this.onSizeChanged())}if(this._barDisplay===t.ScrollBarDisplay.Hidden||this._dir!==t.ScrollDirection.Both&&this._dir!==t.ScrollDirection.Horizontal)this._hScrollBar&&(this._hScrollBar.destroy(),this._hScrollBar=null,this.onSizeChanged());else{if(this._hScrollBar)return;let i=this._hScrollBarRes?this._hScrollBarRes:R.horizontalScrollBar?e.ILaya.loader.getRes(R.horizontalScrollBar):null;if(i){if(this._hScrollBar=i.create(),!this._hScrollBar)return void console.warn("failed to create a horizontal scrollbar");this._hScrollBar.hideFlags|=e.HideFlags.HideAndDontSave,this._hScrollBar.setOwner(this,!1),this._hScrollBar.visible=this._barDisplay!==t.ScrollBarDisplay.OnScroll,this._owner._addChild(this._hScrollBar),this.onSizeChanged()}}}}createHeader(){this._header&&(this._header.destroy(),this._header=null),this._headerRes&&(this._header=this._headerRes.create(),this._header&&(this._header.hideFlags|=e.HideFlags.HideAndDontSave)),this._header||this._footer?this._refreshBarAxis=this._dir===t.ScrollDirection.Both||this._dir===t.ScrollDirection.Vertical?"y":"x":this._refreshBarAxis=null}createFooter(){this._footer&&(this._footer.destroy(),this._footer=null),this._footerRes&&(this._footer=this._footerRes.create(),this._footer&&(this._footer.hideFlags|=e.HideFlags.HideAndDontSave)),this._header||this._footer?this._refreshBarAxis=this._dir===t.ScrollDirection.Both||this._dir===t.ScrollDirection.Vertical?"y":"x":this._refreshBarAxis=null}lockHeader(t){this._headerLockedSize!==t&&(this._headerLockedSize=t,!this._refreshEventDispatching&&this._container[this._refreshBarAxis]>=0&&(this._tweenStart.setTo(this._container.x,this._container.y),this._tweenChange.setTo(0,0),this._tweenChange[this._refreshBarAxis]=this._headerLockedSize-this._tweenStart[this._refreshBarAxis],this._tweenDuration.setTo(Nt,Nt),this.startTween(2)))}lockFooter(t){if(this._footerLockedSize!==t&&(this._footerLockedSize=t,!this._refreshEventDispatching&&this._container[this._refreshBarAxis]<=-this._overlapSize[this._refreshBarAxis])){this._tweenStart.setTo(this._container.x,this._container.y),this._tweenChange.setTo(0,0);let t=this._overlapSize[this._refreshBarAxis];0===t?t=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):t+=this._footerLockedSize,this._tweenChange[this._refreshBarAxis]=-t-this._tweenStart[this._refreshBarAxis],this._tweenDuration.setTo(Nt,Nt),this.startTween(2)}}_shouldCheckOverflow(){return this._barDisplay===t.ScrollBarDisplay.OnOverflow||this._barDisplay===t.ScrollBarDisplay.OnOverflowAndScroll?(null!=this._vScrollBar?1:0)+(null!=this._hScrollBar?2:0):null}_processClipping(){this._owner&&(this._maskContainer.scrollRect=!this._paddingMaskDisabled&&this._owner.clipping?this._cachedScrollRect:null)}_ownerSizeChanged(){this.onSizeChanged(),this.posChanged(!1)}onSizeChanged(){var t,e,i;if(!this._owner)return;let s,h,r=this._owner.width,o=this._owner.height,l=this._layout.padding;s=this._barOnLeft&&this._vScrollBar&&!this._barFloating?Math.floor(l[3]+this._vScrollBar.width):Math.floor(l[3]),h=Math.floor(l[0]),this._maskContainer.pos(s,h),this._hScrollBar&&(this._hScrollBar.pos(this._barMargin[3]+(this._barOnLeft&&(null===(t=this._vScrollBar)||void 0===t?void 0:t.width)||0),o-this._hScrollBar.height-this._barMargin[2]),this._hScrollBar.width=r-((null===(e=this._vScrollBar)||void 0===e?void 0:e.width)||0)-this._barMargin[3]-this._barMargin[1]),this._vScrollBar&&(this._vScrollBar.pos(this._barOnLeft?this._barMargin[3]:r-this._vScrollBar.width-this._barMargin[1],this._barMargin[0]),this._vScrollBar.height=o-((null===(i=this._hScrollBar)||void 0===i?void 0:i.height)||0)-this._barMargin[0]-this._barMargin[2]),this._viewSize.x=r,this._viewSize.y=o,this._hScrollBar&&!this._barFloating&&(this._viewSize.y-=this._hScrollBar.height),this._vScrollBar&&!this._barFloating&&(this._viewSize.x-=this._vScrollBar.width),this._viewSize.x-=l[3]+l[1],this._viewSize.y-=l[0]+l[2],this._viewSize.x=Math.max(1,this._viewSize.x),this._viewSize.y=Math.max(1,this._viewSize.y),this._pageSize.x=this._viewSize.x,this._pageSize.y=this._viewSize.y,this.onContentSizeChanged()}_ownerContentSizeChanged(){let t=this._layout.contentWidth,e=this._layout.contentHeight;this._contentSize.x===t&&this._contentSize.y===e||(this._contentSize.x=t,this._contentSize.y=e,this.onContentSizeChanged())}_changeContentSizeOnScrolling(t,e,i,s){let h=0!==this._xPos&&this._xPos===this._overlapSize.x,r=0!==this._yPos&&this._yPos===this._overlapSize.y;this._contentSize.x+=t,this._contentSize.y+=e,this.onContentSizeChanged(),1===this._tweening?(0!==t&&h&&this._tweenChange.x<0&&(this._xPos=this._overlapSize.x,this._tweenChange.x=-this._xPos-this._tweenStart.x),0!==e&&r&&this._tweenChange.y<0&&(this._yPos=this._overlapSize.y,this._tweenChange.y=-this._yPos-this._tweenStart.y)):2===this._tweening?(0!==i&&(this._container.x-=i,this._tweenStart.x-=i,this._xPos=-this._container.x),0!==s&&(this._container.y-=s,this._tweenStart.y-=s,this._yPos=-this._container.y)):this._dragged?(0!==i&&(this._container.x-=i,this._containerPos.x-=i,this._xPos=-this._container.x),0!==s&&(this._container.y-=s,this._containerPos.y-=s,this._yPos=-this._container.y)):(0!==t&&h&&(this._xPos=this._overlapSize.x,this._container.x=-this._xPos),0!==e&&r&&(this._yPos=this._overlapSize.y,this._container.y=-this._yPos))}onContentSizeChanged(){if(!this._owner)return;this._barDisplay!==t.ScrollBarDisplay.OnOverflow&&this._barDisplay!==t.ScrollBarDisplay.OnOverflowAndScroll||(this._vScrollNone=this._contentSize.y<=this._viewSize.y,this._hScrollNone=this._contentSize.x<=this._viewSize.x,this._vScrollBar&&this._hScrollBar&&(this._hScrollNone?this._vScrollBar.height=this._owner.height-this._barMargin[0]-this._barMargin[2]:this._vScrollBar.height=this._owner.height-this._hScrollBar.height-this._barMargin[0]-this._barMargin[2],this._vScrollNone?this._hScrollBar.width=this._owner.width-this._barMargin[3]-this._barMargin[1]:this._hScrollBar.width=this._owner.width-this._vScrollBar.width-this._barMargin[3]-this._barMargin[1])),this._vScrollBar&&(0===this._contentSize.y?this._vScrollBar.setDisplayPerc(0):this._vScrollBar.setDisplayPerc(Math.min(1,this._viewSize.y/this._contentSize.y))),this._hScrollBar&&(0===this._contentSize.x?this._hScrollBar.setDisplayPerc(0):this._hScrollBar.setDisplayPerc(Math.min(1,this._viewSize.x/this._contentSize.x))),this._updateScrollBarVisible();let i=this._viewSize.x,s=this._viewSize.y;if(this._vScrollNone&&null!=this._vScrollBar&&(i+=this._vScrollBar.width),this._hScrollNone&&null!=this._hScrollBar&&(s+=this._hScrollBar.height),this._maskContainer.size(i,s),this._cachedScrollRect.setTo(0,0,i,s),null!=this._maskContainer._scrollRect&&(this._maskContainer.scrollRect=this._cachedScrollRect),this._dir===t.ScrollDirection.Horizontal||this._dir===t.ScrollDirection.Both?this._overlapSize.x=Math.ceil(Math.max(0,this._contentSize.x-this._viewSize.x)):this._overlapSize.x=0,this._dir===t.ScrollDirection.Vertical||this._dir===t.ScrollDirection.Both?this._overlapSize.y=Math.ceil(Math.max(0,this._contentSize.y-this._viewSize.y)):this._overlapSize.y=0,this._xPos=e.MathUtil.clamp(this._xPos,0,this._overlapSize.x),this._yPos=e.MathUtil.clamp(this._yPos,0,this._overlapSize.y),this._refreshBarAxis){let t=this._overlapSize[this._refreshBarAxis];0===t?t=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):t+=this._footerLockedSize,"x"==this._refreshBarAxis?this._container.pos(e.MathUtil.clamp(this._container.x,-t,this._headerLockedSize),e.MathUtil.clamp(this._container.y,-this._overlapSize.y,0)):this._container.pos(e.MathUtil.clamp(this._container.x,-this._overlapSize.x,0),e.MathUtil.clamp(this._container.y,-t,this._headerLockedSize)),this._header&&("x"==this._refreshBarAxis?this._header.height=this._viewSize.y:this._header.width=this._viewSize.x),this._footer&&("x"==this._refreshBarAxis?this._footer.height=this._viewSize.y:this._footer.width=this._viewSize.x)}else this._container.pos(e.MathUtil.clamp(this._container.x,-this._overlapSize.x,0),e.MathUtil.clamp(this._container.y,-this._overlapSize.y,0));this.updateScrollBarPos()}posChanged(t){0===this._aniFlag?this._aniFlag=t?1:-1:1!==this._aniFlag||t||(this._aniFlag=-1),this._needRefresh=!0,e.ILaya.timer.callLater(this,this.refresh)}refresh(){null!=this._owner&&(this._needRefresh=!1,e.ILaya.timer.clear(this,this.refresh),(this._pageMode||this._snapToItem)&&(Ft.setTo(-this._xPos,-this._yPos),this.alignPosition(Ft,!1),this._xPos=-Ft.x,this._yPos=-Ft.y),this.refresh2(),this._owner.event(t.UIEvent.Scroll),this._needRefresh&&(this._needRefresh=!1,e.ILaya.timer.clear(this,this.refresh),this.refresh2()),this.updateScrollBarPos(),this._aniFlag=0)}refresh2(){if(1!==this._aniFlag||this._dragged)0!==this._tweening&&this.killTween(),this._container.pos(Math.floor(-this._xPos),Math.floor(-this._yPos)),this.loopCheckingCurrent();else{let t,e;this._overlapSize.x>0?t=-Math.floor(this._xPos):(0!==this._container.x&&(this._container.x=0),t=0),this._overlapSize.y>0?e=-Math.floor(this._yPos):(0!==this._container.y&&(this._container.y=0),e=0),t!==this._container.x||e!==this._container.y?(this._tweenDuration.setTo(.5,.5),this._tweenStart.setTo(this._container.x,this._container.y),this._tweenChange.setTo(t-this._tweenStart.x,e-this._tweenStart.y),this.startTween(1)):0!==this._tweening&&this.killTween()}}_touchBegin(t){if(!this._touchEffect||this._touchEffectButton!==t.button)return;0!==this._tweening?(this.killTween(),e.InputManager.cancelClick(t.touchId),this._dragged=!0):this._dragged=!1;let i=this._owner.parent.globalToLocal(kt.copy(t.touchPos));this._containerPos.setTo(this._container.x,this._container.y),this._beginTouchPos.setTo(i.x,i.y),this._isHoldAreaDone=!1,this._slidingPoints.length=0,this._slidingPoints.push(i.x,i.y,performance.now()),e.ILaya.stage.on(e.Event.MOUSE_MOVE,this,this._touchMove),e.ILaya.stage.on(e.Event.MOUSE_UP,this,this._touchEnd)}_touchMove(i){var s;if(!this._touchEffect||this.owner.destroyed)return;if((null===(s=null==jt?void 0:jt.owner)||void 0===s?void 0:s.displayedInStage)&&jt!=this)return;let h,r,o,l=R.touchScrollSensitivity,n=this._owner.parent.globalToLocal(kt.copy(i.touchPos)),a=n.x-this._slidingPoints[this._slidingPoints.length-3],_=n.y-this._slidingPoints[this._slidingPoints.length-2];if(this._dir===t.ScrollDirection.Vertical){if(!this._isHoldAreaDone){if(Ot|=1,h=Math.abs(_),h<l)return;if(2&Ot){if(h<Math.abs(a))return}}r=!0}else if(this._dir===t.ScrollDirection.Horizontal){if(!this._isHoldAreaDone){if(Ot|=2,h=Math.abs(a),h<l)return;if(1&Ot){if(h<Math.abs(_))return}}o=!0}else{if(Ot=3,!this._isHoldAreaDone&&(h=Math.abs(_),h<l&&(h=Math.abs(a),h<l)))return;r=o=!0}let d=Math.floor(this._containerPos.x+n.x-this._beginTouchPos.x),c=Math.floor(this._containerPos.y+n.y-this._beginTouchPos.y);r&&(c>0?this._bouncebackEffect?this._container.y=Math.floor(Math.min(.5*c,this._viewSize.y*Ht)):this._container.y=0:c<-this._overlapSize.y?this._bouncebackEffect?this._container.y=Math.floor(Math.max(.5*(c+this._overlapSize.y),-this._viewSize.y*Ht)-this._overlapSize.y):this._container.y=-this._overlapSize.y:this._container.y=c),o&&(d>0?this._bouncebackEffect?this._container.x=Math.floor(Math.min(.5*d,this._viewSize.x*Ht)):this._container.x=0:d<0-this._overlapSize.x?this._bouncebackEffect?this._container.x=Math.floor(Math.max(.5*(d+this._overlapSize.x),-this._viewSize.x*Ht)-this._overlapSize.x):this._container.x=-this._overlapSize.x:this._container.x=d);let u=performance.now();for(;this._slidingPoints.length>0&&this._slidingPoints[2]<u-100;)this._slidingPoints.splice(0,3);this._slidingPoints.push(n.x,n.y,u),this._overlapSize.x>0&&(this._xPos=e.MathUtil.clamp(-this._container.x,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=e.MathUtil.clamp(-this._container.y,0,this._overlapSize.y)),0!==this._loop&&(d=this._container.x,c=this._container.y,this.loopCheckingCurrent()&&(this._containerPos.x+=this._container.x-d,this._containerPos.y+=this._container.y-c)),jt=this,this._isHoldAreaDone=!0,this._dragged=!0,this.updateScrollBarPos(),this._updateScrollBarVisible(),this._owner.event(t.UIEvent.Scroll)}_touchEnd(){if(e.ILaya.stage.off(e.Event.MOUSE_MOVE,this,this._touchMove),e.ILaya.stage.off(e.Event.MOUSE_UP,this,this._touchEnd),jt==this&&(jt=null),Ot=0,!this._dragged||!this._touchEffect)return void(this._dragged=!1);this._dragged=!1,this._tweenStart.setTo(this._container.x,this._container.y),Ft.setTo(this._tweenStart.x,this._tweenStart.y);let i=!1;if(this._container.x>0?(Ft.x=0,i=!0):this._container.x<-this._overlapSize.x&&(Ft.x=-this._overlapSize.x,i=!0),this._container.y>0?(Ft.y=0,i=!0):this._container.y<-this._overlapSize.y&&(Ft.y=-this._overlapSize.y,i=!0),i){if(this._tweenChange.setTo(Ft.x-this._tweenStart.x,Ft.y-this._tweenStart.y),this._tweenChange.x<-R.touchDragSensitivity||this._tweenChange.y<-R.touchDragSensitivity?(this._refreshEventDispatching=!0,this._owner.event(t.UIEvent.PullDownRelease),this._refreshEventDispatching=!1):(this._tweenChange.x>R.touchDragSensitivity||this._tweenChange.y>R.touchDragSensitivity)&&(this._refreshEventDispatching=!0,this._owner.event(t.UIEvent.PullUpRelease),this._refreshEventDispatching=!1),this._headerLockedSize>0&&0===Ft[this._refreshBarAxis])Ft[this._refreshBarAxis]=this._headerLockedSize,this._tweenChange.x=Ft.x-this._tweenStart.x,this._tweenChange.y=Ft.y-this._tweenStart.y;else if(this._footerLockedSize>0&&Ft[this._refreshBarAxis]===-this._overlapSize[this._refreshBarAxis]){let t=this._overlapSize[this._refreshBarAxis];0===t?t=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):t+=this._footerLockedSize,Ft[this._refreshBarAxis]=-t,this._tweenChange.x=Ft.x-this._tweenStart.x,this._tweenChange.y=Ft.y-this._tweenStart.y}this._tweenDuration.setTo(Nt,Nt)}else{if(this._inertiaDisabled)this._tweenDuration.setTo(Nt,Nt);else{let t=e.DragSupport.computeVelocity(this._slidingPoints);this.updateTargetAndDuration(this._tweenStart,t,"x",Ft,this._tweenDuration),this.updateTargetAndDuration(this._tweenStart,t,"y",Ft,this._tweenDuration)}if(Wt.setTo(Ft.x-this._tweenStart.x,Ft.y-this._tweenStart.y),this.loopCheckingTarget(Ft),(this._pageMode||this._snapToItem)&&this.alignPosition(Ft,!0),this._tweenChange.x=Ft.x-this._tweenStart.x,this._tweenChange.y=Ft.y-this._tweenStart.y,0===this._tweenChange.x&&0===this._tweenChange.y)return void this._updateScrollBarVisible();(this._pageMode||this._snapToItem)&&(this.fixDuration("x",Wt.x),this.fixDuration("y",Wt.y))}this.startTween(2)}_mouseWheel(e){if(this._mouseWheelDisabled||this._barDisplay===t.ScrollBarDisplay.Hidden)return;let i=e.delta;if(this._snapToItem&&Math.abs(i)<1&&(i=Math.sign(i)),this._overlapSize.x>0&&0===this._overlapSize.y){let t=this._pageMode?this._pageSize.x:this._step;this.setPosX(this._xPos+t*i,!1),e.stopPropagation()}else{let t=this._pageMode?this._pageSize.y:this._step;this.setPosY(this._yPos+t*i,!1),e.stopPropagation()}}_rollOver(){this._hover=!0,this._barDisplay!==t.ScrollBarDisplay.OnScroll&&this._barDisplay!==t.ScrollBarDisplay.OnOverflowAndScroll||this._updateScrollBarVisible()}_rollOut(){this._hover=!1,this._barDisplay!==t.ScrollBarDisplay.OnScroll&&this._barDisplay!==t.ScrollBarDisplay.OnOverflowAndScroll||this._updateScrollBarVisible()}updateScrollBarPos(){this._vScrollBar&&this._vScrollBar.setScrollPerc(0===this._overlapSize.y?0:e.MathUtil.clamp(-this._container.y,0,this._overlapSize.y)/this._overlapSize.y),this._hScrollBar&&this._hScrollBar.setScrollPerc(0===this._overlapSize.x?0:e.MathUtil.clamp(-this._container.x,0,this._overlapSize.x)/this._overlapSize.x),this.checkRefreshBar()}_updateScrollBarVisible(){this._vScrollBar&&(this._viewSize.y<=this._vScrollBar.minSize||this._vScrollNone?this._vScrollBar.visible=!1:this.updateScrollBarVisible2(this._vScrollBar)),this._hScrollBar&&(this._viewSize.x<=this._hScrollBar.minSize||this._hScrollNone?this._hScrollBar.visible=!1:this.updateScrollBarVisible2(this._hScrollBar))}updateScrollBarVisible2(i){let s=this._barDisplay===t.ScrollBarDisplay.OnScroll||this._barDisplay===t.ScrollBarDisplay.OnOverflowAndScroll;s&&e.Tween.killAll(i),!s||this._hover||0!==this._tweening||this._dragged||i.gripDragging?(i.alpha=1,i.visible=!0):i.visible&&e.Tween.create(i).go("alpha",1,0).duration(.5).delay(.5).then(this._barTweenComplete,this)}_barTweenComplete(t){let e=t.target;e.alpha=1,e.visible=!1}getLoopPartSize(t,e){return(this._contentSize[e]+("x"==e?this._owner.layout.columnGap:this._owner.layout.rowGap))/t}loopCheckingCurrent(){let t=!1;return 1===this._loop&&this._overlapSize.x>0?this._xPos<.001?(this._xPos+=this.getLoopPartSize(2,"x"),t=!0):this._xPos>=this._overlapSize.x&&(this._xPos-=this.getLoopPartSize(2,"x"),t=!0):2===this._loop&&this._overlapSize.y>0&&(this._yPos<.001?(this._yPos+=this.getLoopPartSize(2,"y"),t=!0):this._yPos>=this._overlapSize.y&&(this._yPos-=this.getLoopPartSize(2,"y"),t=!0)),t&&this._container.pos(Math.floor(-this._xPos),Math.floor(-this._yPos)),t}loopCheckingTarget(t){1===this._loop&&this.loopCheckingTarget2(t,"x"),2===this._loop&&this.loopCheckingTarget2(t,"y")}loopCheckingTarget2(t,e){let i,s;t[e]>0?(i=this.getLoopPartSize(2,e),s=this._tweenStart[e]-i,s<=0&&s>=-this._overlapSize[e]&&(t[e]-=i,this._tweenStart[e]=s)):t[e]<-this._overlapSize[e]&&(i=this.getLoopPartSize(2,e),s=this._tweenStart[e]+i,s<=0&&s>=-this._overlapSize[e]&&(t[e]+=i,this._tweenStart[e]=s))}loopCheckingNewPos(t,i){if(0===this._overlapSize[i])return t;let s,h="x"==i?this._xPos:this._yPos,r=!1;return t<.001?(t+=this.getLoopPartSize(2,i))>h&&(s=this.getLoopPartSize(6,i),s=Math.ceil((t-h)/s)*s,h=e.MathUtil.clamp(h+s,0,this._overlapSize[i]),r=!0):t>=this._overlapSize[i]&&(t-=this.getLoopPartSize(2,i))<h&&(s=this.getLoopPartSize(6,i),s=Math.ceil((h-t)/s)*s,h=e.MathUtil.clamp(h-s,0,this._overlapSize[i]),r=!0),r&&("x"==i?this._container.x=-Math.floor(h):this._container.y=-Math.floor(h)),t}alignPosition(t,e){if(this._pageMode)t.x=this.alignByPage(t.x,"x",e),t.y=this.alignByPage(t.y,"y",e);else if(this._snapToItem){let i=0,s=0;e&&(i=t.x-this._containerPos.x,s=t.y-this._containerPos.y);let h=this._layout.getSnappingPosition(-t.x,-t.y,i,s,kt);t.x<0&&t.x>-this._overlapSize.x&&(t.x=-h.x),t.y<0&&t.y>-this._overlapSize.y&&(t.y=-h.y)}}alignByPage(t,e,i){let s;if(t>0)s=0;else if(t<-this._overlapSize[e])s=Math.ceil(this._contentSize[e]/this._pageSize[e])-1;else{s=Math.floor(-t/this._pageSize[e]);let h=i?t-this._containerPos[e]:t-this._container[e],r=Math.min(this._pageSize[e],this._contentSize[e]-(s+1)*this._pageSize[e]),o=-t-s*this._pageSize[e];Math.abs(h)>this._pageSize[e]?o>.5*r&&s++:o>r*(h<0?R.defaultScrollPagingThreshold:1-R.defaultScrollPagingThreshold)&&s++,(t=-s*this._pageSize[e])<-this._overlapSize[e]&&(t=-this._overlapSize[e])}if(i){let i,h=this._tweenStart[e];i=h>0?0:h<-this._overlapSize[e]?Math.ceil(this._contentSize[e]/this._pageSize[e])-1:Math.floor(-h/this._pageSize[e]);let r=Math.floor(-this._containerPos[e]/this._pageSize[e]);Math.abs(s-r)>1&&Math.abs(i-r)<=1&&(s=s>r?r+1:r-1,t=-s*this._pageSize[e])}return t}updateTargetAndDuration(t,e,i,s,h){let r=t[i],o=e[i];if(r>0||0===this._overlapSize[i])s[i]=0,h[i]=Nt;else if(r<-this._overlapSize[i])s[i]=-this._overlapSize[i],h[i]=Nt;else if(0!==o){let t=R.defaultScrollDecelerationRate,e=Math.log(t),l=-Math.log(Math.abs(o))/e;e=t*(1-Math.pow(t,l))/(1-t);let n=o*e;Math.abs(n)<=1&&(n=0,l=0),s[i]=r+n,h[i]=.0166*l}else s[i]=r,h[i]=0}fixDuration(t,e){if(0===this._tweenChange[t]||Math.abs(this._tweenChange[t])>=Math.abs(e))return void(0===e&&(this._tweenDuration[t]=Nt));let i=Math.abs(this._tweenChange[t]/e)*this._tweenDuration[t];i<Nt&&(i=Nt),this._tweenDuration[t]=i}startTween(t){this._tweenTime.setTo(0,0),this._tweening=t,e.ILaya.timer.frameLoop(1,this,this.tweenUpdate),this._updateScrollBarVisible()}killTween(){1===this._tweening&&(this._container.pos(this._tweenStart.x+this._tweenChange.x,this._tweenStart.y+this._tweenChange.y),this._owner.event(t.UIEvent.Scroll)),this._tweening=0,e.ILaya.timer.clear(this,this.tweenUpdate),this._updateScrollBarVisible(),this._owner.event(t.UIEvent.ScrollEnd)}checkRefreshBar(){if(null==this._header&&null==this._footer)return;let t=this._container[this._refreshBarAxis];if(this._header)if(t>0){this._header.parent||this._maskContainer.addChildAt(this._header,this._maskContainer.getChildIndex(this._container));let e=kt;e.setTo(this._header.width,this._header.height),e[this._refreshBarAxis]=t,this._header.size(e.x,e.y)}else this._header.removeSelf();if(this._footer){let e=this._overlapSize[this._refreshBarAxis];if(t<-e||0===e&&this._footerLockedSize>0){this._footer.parent||this._maskContainer.addChildAt(this._footer,this._maskContainer.getChildIndex(this._container));let i=kt;i.setTo(this._footer.x,this._footer.y),i[this._refreshBarAxis]=e>0?t+this._contentSize[this._refreshBarAxis]:Math.max(Math.min(t+this._viewSize[this._refreshBarAxis],this._viewSize[this._refreshBarAxis]-this._footerLockedSize),this._viewSize[this._refreshBarAxis]-this._contentSize[this._refreshBarAxis]),this._footer.setLeftTop(i.x,i.y),i.setTo(this._footer.width,this._footer.height),i[this._refreshBarAxis]=e>0?-e-t:this._viewSize[this._refreshBarAxis]-this._footer[this._refreshBarAxis],this._footer.size(i.x,i.y)}else this._footer.removeSelf()}}tweenUpdate(){let i=this.runTween("x"),s=this.runTween("y");this._container.pos(i,s),2===this._tweening&&(this._overlapSize.x>0&&(this._xPos=e.MathUtil.clamp(-i,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=e.MathUtil.clamp(-s,0,this._overlapSize.y))),0===this._tweenChange.x&&0===this._tweenChange.y?(this._tweening=0,e.ILaya.timer.clear(this,this.tweenUpdate),this.loopCheckingCurrent(),this.updateScrollBarPos(),this._updateScrollBarVisible(),this._owner.event(t.UIEvent.Scroll),this._owner.event(t.UIEvent.ScrollEnd)):(this.updateScrollBarPos(),this._owner.event(t.UIEvent.Scroll))}runTween(t){let i;if(0!==this._tweenChange[t]){if(this._tweenTime[t]+=e.ILaya.timer.delta/1e3,this._tweenTime[t]>=this._tweenDuration[t])i=this._tweenStart[t]+this._tweenChange[t],this._tweenChange[t]=0;else{let e=(s=this._tweenTime[t],h=this._tweenDuration[t],(s=s/h-1)*s*s+1);i=this._tweenStart[t]+Math.floor(this._tweenChange[t]*e)}let r=0,o=-this._overlapSize[t];if(this._headerLockedSize>0&&this._refreshBarAxis===t&&(r=this._headerLockedSize),this._footerLockedSize>0&&this._refreshBarAxis===t){let t=this._overlapSize[this._refreshBarAxis];0===t?t=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):t+=this._footerLockedSize,o=-t}2===this._tweening&&this._bouncebackEffect?i>20+r&&this._tweenChange[t]>0||i>r&&0===this._tweenChange[t]?(this._tweenTime[t]=0,this._tweenDuration[t]=Nt,this._tweenChange[t]=-i+r,this._tweenStart[t]=i):(i<o-20&&this._tweenChange[t]<0||i<o&&0===this._tweenChange[t])&&(this._tweenTime[t]=0,this._tweenDuration[t]=Nt,this._tweenChange[t]=o-i,this._tweenStart[t]=i):i>r?(i=r,this._tweenChange[t]=0):i<o&&(i=o,this._tweenChange[t]=0)}else i=this._container[t];var s,h;return i}}class Ut{load(t){let e=t.url;return t.loader.fetch(e,"json",t.progress.createCallback(.2),t.options).then(e=>{if(!e)return null;let i,s=e.files||{},h=s[st.provider.language];return h||st.provider.language==e.defaultLanguage||(h=s[e.fallbackLanguage]),i=h?t.loader.fetch(h,"json",t.progress.createCallback(.8),t.options):Promise.resolve({}),i.then(i=>{let s;return s=t.obsoluteInst&&t.obsoluteInst.id==e.id?t.obsoluteInst:st.create(e.id),s.setContent(st.provider.language,i),s})})}}let Vt=e.ClassUtils.regClass;Vt("GWidget",F),Vt("GImage",nt),Vt("GMovieClip",Ct),Vt("GLoader",O),Vt("GTextField",ht),Vt("GTextInput",rt),Vt("GBox",tt),Vt("GPanel",St),Vt("GLabel",lt),Vt("GButton",ct),Vt("GComboBox",ut),Vt("GList",vt),Vt("GProgressBar",It),Vt("GScrollBar",bt),Vt("GSlider",Pt),Vt("GTree",Et),Vt("GWindow",N),Vt("GRoot",U),Vt("Controller",z),Vt("ControllerRef",E),Vt("Relation",D),Vt("Gear",x),Vt("GearDisplay",B),Vt("GearBool",I),Vt("GearNumber",v),Vt("GearString",C),Vt("GearColor",b),Vt("GearStrColor",T),Vt("GearHexColor",P),Vt("GearTweenConfig",Rt),Vt("Selection",mt),Vt("Scroller",Gt),Vt("Layout",X),Vt("StretchParam",Y),Vt("ItemData",class extends Object{}),e.Loader.registerLoader(["i18ns"],Ut);const Yt="click_menu_item";class Xt extends e.EventDispatcher{constructor(i,s){super(),this.visibleItemCount=0,this.hideOnClickItem=!0,this.autoSize=!1,i||(i=R.popupMenu);let h=i?e.Loader.getRes(i):null;if(!i)throw new Error("UIConfig.popupMenu not defined");this._seperatorRes=s||R.popupMenuSeperator,this._content=h.create(),this._initWidth=this._content.width,this._list=this._content.getChild("list"),this._list.removeChildrenToPool(),this._list.addRelation(this._content,t.RelationType.Width),this._list.removeRelation(this._content,t.RelationType.Height),this._content.addRelation(this._list,t.RelationType.Height),this._list.on(t.UIEvent.ClickItem,this,this._clickItem)}destroy(){this._content.destroy()}addItem(t,e,i){let s=this.createItem(t,e,i);return this._list.addChild(s),s}addItemAt(t,e,i,s){let h=this.createItem(t,i,s);return this._list.addChildAt(h,e),h}createItem(t,e,i){let s=this._list.getFromPool();s.text=t,s.grayed=!1;let h=s.getController("checked");return h&&(h.selectedIndex=0),s.offAll(Yt),e&&s.on(Yt,i,e,[s]),s}addSeperator(t){if(null==t||-1==t)this._list.addItemFromPool(this._seperatorRes);else{let e=this._list.getFromPool(this._seperatorRes);this._list.addChildAt(e,t)}}getItemName(t){return this._list.getChildAt(t).name}setItemText(t,e){this._list.getChild(t).text=e}setItemVisible(t,e){this._list.getChild(t).visible=e}setItemGrayed(t,e){this._list.getChild(t).grayed=e}setItemCheckable(t,e){let i=this._list.getChild(t).getController("checked");i&&(e?0==i.selectedIndex&&(i.selectedIndex=1):i.selectedIndex=0)}setItemChecked(t,e){let i=this._list.getChild(t).getController("checked");i&&(i.selectedIndex=e?2:1)}isItemChecked(t){let e=this._list.getChild(t).getController("checked");return!!e&&2==e.selectedIndex}removeItem(t){let e=this._list.getChild(t);if(e){let t=this._list.getChildIndex(e);return this._list.removeChildToPoolAt(t),!0}return!1}clearItems(){this._list.removeChildrenToPool()}get itemCount(){return this._list.numChildren}get contentPane(){return this._content}get list(){return this._list}show(e,i,s){if(!U.inst.popupMgr.isPopupJustClosed(this._content)){if(this.event(t.UIEvent.Popup),this.autoSize){this._list.layout.refresh();let t=this._list.numChildren,e=-1e3;for(let i=0;i<t;i++){let t=this._list.getChildAt(i);if(!(t instanceof ct))continue;let s=t.findTextWidget();if(s instanceof ht){let t=s.textWidth-s.width;t>e&&(e=t)}}this._content.width+e>this._initWidth?this._content.width+=e:this._content.width=this._initWidth}this._list.selection.index=-1,this._list.resizeToFit(this.visibleItemCount>0?this.visibleItemCount:Number.POSITIVE_INFINITY,10),U.inst.popupMgr.togglePopup(this._content,e,i)}}hide(){this._content.parent&&U.inst.popupMgr.hidePopup(this._content)}_clickItem(t){if(!(t instanceof ct))return;if(t.grayed)return void(this._list.selection.index=-1);let e=t.getController("checked");e&&0!=e.selectedIndex&&(1==e.selectedIndex?e.selectedIndex=2:e.selectedIndex=1),this.hideOnClickItem&&this.hide(),t.event(Yt,t)}}class Kt{static createButton(){return e.Loader.createNodes("internal/UI/Button.lh")}static createRadio(){return e.Loader.createNodes("internal/UI/Radio.lh")}static createCheckBox(){return e.Loader.createNodes("internal/UI/CheckBox.lh")}static createProgressBar(){return e.Loader.createNodes("internal/UI/ProgressBar.lh")}static createSliderH(){return e.Loader.createNodes("internal/UI/SliderH.lh")}static createSliderV(){return e.Loader.createNodes("internal/UI/SliderV.lh")}static createTextInput(){return e.Loader.createNodes("internal/UI/TextInput.lh")}static createTextArea(){return e.Loader.createNodes("internal/UI/TextArea.lh")}static createComboBox(){return e.Loader.createNodes("internal/UI/ComboBox.lh")}static _init(){if(!e.LayaEnv.isPlaying)return null;U.inst;const t=[R.windowModalWaiting,R.globalModalWaiting,R.popupMenu,R.tooltipsWidget,R.horizontalScrollBar,R.verticalScrollBar].filter(t=>null!=t);return e.PlayerConfig.UI.alwaysIncludeDefaultSkin&&t.push(...["Button.lh","Radio.lh","CheckBox.lh","ProgressBar.lh","SliderH.lh","SliderV.lh","TextInput.lh","TextArea.lh","ComboBox.lh"].map(t=>"internal/UI/"+t)),e.ILaya.loader.load(t)}}e.Laya.addAfterInitCallback(Kt._init),t.ButtonPageAlternatives=at,t.Controller=z,t.ControllerRef=E,t.DragDropManager=V,t.GBox=tt,t.GButton=ct,t.GComboBox=ut,t.GImage=nt,t.GLabel=lt,t.GList=vt,t.GLoader=O,t.GMovieClip=Ct,t.GPanel=St,t.GProgressBar=It,t.GRoot=U,t.GScrollBar=bt,t.GSlider=Pt,t.GTextField=ht,t.GTextInput=rt,t.GTree=Et,t.GTreeNode=Mt,t.GWidget=F,t.GWindow=N,t.Gear=x,t.GearBool=I,t.GearColor=b,t.GearDisplay=B,t.GearHexColor=P,t.GearNumber=v,t.GearStrColor=T,t.GearString=C,t.GearTweenConfig=Rt,t.ImageRenderer=W,t.Layout=X,t.ListLayout=ft,t.ListSelection=yt,t.PopupManager=G,t.PopupMenu=Xt,t.Relation=D,t.Scroller=Gt,t.Selection=mt,t.StretchParam=Y,t.Translations=st,t.TranslationsLoader=Ut,t.TreeSelection=zt,t.UIConfig2=R,t.UIPackage=Kt,t.WidgetPool=gt,t.WidgetRef=ot}(window.Laya=window.Laya||{},Laya);